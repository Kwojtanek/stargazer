function AstroMath(){}function Projection(a,b){this.PROJECTION=Projection.PROJ_TAN,this.ROT=this.tr_oR(a,b)}function Coo(a,b,c){this.lon=a,this.lat=b,this.prec=c,this.frame=null,this.computeDirCos()}function Tokenizer(a,b){this.string=Strings.trim(a,b),this.sep=b,this.pos=0}function Strings(){}function Numbers(){}function relMouseCoords(a){if(a.offsetX)return{x:a.offsetX,y:a.offsetY};if(!Utils.cssScale){var b=window.getComputedStyle(document.body,null),c=b.getPropertyValue("-webkit-transform")||b.getPropertyValue("-moz-transform")||b.getPropertyValue("-ms-transform")||b.getPropertyValue("-o-transform")||b.getPropertyValue("transform"),d=/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/,e=c.match(d);Utils.cssScale=e?parseFloat(e[1]):1}var f=a;f.target;var g=f.target||f.srcElement,h=g.currentStyle||window.getComputedStyle(g,null),i=parseInt(h.borderLeftWidth,10),j=parseInt(h.borderTopWidth,10),k=g.getBoundingClientRect(),l=f.clientX-i-k.left,m=f.clientY-j-k.top;return{x:parseInt(l/Utils.cssScale),y:parseInt(m/Utils.cssScale)}}var cds=cds||{},A=A||{};"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?i+"":"null";case"boolean":case"null":return i+"";case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Logger={},Logger.log=function(a,b){try{var c="http://alasky.u-strasbg.fr/cgi/AladinLiteLogger/log.py",d="";b&&(d=JSON.stringify(b)),$.ajax({url:c,data:{action:a,params:d,pageUrl:window.location.href,referer:document.referrer?document.referrer:""},method:"GET",dataType:"json"})}catch(e){window.console&&console.log("Exception: "+e)}},function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&0===b%120}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var Stats=function(){function a(a,b,c){var d,e,f;for(e=0;30>e;e++)for(d=0;73>d;d++)f=4*(d+74*e),a[f]=a[f+4],a[f+1]=a[f+5],a[f+2]=a[f+6];for(e=0;30>e;e++)f=4*(73+74*e),b>e?(a[f]=E[c].bg.r,a[f+1]=E[c].bg.g,a[f+2]=E[c].bg.b):(a[f]=E[c].fg.r,a[f+1]=E[c].fg.g,a[f+2]=E[c].fg.b)}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=0,q=2,r=0,s=(new Date).getTime(),t=s,u=s,v=0,w=1e3,x=0,y=0,z=1e3,A=0,B=0,C=1e3,D=0,E={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};b=document.createElement("div"),b.style.cursor="pointer",b.style.width="80px",b.style.opacity="0.9",b.style.zIndex="10001",b.addEventListener("click",function(){switch(p++,p==q&&(p=0),c.style.display="none",h.style.display="none",l.style.display="none",p){case 0:c.style.display="block";break;case 1:h.style.display="block";break;case 2:l.style.display="block"}},!1),c=document.createElement("div"),c.style.backgroundColor="rgb("+Math.floor(E.fps.bg.r/2)+","+Math.floor(E.fps.bg.g/2)+","+Math.floor(E.fps.bg.b/2)+")",c.style.padding="2px 0px 3px 0px",b.appendChild(c),d=document.createElement("div"),d.style.fontFamily="Helvetica, Arial, sans-serif",d.style.textAlign="left",d.style.fontSize="9px",d.style.color="rgb("+E.fps.fg.r+","+E.fps.fg.g+","+E.fps.fg.b+")",d.style.margin="0px 0px 1px 3px",d.innerHTML='<span style="font-weight:bold">FPS</span>',c.appendChild(d),e=document.createElement("canvas"),e.width=74,e.height=30,e.style.display="block",e.style.marginLeft="3px",c.appendChild(e),f=e.getContext("2d"),f.fillStyle="rgb("+E.fps.bg.r+","+E.fps.bg.g+","+E.fps.bg.b+")",f.fillRect(0,0,e.width,e.height),g=f.getImageData(0,0,e.width,e.height),h=document.createElement("div"),h.style.backgroundColor="rgb("+Math.floor(E.ms.bg.r/2)+","+Math.floor(E.ms.bg.g/2)+","+Math.floor(E.ms.bg.b/2)+")",h.style.padding="2px 0px 3px 0px",h.style.display="none",b.appendChild(h),i=document.createElement("div"),i.style.fontFamily="Helvetica, Arial, sans-serif",i.style.textAlign="left",i.style.fontSize="9px",i.style.color="rgb("+E.ms.fg.r+","+E.ms.fg.g+","+E.ms.fg.b+")",i.style.margin="0px 0px 1px 3px",i.innerHTML='<span style="font-weight:bold">MS</span>',h.appendChild(i),e=document.createElement("canvas"),e.width=74,e.height=30,e.style.display="block",e.style.marginLeft="3px",h.appendChild(e),j=e.getContext("2d"),j.fillStyle="rgb("+E.ms.bg.r+","+E.ms.bg.g+","+E.ms.bg.b+")",j.fillRect(0,0,e.width,e.height),k=j.getImageData(0,0,e.width,e.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(q=3)}catch(F){}return l=document.createElement("div"),l.style.backgroundColor="rgb("+Math.floor(E.mb.bg.r/2)+","+Math.floor(E.mb.bg.g/2)+","+Math.floor(E.mb.bg.b/2)+")",l.style.padding="2px 0px 3px 0px",l.style.display="none",b.appendChild(l),m=document.createElement("div"),m.style.fontFamily="Helvetica, Arial, sans-serif",m.style.textAlign="left",m.style.fontSize="9px",m.style.color="rgb("+E.mb.fg.r+","+E.mb.fg.g+","+E.mb.fg.b+")",m.style.margin="0px 0px 1px 3px",m.innerHTML='<span style="font-weight:bold">MB</span>',l.appendChild(m),e=document.createElement("canvas"),e.width=74,e.height=30,e.style.display="block",e.style.marginLeft="3px",l.appendChild(e),n=e.getContext("2d"),n.fillStyle="#301010",n.fillRect(0,0,e.width,e.height),o=n.getImageData(0,0,e.width,e.height),{domElement:b,update:function(){r++,s=(new Date).getTime(),y=s-t,z=Math.min(z,y),A=Math.max(A,y),a(k.data,Math.min(30,30-30*(y/200)),"ms"),i.innerHTML='<span style="font-weight:bold">'+y+" MS</span> ("+z+"-"+A+")",j.putImageData(k,0,0),t=s,s>u+1e3&&(v=Math.round(1e3*r/(s-u)),w=Math.min(w,v),x=Math.max(x,v),a(g.data,Math.min(30,30-30*(v/100)),"fps"),d.innerHTML='<span style="font-weight:bold">'+v+" FPS</span> ("+w+"-"+x+")",f.putImageData(g,0,0),3==q&&(B=9.54e-7*performance.memory.usedJSHeapSize,C=Math.min(C,B),D=Math.max(D,B),a(o.data,Math.min(30,30-B/2),"mb"),m.innerHTML='<span style="font-weight:bold">'+Math.round(B)+" MB</span> ("+Math.round(C)+"-"+Math.round(D)+")",n.putImageData(o,0,0)),u=s,r=0)}}};Constants={},Constants.PI=Math.PI,Constants.C_PR=Math.PI/180,Constants.VLEV=2,Constants.EPS=1e-7,Constants.c=.105,Constants.LN10=Math.log(10),Constants.PIOVER2=Math.PI/2,Constants.TWOPI=2*Math.PI,Constants.TWOTHIRD=2/3,Constants.ARCSECOND_RADIAN=484813681109536e-20,SpatialVector=function(){function a(a,b,c){"use strict";this.x=a,this.y=b,this.z=c,this.ra_=0,this.dec_=0,this.okRaDec_=!1}return a.prototype.setXYZ=function(a,b,c){this.x=a,this.y=b,this.z=c,this.okRaDec_=!1},a.prototype.length=function(){"use strict";return Math.sqrt(this.lengthSquared())},a.prototype.lengthSquared=function(){"use strict";return this.x*this.x+this.y*this.y+this.z*this.z},a.prototype.normalized=function(){"use strict";var a=this.length();this.x/=a,this.y/=a,this.z/=a},a.prototype.set=function(a,b){"use strict";this.ra_=a,this.dec_=b,this.okRaDec_=!0,this.updateXYZ()},a.prototype.angle=function(a){"use strict";var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z,d=this.x*a.y-this.y*a.x,e=Math.sqrt(b*b+c*c+d*d);return Math.abs(Math.atan2(e,dot(a)))},a.prototype.get=function(){"use strict";return[x,y,z]},a.prototype.toString=function(){"use strict";return"SpatialVector["+this.x+", "+this.y+", "+this.z+"]"},a.prototype.cross=function(b){"use strict";return new a(this.y*b.z-b.y*this.z,this.z*b.x-b.z*this.x,this.x*b.y-b.x()*this.y)},a.prototype.equal=function(a){"use strict";return this.x==a.x&&this.y==a.y&&this.z==a.z()?!0:!1},a.prototype.mult=function(b){"use strict";return new a(b*this.x,b*this.y,b*this.z)},a.prototype.dot=function(a){"use strict";return this.x*a.x+this.y*a.y+this.z*a.z},a.prototype.add=function(b){"use strict";return new a(this.x+b.x,this.y+b.y,this.z+b.z)},a.prototype.sub=function(b){"use strict";return new a(this.x-b.x,this.y-b.y,this.z-b.z)},a.prototype.dec=function(){"use strict";return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.dec_},a.prototype.ra=function(){"use strict";return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.ra_},a.prototype.updateXYZ=function(){"use strict";var a=Math.cos(this.dec_*Constants.C_PR);this.x=Math.cos(this.ra_*Constants.C_PR)*a,this.y=Math.sin(this.ra_*Constants.C_PR)*a,this.z=Math.sin(this.dec_*Constants.C_PR)},a.prototype.updateRaDec=function(){"use strict";this.dec_=Math.asin(this.z)/Constants.C_PR;var a=Math.cos(this.dec_*Constants.C_PR);this.ra_=a>Constants.EPS||-Constants.EPS>a?this.y>Constants.EPS||this.y<-Constants.EPS?0>this.y?360-Math.acos(this.x/a)/Constants.C_PR:Math.acos(this.x/a)/Constants.C_PR:0>this.x?180:0:0,this.okRaDec_=!0},a.prototype.toRaRadians=function(){"use strict";var a=0;return(0!=this.x||0!=this.y)&&(a=Math.atan2(this.y,this.x)),0>a&&(a+=2*Math.PI),a},a.prototype.toDeRadians=function(){var a=z/this.length(),b=Math.acos(a);return Math.PI/2-b},a}(),AngularPosition=function(){return AngularPosition=function(a,b){"use strict";this.theta=a,this.phi=b},AngularPosition.prototype.toString=function(){"use strict";return"theta: "+this.theta+", phi: "+this.phi},AngularPosition}(),LongRangeSetBuilder=function(){function a(){this.items=[]}return a.prototype.appendRange=function(a,b){for(var c=a;b>=c;c++)c in this.items||this.items.push(c)},a}(),HealpixIndex=function(){function a(a){"use strict";this.nside=a}return a.NS_MAX=8192,a.ORDER_MAX=13,a.NSIDELIST=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192],a.JRLL=[2,2,2,2,3,3,3,3,4,4,4,4],a.JPLL=[1,3,5,7,0,2,4,6,1,3,5,7],a.XOFFSET=[-1,-1,0,1,1,1,0,-1],a.YOFFSET=[0,1,1,1,0,-1,-1,-1],a.FACEARRAY=[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],a.SWAPARRAY=[[0,0,0,0,0,0,0,0,3,3,3,3],[0,0,0,0,0,0,0,0,6,6,6,6],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,5,5,5,5],[0,0,0,0,0,0,0,0,0,0,0,0],[5,5,5,5,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[6,6,6,6,0,0,0,0,0,0,0,0],[3,3,3,3,0,0,0,0,0,0,0,0]],a.Z0=Constants.TWOTHIRD,a.prototype.init=function(){"use strict";var b=256;this.ctab=Array(b),this.utab=Array(b);for(var c=0;256>c;++c)this.ctab[c]=1&c|(2&c)<<7|(4&c)>>1|(8&c)<<6|(16&c)>>2|(32&c)<<5|(64&c)>>3|(128&c)<<4,this.utab[c]=1&c|(2&c)<<1|(4&c)<<2|(8&c)<<3|(16&c)<<4|(32&c)<<5|(64&c)<<6|(128&c)<<7;this.nl2=2*this.nside,this.nl3=3*this.nside,this.nl4=4*this.nside,this.npface=this.nside*this.nside,this.ncap=2*this.nside*(this.nside-1),this.npix=12*this.npface,this.fact2=4/this.npix,this.fact1=(this.nside<<1)*this.fact2,this.order=a.nside2order(this.nside)},a.calculateNSide=function(b){for(var c=0,d=b*b,e=180/Constants.PI,f=5184e4*Constants.PI*e*e,g=Utils.castToInt(f/d),h=g/12,i=Math.sqrt(h),j=a.NS_MAX,k=0,l=0;a.NSIDELIST.length>l;l++)if(j>=Math.abs(i-a.NSIDELIST[l])&&(j=Math.abs(i-a.NSIDELIST[l]),c=a.NSIDELIST[l],k=l),i>c&&a.NS_MAX>i&&(c=a.NSIDELIST[k+1]),i>a.NS_MAX)return console.log("nside cannot be bigger than "+a.NS_MAX),a.NS_MAX;return c},a.nside2order=function(b){"use strict";return(b&b-1)>0?-1:Utils.castToInt(a.log2(b))},a.log2=function(a){"use strict";return Math.log(a)/Math.log(2)},a.prototype.ang2pix_nest=function(b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p;if(c>=Constants.TWOPI&&(c-=Constants.TWOPI),0>c&&(c+=Constants.TWOPI),b>Constants.PI||0>b)throw{name:"Illegal argument",message:"theta must be between 0 and "+Constants.PI};if(c>Constants.TWOPI||0>c)throw{name:"Illegal argument",message:"phi must be between 0 and "+Constants.TWOPI};if(e=Math.cos(b),f=Math.abs(e),g=c/Constants.PIOVER2,a.Z0>=f){var q=this.nside*(.5+g),r=.75*this.nside*e,k=q-r,l=q+r;i=k>>this.order,j=l>>this.order,n=i==j?4==i?4:i+4:j>i?i:j+8,o=Utils.castToInt(l&this.nside-1),p=Utils.castToInt(this.nside-(k&this.nside-1)-1)}else{m=Utils.castToInt(g),m>=4&&(m=3),h=g-m;var s=this.nside*Math.sqrt(3*(1-f));k=Utils.castToInt(h*s),l=Utils.castToInt((1-h)*s),k=Math.min(a.NS_MAX-1,k),l=Math.min(a.NS_MAX-1,l),e>=0?(n=m,o=Utils.castToInt(this.nside-l-1),p=Utils.castToInt(this.nside-k-1)):(n=m+8,o=k,p=l)}return d=this.xyf2nest(o,p,n)},a.prototype.xyf2nest=function(a,b,c){"use strict";return(c<<2*this.order)+(this.utab[255&a]|this.utab[255&a>>8]<<16|this.utab[255&a>>16]<<32|this.utab[255&a>>24]<<48|this.utab[255&b]<<1|this.utab[255&b>>8]<<17|this.utab[255&b>>16]<<33|this.utab[255&b>>24]<<49)},a.prototype.nest2xyf=function(a){"use strict";var b={};b.face_num=a>>2*this.order;var c=a&this.npface-1,d=(93823560581120&c)>>16|(614882086624428e4&c)>>31|21845&c|(1431633920&c)>>15;return b.ix=this.ctab[255&d]|this.ctab[255&d>>8]<<4|this.ctab[255&d>>16]<<16|this.ctab[255&d>>24]<<20,c>>=1,d=(93823560581120&c)>>16|(614882086624428e4&c)>>31|21845&c|(1431633920&c)>>15,b.iy=this.ctab[255&d]|this.ctab[255&d>>8]<<4|this.ctab[255&d>>16]<<16|this.ctab[255&d>>24]<<20,b},a.prototype.pix2ang_nest=function(b){"use strict";if(0>b||b>this.npix-1)throw{name:"Illegal argument",message:"ipix out of range"};var c,d,e,f=this.nest2xyf(b),g=f.ix,h=f.iy,i=f.face_num,j=(a.JRLL[i]<<this.order)-g-h-1;this.nside>j?(c=j,d=1-c*c*this.fact2,e=0):j>this.nl3?(c=this.nl4-j,d=c*c*this.fact2-1,e=0):(c=this.nside,d=(this.nl2-j)*this.fact1,e=1&j-this.nside);var k=Math.acos(d),l=(a.JPLL[i]*c+g-h+1+e)/2;l>this.nl4&&(l-=this.nl4),1>l&&(l+=this.nl4);var m=(l-.5*(e+1))*(Constants.PIOVER2/c);return{theta:k,phi:m}},a.nside2Npix=function(b){"use strict";if(0>b||(b&-b)!=b||b>a.NS_MAX)throw{name:"Illegal argument",message:"nside should be >0, power of 2, <"+a.NS_MAX};var c=12*b*b;return c},a.prototype.xyf2ring=function(b,c,d){"use strict";var e,f,g,h=a.JRLL[d]*this.nside-b-c-1;this.nside>h?(e=h,g=2*e*(e-1),f=0):h>3*this.nside?(e=this.nl4-h,g=this.npix-2*(e+1)*e,f=0):(e=this.nside,g=this.ncap+(h-this.nside)*this.nl4,f=1&h-this.nside);var i=(a.JPLL[d]*e+b-c+1+f)/2;return i>this.nl4?i-=this.nl4:1>i&&(i+=this.nl4),g+i-1},a.prototype.nest2ring=function(a){"use strict";var b=this.nest2xyf(a),c=this.xyf2ring(b.ix,b.iy,b.face_num);return c},a.prototype.corners_nest=function(a,b){"use strict";var c=this.nest2ring(a);return this.corners_ring(c,b)},a.prototype.pix2ang_ring=function(a){"use strict";var b,c,d,e,f,g,h,i,j;if(0>a||a>this.npix-1)throw{name:"Illegal argument",message:"ipix out of range"};return g=a+1,this.ncap>=g?(i=g/2,j=Utils.castToInt(i),d=Utils.castToInt(Math.sqrt(i-Math.sqrt(j)))+1,e=g-2*d*(d-1),b=Math.acos(1-d*d*this.fact2),c=(e-.5)*Constants.PI/(2*d)):this.npix-this.ncap>a?(f=a-this.ncap,d=f/this.nl4+this.nside,e=f%this.nl4+1,h=(1&d+this.nside)>0?1:.5,b=Math.acos((this.nl2-d)*this.fact1),c=(e-h)*Constants.PI/this.nl2):(f=this.npix-a,d=Utils.castToInt(.5*(1+Math.sqrt(2*f-1))),e=4*d+1-(f-2*d*(d-1)),b=Math.acos(-1+Math.pow(d,2)*this.fact2),c=(e-.5)*Constants.PI/(2*d)),[b,c]},a.prototype.ring=function(a){"use strict";var b,c,d=0,e=a+1,f=0;return this.ncap>=e?(c=e/2,f=Utils.castToInt(c),d=Utils.castToInt(Math.sqrt(c-Math.sqrt(f)))+1):this.nl2*(5*this.nside+1)>=e?(b=Utils.castToInt(e-this.ncap-1),d=Utils.castToInt(b/this.nl4+this.nside)):(b=this.npix-e+1,c=b/2,f=Utils.castToInt(c),d=Utils.castToInt(Math.sqrt(c-Math.sqrt(f)))+1,d=this.nl4-d),d},a.prototype.integration_limits_in_costh=function(a){"use strict";var b,c,d,e;return e=1*this.nside,this.nside>=a?(c=1-Math.pow(a,2)/3/this.npface,d=1-Math.pow(a-1,2)/3/this.npface,b=a==this.nside?2*(this.nside-1)/3/e:1-Math.pow(a+1,2)/3/this.npface):this.nl3>a?(c=2*(2*this.nside-a)/3/e,d=2*(2*this.nside-a+1)/3/e,b=2*(2*this.nside-a-1)/3/e):(d=a==this.nl3?2*(-this.nside+1)/3/e:-1+Math.pow(4*this.nside-a+1,2)/3/this.npface,b=-1+Math.pow(this.nl4-a-1,2)/3/this.npface,c=-1+Math.pow(this.nl4-a,2)/3/this.npface),[d,c,b]},a.prototype.pixel_boundaries=function(a,b,c,d){var e,f,g,h,i,j,k,l,m=1*this.nside;if(Math.abs(d)>=1-1/3/this.npface)return k=c*Constants.PIOVER2,l=(c+1)*Constants.PIOVER2,[k,l];if(1.5*d>=1)e=Math.sqrt(3*(1-d)),f=1/m/e,g=b,h=g-1,i=a-b,j=i+1,k=Constants.PIOVER2*(Math.max(h*f,1-j*f)+c),l=Constants.PIOVER2*(Math.min(1-i*f,g*f)+c);else if(1.5*d>-1){var n=.5*(1-1.5*d),o=n+1,p=this.nside+a%2;g=b-(p-a)/2,h=g-1,i=(p+a)/2-b,j=i+1,k=Constants.PIOVER2*(Math.max(o-j/m,-n+h/m)+c),l=Constants.PIOVER2*(Math.min(o-i/m,-n+g/m)+c)}else{e=Math.sqrt(3*(1+d)),f=1/m/e;var q=2*this.nside;g=a-q+b,h=g-1,i=q-b,j=i+1,k=Constants.PIOVER2*(Math.max(1-(q-h)*f,(q-j)*f)+c),l=Constants.PIOVER2*(Math.min(1-(q-g)*f,(q-i)*f)+c)}return[k,l]},a.vector=function(a,b){"use strict";var c=1*Math.sin(a)*Math.cos(b),d=1*Math.sin(a)*Math.sin(b),e=1*Math.cos(a);return new SpatialVector(c,d,e)},a.prototype.corners_ring=function(b,c){"use strict";var d=2*c+2,e=Array(d),f=this.pix2ang_ring(b),g=Math.cos(f[0]),h=f[0],i=f[1],j=Utils.castToInt(i/Constants.PIOVER2),k=this.ring(b),l=Math.min(k,Math.min(this.nside,this.nl4-k)),m=0,n=Constants.PIOVER2/l;m=k>=this.nside&&this.nl3>=k?Utils.castToInt(i/n+k%2/2)+1:Utils.castToInt(i/n)+1,m-=j*l;var o=d/2,p=this.integration_limits_in_costh(k),q=Math.acos(p[0]),r=Math.acos(p[2]),s=this.pixel_boundaries(k,m,j,p[0]);if(e[0]=m>l/2?a.vector(q,s[1]):a.vector(q,s[0]),s=this.pixel_boundaries(k,m,j,p[2]),e[o]=m>l/2?a.vector(r,s[1]):a.vector(r,s[0]),1==c){var t=Math.acos(p[1]);s=this.pixel_boundaries(k,m,j,p[1]),e[1]=a.vector(t,s[0]),e[3]=a.vector(t,s[1])}else for(var u=p[2]-p[0],v=u/(c+1),w=1;c>=w;w++)g=p[0]+v*w,h=Math.acos(g),s=this.pixel_boundaries(k,m,j,g),e[w]=a.vector(h,s[0]),e[d-w]=a.vector(h,s[1]);return e},a.vec2Ang=function(a){"use strict";var b=a.z/a.length(),c=Math.acos(b),d=0;return(0!=a.x||0!=a.y)&&(d=Math.atan2(a.y,a.x)),0>d&&(d+=2*Math.PI),[c,d]},a.prototype.queryDisc=function(b,c,d,e){"use strict";if(0>c||c>Constants.PI)throw{name:"Illegal argument",message:"angular radius is in RADIAN and should be in [0,pi]"};var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=new LongRangeSetBuilder,z=null,j=c;if(e&&(j+=Constants.PI/this.nl4),z=a.vec2Ang(b),k=z[0],l=z[1],p=this.fact2,q=this.fact1,i=Math.cos(k),x=1/Math.sqrt((1-i)*(1+i)),s=k-j,t=k+j,m=Math.cos(j),v=Math.cos(s),f=this.ringAbove(v)+1,u=Math.cos(t),g=this.ringAbove(u),f>g&&0==g&&(g=f),0>=s)for(var A=1;f>A;++A)this.inRing(A,0,Math.PI,y);for(h=f;g>=h;++h)w=this.nside>h?1-h*h*p:this.nl3>=h?(this.nl2-h)*q:-1+(this.nl4-h)*(this.nl4-h)*p,n=(m-w*i)*x,o=1-w*w-n*n,r=Math.atan2(Math.sqrt(o),n),isNaN(r)&&(r=j),this.inRing(h,l,r,y);if(t>=Math.PI)for(var A=g+1;this.nl4>A;++A)this.inRing(A,0,Math.PI,y,!1);var B;if(d){for(var C=y.items,D=[],E=0;C.length>E;E++){var F=this.ring2nest(C[E]);D.indexOf(F)>=0||D.push(F)}B=D}else B=y.items;return B},a.prototype.inRing=function(a,b,c,d,e){"use strict";var f,g,h,i,j=!1,k=!1,l=1e-12,m=0,n=0,o=0,p=0,q=(b-c)%Constants.TWOPI-l,r=b+c+l,s=(b+c)%Constants.TWOPI+l;if(l>Math.abs(c-Constants.PI)&&(j=!0),a>=this.nside&&this.nl3>=a?(n=a-this.nside+1,h=this.ncap+this.nl4*(n-1),i=h+this.nl4-1,f=n%2,g=this.nl4):(this.nside>a?(n=a,h=2*n*(n-1),i=h+4*n-1):(n=4*this.nside-a,h=this.npix-2*n*(n+1),i=h+4*n-1),g=4*n,f=1),j)return void d.appendRange(h,i);if(m=f/2,e)o=Math.round(g*q/Constants.TWOPI-m),p=Math.round(g*r/Constants.TWOPI-m),o%=g,p>g&&(p%=g);else{if(o=Math.ceil(g*q/Constants.TWOPI-m),p=Utils.castToInt(g*s/Constants.TWOPI-m),o>p&&1==a&&(p=Utils.castToInt(g*r/Constants.TWOPI-m)),o==p+1&&(o=p),1==o-p&&Constants.PI>c*g)return void console.log("the interval is too small and avay from center");o=Math.min(o,g-1),p=Math.max(p,0)}if(o>p&&(k=!0),k)o+=h,p+=h,d.appendRange(h,p),d.appendRange(o,i);else{if(0>o)return o=Math.abs(o),d.appendRange(h,h+p),void d.appendRange(i-o+1,i);o+=h,p+=h,d.appendRange(o,p)}},a.prototype.ringAbove=function(a){"use strict";var b=Math.abs(a);if(b>Constants.TWOTHIRD){var c=Utils.castToInt(this.nside*Math.sqrt(3*(1-b)));return a>0?c:4*this.nside-c-1}return Utils.castToInt(this.nside*(2-1.5*a))},a.prototype.ring2nest=function(a){"use strict";var b=this.ring2xyf(a);return this.xyf2nest(b.ix,b.iy,b.face_num)},a.prototype.ring2xyf=function(b){"use strict";var c,d,e,f,g={};if(this.ncap>b){c=Utils.castToInt(.5*(1+Math.sqrt(1+2*b))),d=b+1-2*c*(c-1),e=0,f=c,g.face_num=0;var h=d-1;h>=2*c&&(g.face_num=2,h-=2*c),h>=c&&++g.face_num}else if(this.npix-this.ncap>b){var i=b-this.ncap;this.order>=0?(c=(i>>this.order+2)+this.nside,d=(i&this.nl4-1)+1):(c=i/this.nl4+this.nside,d=i%this.nl4+1),e=1&c+this.nside,f=this.nside;var j,k,l=c-this.nside+1,m=this.nl2+2-l;this.order>=0?(j=d-Utils.castToInt(l/2)+this.nside-1>>this.order,k=d-Utils.castToInt(m/2)+this.nside-1>>this.order):(j=(d-Utils.castToInt(l/2)+this.nside-1)/this.nside,k=(d-Utils.castToInt(m/2)+this.nside-1)/this.nside),g.face_num=k==j?4==k?4:Utils.castToInt(k)+4:j>k?Utils.castToInt(k):Utils.castToInt(j)+8}else{var i=this.npix-b;c=Utils.castToInt(.5*(1+Math.sqrt(2*i-1))),d=4*c+1-(i-2*c*(c-1)),e=0,f=c,c=2*this.nl2-c,g.face_num=8;var h=d-1;h>=2*f&&(g.face_num=10,h-=2*f),h>=f&&++g.face_num}var n=c-a.JRLL[g.face_num]*this.nside+1,o=2*d-a.JPLL[g.face_num]*f-e-1;return o>=this.nl2&&(o-=8*this.nside),g.ix=o-n>>1,g.iy=-(o+n)>>1,g},a}(),Utils=function(){},Utils.radecToPolar=function(a,b){return{theta:Math.PI/2-b/180*Math.PI,phi:a/180*Math.PI}},Utils.polarToRadec=function(a,b){return{ra:180*b/Math.PI,dec:180*(Math.PI/2-a)/Math.PI}},Utils.castToInt=function(a){return a>0?Math.floor(a):Math.ceil(a)},AstroMath.D2R=Math.PI/180,AstroMath.R2D=180/Math.PI,AstroMath.sign=function(a){return a>0?1:0>a?-1:0},AstroMath.cosd=function(a){if(0==a%90){var b=Math.abs(Math.floor(a/90+.5))%4;switch(b){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}}return Math.cos(a*AstroMath.D2R)},AstroMath.sind=function(a){if(0===a%90){var b=Math.abs(Math.floor(a/90-.5))%4;switch(b){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}}return Math.sin(a*AstroMath.D2R)},AstroMath.tand=function(a){var b;return b=a%360,0==b||180==Math.abs(b)?0:45==b||225==b?1:-135==b||-315==b?-1:Math.tan(a*AstroMath.D2R)},AstroMath.asind=function(a){return Math.asin(a)*AstroMath.R2D},AstroMath.acosd=function(a){return Math.acos(a)*AstroMath.R2D},AstroMath.atand=function(a){return Math.atan(a)*AstroMath.R2D},AstroMath.atan2=function(a,b){if(0==a)return b>0?0:0>b?Math.PI:NaN;var c=AstroMath.sign(a);if(0==b)return Math.PI/2*c;var d=Math.atan(Math.abs(a/b));return b>0?d*c:0>b?(Math.PI-d)*c:void 0},AstroMath.atan2d=function(a,b){return AstroMath.atan2(a,b)*AstroMath.R2D},AstroMath.cosh=function(a){return(Math.exp(a)+Math.exp(-a))/2},AstroMath.sinh=function(a){return(Math.exp(a)-Math.exp(-a))/2},AstroMath.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},AstroMath.acosh=function(a){return Math.log(a+Math.sqrt(a*a-1))},AstroMath.asinh=function(a){return Math.log(a+Math.sqrt(a*a+1))},AstroMath.atanh=function(a){return.5*Math.log((1+a)/(1-a))},AstroMath.sinc=function(a){var b,c=Math.abs(a);return.001>=c?(c*=c,b=1-c*(1-c/20)/6):b=Math.sin(c)/c,b},AstroMath.asinc=function(a){var b,c=Math.abs(a);return.001>=c?(c*=c,b=1+c*(6+.45*c)/6):b=Math.asin(c)/c,b},AstroMath.hypot=function(a,b){return Math.sqrt(a*a+b*b)},AstroMath.eulerMatrix=function(a,b,c){var d=Array(3);d[0]=Array(3),d[1]=Array(3),d[2]=Array(3);var e=AstroMath.cosd(a),f=AstroMath.sind(a),g=AstroMath.cosd(b),h=AstroMath.sind(b),i=AstroMath.cosd(c),j=AstroMath.sind(c);return d[0][0]=i*g*e-j*f,d[0][1]=-j*g*e-i*f,d[0][2]=-h*e,d[1][0]=i*g*f+j*e,d[1][1]=-j*g*f+i*e,d[1][2]=-h*f,d[2][0]=-h*i,d[2][1]=-h*e,d[2][2]=g,d},AstroMath.displayMatrix=function(a){for(var b=a.length,c=0,d=0;b>d;d++)a[d].length>c&&(c=a[d].length);for(var e="<table>\n",d=0;b>d;d++){e+="<tr>";for(var f=0;b>f;f++)e+="<td>",a[d].length>d&&(e+=""+a[d][f]),e+="</td>";e+="</td>\n"}return e+="</table>\n"},Projection.PROJ_TAN=1,Projection.PROJ_TAN2=2,Projection.PROJ_STG=2,Projection.PROJ_SIN=3,Projection.PROJ_SIN2=4,Projection.PROJ_ZEA=4,Projection.PROJ_ARC=5,Projection.PROJ_SCHMIDT=5,Projection.PROJ_AITOFF=6,Projection.PROJ_AIT=6,Projection.PROJ_GLS=7,Projection.PROJ_MERCATOR=8,Projection.PROJ_MER=8,Projection.PROJ_LAM=9,Projection.PROJ_LAMBERT=9,Projection.PROJ_TSC=10,Projection.PROJ_QSC=11,Projection.PROJ_LIST=["Mercator",Projection.PROJ_MERCATOR,"Gnomonic",Projection.PROJ_TAN,"Stereographic",Projection.PROJ_TAN2,"Orthographic",Projection.PROJ_SIN,"Zenithal",Projection.PROJ_ZEA,"Schmidt",Projection.PROJ_SCHMIDT,"Aitoff",Projection.PROJ_AITOFF,"Lambert",Projection.PROJ_LAMBERT],Projection.PROJ_NAME=["-","Gnomonic","Stereographic","Orthographic","Equal-area","Schmidt plates","Aitoff","Global sin","Mercator","Lambert"],Projection.prototype={setCenter:function(a,b){this.ROT=this.tr_oR(a,b)},setProjection:function(a){this.PROJECTION=a},project:function(a,b){var c=this.tr_ou(a,b),d=this.tr_uu(c,this.ROT),e=this.tr_up(this.PROJECTION,d);return null==e?null:{X:-e[0],Y:-e[1]}},unproject:function(a,b){a=-a,b=-b;var c=this.tr_pu(this.PROJECTION,a,b),d=this.tr_uu1(c,this.ROT),e=this.tr_uo(d);return{ra:e[0],dec:e[1]}},tr_up:function(a,b){var c,d,e,f,g,h=b[0],i=b[1],j=b[2];if(c=AstroMath.hypot(h,i),0==c&&0==j)return null;switch(a){default:e=null;break;case Projection.PROJ_AITOFF:d=Math.sqrt(c*(c+h)/2),f=Math.sqrt(2*c*(c-h)),d=Math.sqrt((1+d)/2),f/=d,g=j/d,0>i&&(f=-f),e=[f,g];break;case Projection.PROJ_GLS:g=Math.asin(j),f=0!=c?Math.atan2(i,h)*c:0,e=[f,g];break;case Projection.PROJ_MERCATOR:0!=c?(f=Math.atan2(i,h),g=AstroMath.atanh(j),e=[f,g]):e=null;break;case Projection.PROJ_TAN:h>0?(f=i/h,g=j/h,e=[f,g]):e=null;break;case Projection.PROJ_TAN2:d=(1+h)/2,d>0?(f=i/d,g=j/d,e=[f,g]):e=null;break;case Projection.PROJ_ARC:-1>=h?(f=Math.PI,g=0):(c=AstroMath.hypot(i,j),d=h>0?AstroMath.asinc(c):Math.acos(h)/c,f=i*d,g=j*d),e=[f,g];break;case Projection.PROJ_SIN:h>=0?(f=i,g=j,e=[f,g]):e=null;break;case Projection.PROJ_SIN2:d=Math.sqrt((1+h)/2),0!=d?(f=i/d,g=j/d):(f=2,g=0),e=[f,g];break;case Projection.PROJ_LAMBERT:g=j,f=0,0!=c&&(f=Math.atan2(i,h)),e=[f,g]}return e},tr_pu:function(a,b,c){var d,e,f,g,h;switch(a){default:return null;case Projection.PROJ_AITOFF:if(d=b*b/8+c*c/2,d>1)return null;f=1-d,e=Math.sqrt(1-d/2),g=b*e/2,h=c*e,d=AstroMath.hypot(f,g),0!=d&&(e=f,f=(e*e-g*g)/d,g=2*e*g/d);break;case Projection.PROJ_GLS:if(h=Math.sin(c),d=1-h*h,0>d)return null;d=Math.sqrt(d),e=0!=d?b/d:0,f=d*Math.cos(e),g=d*Math.sin(e);break;case Projection.PROJ_MERCATOR:h=AstroMath.tanh(c),d=1/AstroMath.cosh(c),f=d*Math.cos(b),g=d*Math.sin(b);break;case Projection.PROJ_LAMBERT:if(h=c,d=1-h*h,0>d)return null;d=Math.sqrt(d),f=d*Math.cos(b),g=d*Math.sin(b);break;case Projection.PROJ_TAN:f=1/Math.sqrt(1+b*b+c*c),g=b*f,h=c*f;break;case Projection.PROJ_TAN2:d=(b*b+c*c)/4,e=1+d,f=(1-d)/e,g=b/e,h=c/e;break;case Projection.PROJ_ARC:if(d=AstroMath.hypot(b,c),d>Math.PI)return null;e=AstroMath.sinc(d),f=Math.cos(d),g=e*b,h=e*c;break;case Projection.PROJ_SIN:if(e=1-b*b-c*c,0>e)return null;f=Math.sqrt(e),g=b,h=c;break;case Projection.PROJ_SIN2:if(d=(b*b+c*c)/4,d>1)return null;e=Math.sqrt(1-d),f=1-2*d,g=e*b,h=e*c}return[f,g,h]},tr_oR:function(a,b){var c=Array(3);return c[0]=Array(3),c[1]=Array(3),c[2]=Array(3),c[2][2]=AstroMath.cosd(b),
c[0][2]=AstroMath.sind(b),c[1][1]=AstroMath.cosd(a),c[1][0]=-AstroMath.sind(a),c[1][2]=0,c[0][0]=c[2][2]*c[1][1],c[0][1]=-c[2][2]*c[1][0],c[2][0]=-c[0][2]*c[1][1],c[2][1]=c[0][2]*c[1][0],c},tr_ou:function(a,b){var c=Array(3),d=AstroMath.cosd(b);return c[0]=d*AstroMath.cosd(a),c[1]=d*AstroMath.sind(a),c[2]=AstroMath.sind(b),c},tr_uu:function(a,b){var c=Array(3),d=a[0],e=a[1],f=a[2];return c[0]=b[0][0]*d+b[0][1]*e+b[0][2]*f,c[1]=b[1][0]*d+b[1][1]*e+b[1][2]*f,c[2]=b[2][0]*d+b[2][1]*e+b[2][2]*f,c},tr_uu1:function(a,b){var c=Array(3),d=a[0],e=a[1],f=a[2];return c[0]=b[0][0]*d+b[1][0]*e+b[2][0]*f,c[1]=b[0][1]*d+b[1][1]*e+b[2][1]*f,c[2]=b[0][2]*d+b[1][2]*e+b[2][2]*f,c},tr_uo:function(a){var b,c,d=a[0],e=a[1],f=a[2],g=d*d+e*e;if(0==g){if(0==f)return null;b=0,c=f>0?90:-90}else c=AstroMath.atand(f/Math.sqrt(g)),b=AstroMath.atan2d(e,d),0>b&&(b+=360);return[b,c]}},Coo.factor=[3600,60,1],Coo.prototype={setFrame:function(a){this.frame=a},computeDirCos:function(){var a=AstroMath.cosd(this.lat);this.x=a*AstroMath.cosd(this.lon),this.y=a*AstroMath.sind(this.lon),this.z=AstroMath.sind(this.lat)},computeLonLat:function(){var a=this.x*this.x+this.y*this.y;this.lon=0,0==a?0==this.z?(this.lon=NaN,this.lat=NaN):this.lat=this.z>0?90:-90:(this.lon=AstroMath.atan2d(this.y,this.x),this.lat=AstroMath.atan2d(this.z,Math.sqrt(a)),0>this.lon&&(this.lon+=360))},dist2:function(a){var b=a.x-this.x,c=b*b;return b=a.y-this.y,c+=b*b,b=a.z-this.z,c+=b*b},distance:function(a){return 0==a.x&&0==a.y&&0==a.z?NaN:0==this.x&&0==this.y&&0==this.z?NaN:2*AstroMath.asind(.5*Math.sqrt(this.dist2(a)))},convertTo:function(a){this.frame.equals(a)||(this.frame.toICRS(this.coo),a.fromICRS(this.coo),this.frame=a,this.lon=this.lat=NaN)},rotate:function(a){var b,c,d;a!=Umatrix3&&(b=a[0][0]*this.x+a[0][1]*this.y+a[0][2]*this.z,c=a[1][0]*this.x+a[1][1]*this.y+a[1][2]*this.z,d=a[2][0]*this.x+a[2][1]*this.y+a[2][2]*this.z,this.x=b,this.y=c,this.z=d,this.lon=this.lat=NaN)},rotate_1:function(a){var b,c,d;a!=Umatrix3&&(b=a[0][0]*this.x+a[1][0]*this.y+a[2][0]*this.z,c=a[0][1]*this.x+a[1][1]*this.y+a[2][1]*this.z,d=a[0][2]*this.x+a[1][2]*this.y+a[2][2]*this.z,this.x=b,this.y=c,this.z=d,this.lon=this.lat=NaN)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z},parse:function(a){var b=a.indexOf("+");if(0>b&&(b=a.indexOf("-")),0>b&&(b=a.indexOf(" ")),0>b)return this.lon=NaN,this.lat=NaN,this.prec=0,!1;var c=a.substring(0,b),d=a.substring(b);return this.lon=this.parseLon(c),this.lat=this.parseLat(d),!0},parseLon:function(a){var a=a.trim();if(a=a.replace(/:/g," "),0>a.indexOf(" ")){var b=a.indexOf(".");return this.prec=0>b?0:a.length-b-1,parseFloat(a)}for(var c=new Tokenizer(a," "),d=0,e=0,f=0;c.hasMore();){var g=c.nextToken(),h=g.indexOf(".");switch(e+=parseFloat(g)*Coo.factor[d],d){case 0:f=0>h?1:2;break;case 1:f=0>h?3:4;break;case 2:f=0>h?5:4+g.length-h}d++}return this.prec=f,15*e/3600},parseLat:function(a){var a=a.trim();a=a.replace(/:/g," ");var b;if("-"==a.charAt(0)?(b=-1,a=a.substring(1)):"-"==a.charAt(0)?(b=1,a=a.substring(1)):b=1,0>a.indexOf(" ")){var c=a.indexOf(".");return this.prec=0>c?0:a.length-c-1,parseFloat(a)*b}for(var d=new Tokenizer(a," "),e=0,f=0,g=0;d.hasMore();){var h=d.nextToken(),i=h.indexOf(".");switch(f+=parseFloat(h)*Coo.factor[e],e){case 0:g=0>i?1:2;break;case 1:g=0>i?3:4;break;case 2:g=0>i?5:4+h.length-i}e++}return this.prec=g,f*b/3600},format:function(a){isNaN(this.lon)&&this.computeLonLat();var b="",c="";if(a.indexOf("d")>=0)b=Numbers.format(this.lon,this.prec),c=Numbers.format(this.lat,this.prec);else var d=this.lon/15,b=Numbers.toSexagesimal(d,this.prec+1,!1),c=Numbers.toSexagesimal(this.lat,this.prec,!1);return this.lat>0&&(c="+"+c),a.indexOf("/")>=0?b+" "+c:a.indexOf("2")>=0?[b,c]:b+c}},Tokenizer.prototype={hasMore:function(){return this.pos<this.string.length},nextToken:function(){for(var a=this.pos;this.string.length>a&&this.string.charAt(a)==this.sep;)a++;for(var b=a;this.string.length>b&&this.string.charAt(b)!=this.sep;)b++;return this.pos=b,this.string.substring(a,b)}},Strings.trim=function(a,b){for(var c=0,d=a.length-1;a.length>c&&a.charAt(c)==b;)c++;if(c==a.length)return"";for(;d>c&&a.charAt(d)==b;)d--;return a.substring(c,d+1)},Numbers.pow10=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14],Numbers.rndval=[.5,.05,.005,5e-4,5e-5,5e-6,5e-7,5e-8,5e-9,5e-10,5e-11,5e-12,5e-13,5e-14,5e-14],Numbers.format=function(a,b){if(0>=b)return""+Math.round(a);var c=""+a,d=c.indexOf("."),e=d>=0?c.length-d-1:0;if(b>=e){0>d&&(c+=".");for(var f=0;b-e>f;f++)c+="0";return c}return c=""+(a+Numbers.rndval[b]),c.substr(0,d+b+1)},Numbers.toSexagesimal=function(a,b,c){var d=0>a?"-":c?"+":"",e=Math.abs(a);switch(b){case 1:var f=Math.round(e);return d+(""+f);case 2:return d+Numbers.format(e,1);case 3:var f=Math.floor(e),g=Math.round(60*(e-f));return d+f+" "+g;case 4:var f=Math.floor(e),g=60*(e-f);return d+f+" "+Numbers.format(g,1);case 5:var f=Math.floor(e),g=60*(e-f),h=Math.floor(g),i=Math.round(60*(g-h));return d+f+" "+h+" "+i;case 6:case 7:case 8:var f=Math.floor(e);10>f&&(f="0"+f);var g=60*(e-f),h=Math.floor(g);10>h&&(h="0"+h);var i=60*(g-h);return d+f+" "+h+" "+Numbers.format(i,b-5);default:return d+Numbers.format(e,1)}},CooConversion=function(){var a={};return a.GALACTIC_TO_J2000=[-.0548755604024359,.4941094279435681,-.867666148981161,-.8734370902479237,-.4448296299195045,-.1980763734646737,-.4838350155267381,.7469822444763707,.4559837762325372],a.J2000_TO_GALACTIC=[-.0548755604024359,-.873437090247923,-.4838350155267381,.4941094279435681,-.4448296299195045,.7469822444763707,-.867666148981161,-.1980763734646737,.4559837762325372],a.Transform=function(a,b){a[0]=a[0]*Math.PI/180,a[1]=a[1]*Math.PI/180;var c=[Math.cos(a[0])*Math.cos(a[1]),Math.sin(a[0])*Math.cos(a[1]),Math.sin(a[1])],d=[c[0]*b[0]+c[1]*b[1]+c[2]*b[2],c[0]*b[3]+c[1]*b[4]+c[2]*b[5],c[0]*b[6]+c[1]*b[7]+c[2]*b[8]],e=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),f=[0,0];f[1]=Math.asin(d[2]/e);var g=d[0]/e/Math.cos(f[1]),h=d[1]/e/Math.cos(f[1]);return f[0]=Math.atan2(h,g),0>f[0]&&(f[0]=f[0]+2*Math.PI),f[0]=180*f[0]/Math.PI,f[1]=180*f[1]/Math.PI,f},a.GalacticToJ2000=function(b){return a.Transform(b,a.GALACTIC_TO_J2000)},a.J2000ToGalactic=function(b){return a.Transform(b,a.J2000_TO_GALACTIC)},a}(),Sesame=function(){return Sesame={},Sesame.cache={},Sesame.getTargetRADec=function(a,b,c){if(b){var d=/[a-zA-Z]/.test(a);if(d)Sesame.resolve(a,function(a){b({ra:a.Target.Resolver.jradeg,dec:a.Target.Resolver.jdedeg})},function(){c&&c()});else{var e=new Coo;e.parse(a),b&&b({ra:e.lon,dec:e.lat})}}},Sesame.resolve=function(a,b,c){var d="http://cds.u-strasbg.fr/cgi-bin/nph-sesame.jsonp?";$.ajax({url:d,data:{object:a},method:"GET",dataType:"jsonp",success:function(a){a.Target&&a.Target.Resolver&&a.Target.Resolver?b(a):c(a)},error:c})},Sesame}(),HealpixCache=function(){var a={};return a.staticCache={corners:{nside8:[]}},a.dynamicCache={},a.lastNside=8,a.hpxIdxCache=null,a.init=function(){var b=new HealpixIndex(8);b.init();for(var c=HealpixIndex.nside2Npix(8),d=0;c>d;d++)a.staticCache.corners.nside8[d]=b.corners_nest(d,1);a.hpxIdxCache=b},a.corners_nest=function(b,c){return 8==c?a.staticCache.corners.nside8[b]:(c!=a.lastNside&&(a.hpxIdxCache=new HealpixIndex(c),a.hpxIdxCache.init(),a.lastNside=c),a.hpxIdxCache.corners_nest(b,1))},a}(),Utils=Utils||{},Utils.cssScale=void 0,HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords,Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=[].slice,c=b.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e?this:a||{},c.concat(b.call(arguments)))};return f.prototype=this.prototype,f}),$=$||jQuery,$.urlParam=function(a,b){return void 0===b&&(b=location.search),decodeURIComponent((RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(b)||[,""])[1].replace(/\+/g,"%20"))||null},Utils.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},Utils.debounce=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}},Utils.LRUCache=function(a){this._keys=[],this._items={},this._expires={},this._size=0,this._maxsize=a||1024},Utils.LRUCache.prototype={set:function(a,b){var c=this._keys,d=this._items,e=this._expires,f=this._size,g=this._maxsize;f>=g&&(c.sort(function(a,b){return e[a]>e[b]?-1:e[a]<e[b]?1:0}),f--,delete e[c[f]],delete d[c[f]]),c[f]=a,d[a]=b,e[a]=Date.now(),f++,this._keys=c,this._items=d,this._expires=e,this._size=f},get:function(a){var b=this._items[a];return b&&(this._expires[a]=Date.now()),b},keys:function(){return this._keys}},URLBuilder=function(){return URLBuilder={buildSimbadCSURL:function(a,b){if(a&&"object"==typeof a&&"ra"in a&&"dec"in a){var c=new Coo(a.ra,a.dec,7);a=c.format("s")}return"http://alasky.u-strasbg.fr/cgi/simbad-flat/simbad-cs.py?target="+encodeURIComponent(a)+"&SR="+b+"&format=votable&SRUNIT=deg&SORTBY=nbref"},buildNEDPositionCSURL:function(a,b,c){return"http://nedwww.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Position+Search&of=xml_main&RA="+a+"&DEC="+b+"&SR="+c},buildNEDObjectCSURL:function(a,b){return"http://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Name+Search&radius="+60*b+"&of=xml_main&objname="+a},buildVizieRCSURL:function(a,b,c){if(b&&"object"==typeof b&&"ra"in b&&"dec"in b){var d=new Coo(b.ra,b.dec,7);b=d.format("s")}return"http://vizier.u-strasbg.fr/viz-bin/votable?-source="+a+"&-c="+encodeURIComponent(b)+"&-out.max=999999&-c.rd="+c}}}(),MeasurementTable=function(){return MeasurementTable=function(a){this.isShowing=!1,this.divEl=$('<div class="aladin-measurement-div"></div>'),$(a).append(this.divEl)},MeasurementTable.prototype.showMeasurement=function(a){this.divEl.empty();var b="<thead><tr>",c="<tr>";for(key in a.data)b+="<th>"+key+"</th>",c+="<td>"+a.data[key]+"</td>";b+="</tr></thead>",c+="</tr>",this.divEl.append("<table>"+b+c+"</table>"),this.show()},MeasurementTable.prototype.show=function(){this.divEl.show()},MeasurementTable.prototype.hide=function(){this.divEl.hide()},MeasurementTable}(),Color=function(){return Color={},Color.curIdx=0,Color.colors=["#ff0000","#0000ff","#99cc00","#ffff00","#000066","#00ffff","#9900cc","#0099cc","#cc9900","#cc0099","#00cc99","#663333","#ffcc9a","#ff9acc","#ccff33","#660000","#ffcc33","#ff00ff","#00ff00","#ffffff"],Color.getNextColor=function(){var a=Color.colors[Color.curIdx%Color.colors.length];return Color.curIdx++,a},Color.getLabelColorForBackground=function(a){var c="#eee",d="#111";if(rgb=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),null==rgb)return d;r=parseInt(rgb[1]),g=parseInt(rgb[2]),b=parseInt(rgb[3]);var e=1-(.299*r+.587*g+.114*b)/255;return.5>e?d:c},Color}(),AladinUtils=function(){return{xyToView:function(a,b,c,d,e,f,g){return void 0==g&&(g=!1),g?{vx:e/2*(1+f*a)-(e-c)/2,vy:e/2*(1+f*b)-(e-d)/2}:{vx:AladinUtils.myRound(e/2*(1+f*a)-(e-c)/2),vy:AladinUtils.myRound(e/2*(1+f*b)-(e-d)/2)}},viewToXy:function(a,b,c,d,e,f){return{x:((2*a+(e-c))/e-1)/f,y:((2*b+(e-d))/e-1)/f}},radecToViewXy:function(a,b,c,d,e,f,g,h){var i;if(d!=CooFrameEnum.J2000){var j=CooConversion.J2000ToGalactic([a,b]);i=c.project(j[0],j[1])}else i=c.project(a,b);return i?AladinUtils.xyToView(i.X,i.Y,e,f,g,h,!0):null},myRound:function(a){return 0>a?-1*(0|-a):0|a},isHpxPixVisible:function(a,b,c){for(var d=0;a.length>d;d++)if(a[d].vx>=-20&&b+20>a[d].vx&&a[d].vy>=-20&&c+20>a[d].vy)return!0;return!1},ipixToIpix:function(a,b,c){},getZoomFactorForAngle:function(a,b){var c={ra:0,dec:0},d={ra:a,dec:0},e=new Projection(a/2,0);e.setProjection(b);var f=e.project(c.ra,c.dec),g=e.project(d.ra,d.dec),h=1/(f.X-g.Y);return h}}}(),ProjectionEnum={SIN:Projection.PROJ_SIN,AITOFF:Projection.PROJ_AITOFF},CooFrameEnum=function(){return{J2000:"J2000",GAL:"Galactic"}}(),CooFrameEnum.fromString=function(a,b){return a?(a=a.toLowerCase().replace(/^\s+|\s+$/g,""),0==a.indexOf("j2000")||0==a.indexOf("icrs")?CooFrameEnum.J2000:0==a.indexOf("gal")?CooFrameEnum.GAL:b?b:null):b?b:null},CooFrameEnum.shortName=function(a){return a==CooFrameEnum.J2000?"J2000":a==CooFrameEnum.GAL?"GAL":null},Downloader=function(){var a=4,b=!1,c=700,d=function(a){this.view=a,this.nbDownloads=0,this.dlQueue=[],this.urlsInQueue={}};return d.prototype.requestDownload=function(a,b,c){b in this.urlsInQueue||(this.dlQueue.push({img:a,url:b,cors:c}),this.urlsInQueue[b]=1,this.tryDownload())},d.prototype.tryDownload=function(){for(;this.dlQueue.length>0&&a>this.nbDownloads;)this.startDownloadNext()},d.prototype.startDownloadNext=function(){var a=this.dlQueue.shift();if(a){this.nbDownloads++;var b=this;a.img.onload=function(){b.completeDownload(this,!0)},a.img.onerror=function(){b.completeDownload(this,!1)},a.cors?a.img.crossOrigin="anonymous":void 0!==a.img.crossOrigin&&delete a.img.crossOrigin,a.img.src=a.url}},d.prototype.completeDownload=function(a,d){if(delete this.urlsInQueue[a.src],a.onerror=null,a.onload=null,this.nbDownloads--,d){if(b){var e=(new Date).getTime();a.fadingStart=e,a.fadingEnd=e+c}this.view.requestRedraw()}else a.dlError=!0;this.tryDownload()},d}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q={}.hasOwnProperty,r=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},s=[].slice;null==this.astro&&(this.astro={}),a=function(){function a(){}return a.include=function(a){var b,c;for(b in a)c=a[b],this.prototype[b]=c;return this},a.extend=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.invoke=function(a,b,c){var d;return d=null!=(null!=b?b.context:void 0)?b.context:this,null!=a?a.call(d,c,b):void 0},a}(),l=function(a){function b(a,b,c){var d,e=this;this.arg=a,this.callback=b,this.opts=c,this.hdus=[],this.blockCount=0,this.begin=0,this.end=this.BLOCKLENGTH,this.offset=0,this.headerStorage=new Uint8Array,"string"==typeof this.arg?(this.readNextBlock=this._readBlockFromBuffer,d=new XMLHttpRequest,d.open("GET",this.arg),d.responseType="arraybuffer",d.onload=function(){return 200!==d.status?void e.invoke(e.callback,e.opts):(e.arg=d.response,e.length=e.arg.byteLength,e.readFromBuffer())},d.send()):(this.length=this.arg.size,this.readNextBlock=this._readBlockFromFile,this.readFromFile())}return r(b,a),b.prototype.LINEWIDTH=80,b.prototype.BLOCKLENGTH=2880,File.prototype.slice=File.prototype.slice||File.prototype.webkitSlice,Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice,b.prototype.readFromBuffer=function(){var a;return a=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(a)},b.prototype.readFromFile=function(){var a,b=this;return this.reader=new FileReader,this.reader.onloadend=function(a){return b.readBlock(a.target.result)},a=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.reader.readAsArrayBuffer(a)},b.prototype.readBlock=function(a){var b,c,d,e,f,i,j,k,l,m,n,o,p;for(b=new Uint8Array(a),l=new Uint8Array(this.headerStorage),this.headerStorage=new Uint8Array(this.end),this.headerStorage.set(l,0),this.headerStorage.set(b,this.begin),i=this.BLOCKLENGTH/this.LINEWIDTH;i--;)if(f=i*this.LINEWIDTH,32!==b[f]){if(69===b[f]&&78===b[f+1]&&68===b[f+2]&&32===b[f+3]){for(j="",p=this.headerStorage,n=0,o=p.length;o>n;n++)m=p[n],j+=String.fromCharCode(m);return e=new h(j),this.start=this.end+this.offset,c=e.getDataLength(),k=this.arg.slice(this.start,this.start+c),e.hasDataUnit()&&(d=this.createDataUnit(e,k)),this.hdus.push(new g(e,d)),this.offset+=this.end+c+this.excessBytes(c),this.offset===this.length?(this.headerStorage=null,void this.invoke(this.callback,this.opts,this)):(this.blockCount=0,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,this.headerStorage=new Uint8Array,a=this.arg.slice(this.begin+this.offset,this.end+this.offset),void this.readNextBlock(a))}break}this.blockCount+=1,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,a=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(a)},b.prototype._readBlockFromBuffer=function(a){return this.readBlock(a)},b.prototype._readBlockFromFile=function(a){return this.reader.readAsArrayBuffer(a)},b.prototype.createDataUnit=function(a,b){var c;return c=a.getDataType(),new astro.FITS[c](a,b)},b.prototype.excessBytes=function(a){return(this.BLOCKLENGTH-a%this.BLOCKLENGTH)%this.BLOCKLENGTH},b.prototype.isEOF=function(){return this.offset===this.length?!0:!1},b}(a),f=function(a){function b(a,b,c){var d,e=this;this.arg=a,d=new l(this.arg,function(){return e.hdus=d.hdus,e.invoke(b,c,e)})}return r(b,a),b.prototype.getHDU=function(a){var b,c,d,e;if(null!=a&&null!=this.hdus[a])return this.hdus[a];for(e=this.hdus,c=0,d=e.length;d>c;c++)if(b=e[c],b.hasData())return b},b.prototype.getHeader=function(a){return this.getHDU(a).header},b.prototype.getDataUnit=function(a){return this.getHDU(a).data},b}(a),f.version="0.6.5",this.astro.FITS=f,d=function(a){function b(a,b){b instanceof ArrayBuffer?this.buffer=b:this.blob=b}return r(b,a),b.swapEndian={B:function(a){return a},I:function(a){return a<<8|a>>8},J:function(a){return(255&a)<<24|(65280&a)<<8|65280&a>>8|255&a>>24}},b.swapEndian[8]=b.swapEndian.B,b.swapEndian[16]=b.swapEndian.I,b.swapEndian[32]=b.swapEndian.J,b}(a),this.astro.FITS.DataUnit=d,i={verifyOrder:function(a,b){return b!==this.cardIndex?console.warn(""+a+" should appear at index "+this.cardIndex+" in the FITS header"):void 0},verifyBetween:function(a,b,c,d){if(!(b>=c&&d>=b))throw"The "+a+" value of "+b+" is not between "+c+" and "+d},verifyBoolean:function(a){return"T"===a?!0:!1},VerifyFns:{SIMPLE:function(){var a,b;return a=arguments.length>=1?s.call(arguments,0):[],b=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(b)},XTENSION:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],this.extension=!0,this.extensionType=arguments[0],this.verifyOrder("XTENSION",0),this.extensionType},BITPIX:function(){var a,b,c;if(a=arguments.length>=1?s.call(arguments,0):[],b="BITPIX",c=parseInt(arguments[0]),this.verifyOrder(b,1),8!==c&&16!==c&&32!==c&&-32!==c&&-64!==c)throw""+b+" value "+c+" is not permitted";return c},NAXIS:function(){var a,b,c,d,e,f;if(a=arguments.length>=1?s.call(arguments,0):[],c="NAXIS",e=parseInt(arguments[0]),b=arguments[1],!b&&(this.verifyOrder(c,2),this.verifyBetween(c,e,0,999),this.isExtension()&&("TABLE"===(f=this.extensionType)||"BINTABLE"===f)&&(d=2,e!==d)))throw""+c+" must be "+d+" for TABLE and BINTABLE extensions";return e},PCOUNT:function(){var a,b,c,d,e,f;if(a=arguments.length>=1?s.call(arguments,0):[],b="PCOUNT",e=parseInt(arguments[0]),c=3+this.get("NAXIS"),this.verifyOrder(b,c),this.isExtension()&&("IMAGE"===(f=this.extensionType)||"TABLE"===f)&&(d=0,e!==d))throw""+b+" must be "+d+" for the "+this.extensionType+" extensions";return e},GCOUNT:function(){var a,b,c,d,e,f;if(a=arguments.length>=1?s.call(arguments,0):[],b="GCOUNT",e=parseInt(arguments[0]),c=3+this.get("NAXIS")+1,this.verifyOrder(b,c),this.isExtension()&&("IMAGE"===(f=this.extensionType)||"TABLE"===f||"BINTABLE"===f)&&(d=1,e!==d))throw""+b+" must be "+d+" for the "+this.extensionType+" extensions";return e},EXTEND:function(){var a,b;if(a=arguments.length>=1?s.call(arguments,0):[],b=arguments[0],!this.isPrimary())throw"EXTEND must only appear in the primary header";return this.verifyBoolean(b)},BSCALE:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var a,b;return a=arguments.length>=1?s.call(arguments,0):[],b=arguments[0],this.get("BITPIX")>0||console.warn("BLANK is not to be used for BITPIX = "+this.get("BITPIX")),parseInt(b)},DATAMIN:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])},EXTLEVEL:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])},TFIELDS:function(){var a,b;return a=arguments.length>=1?s.call(arguments,0):[],b=parseInt(arguments[0]),this.verifyBetween("TFIELDS",b,0,999),b},TBCOL:function(){var a,b,c;return a=arguments.length>=1?s.call(arguments,0):[],c=arguments[0],b=arguments[2],this.verifyBetween("TBCOL",b,0,this.get("TFIELDS")),c},ZIMAGE:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],this.verifyBoolean(arguments[0])},ZCMPTYPE:function(){var a,b;if(a=arguments.length>=1?s.call(arguments,0):[],b=arguments[0],"GZIP_1"!==b&&"RICE_1"!==b&&"PLIO_1"!==b&&"HCOMPRESS_1"!==b)throw"ZCMPTYPE value "+b+" is not permitted";if("RICE_1"!==b)throw"Compress type "+b+" is not yet implement";return b},ZBITPIX:function(){var a,b;if(a=arguments.length>=1?s.call(arguments,0):[],b=parseInt(arguments[0]),8!==b&&16!==b&&32!==b&&64!==b&&-32!==b&&-64!==b)throw"ZBITPIX value "+b+" is not permitted";return b},ZNAXIS:function(){var a,b,c;return a=arguments.length>=1?s.call(arguments,0):[],c=parseInt(arguments[0]),b=arguments[1],c=c,b||this.verifyBetween("ZNAXIS",c,0,999),c},ZTILE:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])},ZSIMPLE:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],"T"===arguments[0]?!0:!1},ZPCOUNT:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])},ZGCOUNT:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])},ZDITHER0:function(){var a;return a=arguments.length>=1?s.call(arguments,0):[],parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=i,h=function(a){function b(a){var b,c,d;this.primary=!1,this.extension=!1,this.verifyCard={},d=this.VerifyFns;for(c in d)b=d[c],this.verifyCard[c]=this.proxy(b);this.cards={},this.cards.COMMENT=[],this.cards.HISTORY=[],this.cardIndex=0,this.block=a,this.readBlock(a)}return r(b,a),b.include(i),b.prototype.arrayPattern=/(\D+)(\d+)/,b.prototype.maxLines=600,b.prototype.get=function(a){return this.contains(a)?this.cards[a].value:null},b.prototype.set=function(a,b,c){return c=c||"",this.cards[a]={index:this.cardIndex,value:b,comment:c},this.cardIndex+=1},b.prototype.contains=function(a){return this.cards.hasOwnProperty(a)},b.prototype.readLine=function(a){var b,c,d,e,f,g,h;return f=a.slice(0,8).trim(),(b=""===f)?void 0:(e=a.slice(8,10),g=a.slice(10),"= "!==e?void(("COMMENT"===f||"HISTORY"===f)&&this.cards[f].push(g.trim())):(h=g.split(" /"),g=h[0],c=h[1],g=g.trim(),d=g[0],"'"===d?g=g.slice(1,-1).trim():"T"!==g&&"F"!==g&&(g=parseFloat(g)),g=this.validate(f,g),this.set(f,g,c)))},b.prototype.validate=function(a,b){var c,d,e,f,g;return d=null,c=a,e=this.arrayPattern.test(a),e&&(f=this.arrayPattern.exec(a),g=f.slice(1),c=g[0],d=g[1]),c in this.verifyCard&&(b=this.verifyCard[c](b,e,d)),b},b.prototype.readBlock=function(a){var b,c,d,e,f,g,h;for(d=80,e=a.length/d,e=this.maxLines>e?e:this.maxLines,h=[],b=f=0,g=e-1;g>=0?g>=f:f>=g;b=g>=0?++f:--f)c=a.slice(b*d,(b+1)*d),h.push(this.readLine(c));return h},b.prototype.hasDataUnit=function(){return 0===this.get("NAXIS")?!1:!0},b.prototype.getDataLength=function(){var a,b,c,d,e;if(!this.hasDataUnit())return 0;for(c=[],a=d=1,e=this.get("NAXIS");e>=1?e>=d:d>=e;a=e>=1?++d:--d)c.push(this.get("NAXIS"+a));return b=c.reduce(function(a,b){return a*b})*Math.abs(this.get("BITPIX"))/8,b+=this.get("PCOUNT")},b.prototype.getDataType=function(){switch(this.extensionType){case"BINTABLE":return this.contains("ZIMAGE")?"CompressedImage":"BinaryTable";case"TABLE":return"Table";default:return this.hasDataUnit()?"Image":null}},b.prototype.isPrimary=function(){return this.primary},b.prototype.isExtension=function(){return this.extension},b}(a),this.astro.FITS.Header=h,k={getExtent:function(a){var b,c,d,e;for(b=a.length;b--;)if(e=a[b],!isNaN(e)){d=c=e;break}if(-1===b)return[NaN,NaN];for(;b--;)e=a[b],isNaN(e)||(d>e&&(d=e),e>c&&(c=e));return[d,c]},getPixel:function(a,b,c){return a[c*this.width+b]}},this.astro.FITS.ImageUtils=k,j=function(a){function b(a){var c,d,e,f,g,h,i;for(b.__super__.constructor.apply(this,arguments),f=a.get("NAXIS"),this.bitpix=a.get("BITPIX"),this.naxis=[],e=g=1;f>=1?f>=g:g>=f;e=f>=1?++g:--g)this.naxis.push(a.get("NAXIS"+e));for(this.width=a.get("NAXIS1"),this.height=a.get("NAXIS2")||1,this.depth=a.get("NAXIS3")||1,this.bzero=a.get("BZERO")||0,this.bscale=a.get("BSCALE")||1,this.bytes=Math.abs(this.bitpix)/8,this.length=this.naxis.reduce(function(a,b){return a*b})*Math.abs(this.bitpix)/8,this.frame=0,this.frameOffsets=[],this.frameLength=this.bytes*this.width*this.height,this.nBuffers=null!=this.buffer?1:2,e=h=0,i=this.depth-1;i>=0?i>=h:h>=i;e=i>=0?++h:--h)c=e*this.frameLength,d={begin:c},null!=this.buffer&&(d.buffers=[this.buffer.slice(c,c+this.frameLength)]),this.frameOffsets.push(d)}return r(b,a),b.include(k),b.prototype.allocationSize=16777216,b.prototype._getFrame=function(a,b,c,d){var e,f,g,h,i,j,k,l;if(f=Math.abs(b)/8,i=h=a.byteLength/f,g=Math.abs(b),b>0){switch(b){case 8:k=new Uint8Array(a),k=new Uint16Array(k),j=function(a){return a};break;case 16:k=new Int16Array(a),j=function(a){return(255&a)<<8|255&a>>8};break;case 32:k=new Int32Array(a),j=function(a){return(255&a)<<24|(65280&a)<<8|65280&a>>8|255&a>>24}}for(e=parseInt(c)!==c||parseInt(d)!==d?new Float32Array(k.length):k;i--;)k[i]=j(k[i]),e[i]=c+d*k[i]}else{for(e=new Uint32Array(a),j=function(a){return(255&a)<<24|(65280&a)<<8|65280&a>>8|255&a>>24};h--;)l=e[h],e[h]=j(l);for(e=new Float32Array(a);i--;)e[i]=c+d*e[i]}return e},b.prototype._getFrameAsync=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this;l=function(a){var b,c,d,e,f,g,h;return g=a.data,e=g.buffer,c=g.bitpix,f=g.bzero,d=g.bscale,h=g.url,importScripts(h),b=_getFrame(e,c,f,d),postMessage(b)},g=(""+l).replace("return postMessage","postMessage"),g="onmessage = "+g,h=""+this._getFrame,h=h.replace("function","function _getFrame"),j="application/javascript",f=new Blob([g],{type:j}),e=new Blob([h],{type:j}),d=window.URL||window.webkitURL,p=d.createObjectURL(f),o=d.createObjectURL(e),q=new Worker(p),k={buffer:a[0],bitpix:this.bitpix,bzero:this.bzero,bscale:this.bscale,url:o},i=0,m=null,n=0,q.onmessage=function(e){var f;return f=e.data,null==m&&(m=new f.constructor(r.width*r.height)),m.set(f,n),n+=f.length,i+=1,i===r.nBuffers?(r.invoke(b,c,m),d.revokeObjectURL(p),d.revokeObjectURL(o),q.terminate()):(k.buffer=a[i],q.postMessage(k,[a[i]]))},q.postMessage(k,[a[0]])},b.prototype.getFrame=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=this;if(this.frame=a||this.frame,i=this.frameOffsets[this.frame],g=i.buffers,(null!=g?g.length:void 0)===this.nBuffers)return this._getFrameAsync(g,b,c);for(this.frameOffsets[this.frame].buffers=[],d=i.begin,e=this.blob.slice(d,d+this.frameLength),f=[],k=Math.floor(this.height/this.nBuffers),h=k*this.bytes*this.width,j=n=0,o=this.nBuffers-1;o>=0?o>=n:n>=o;j=o>=0?++n:--n)m=j*h,j===this.nBuffers-1?f.push(e.slice(m)):f.push(e.slice(m,m+h));return g=[],l=new FileReader,l.frame=this.frame,j=0,l.onloadend=function(d){var e;return a=d.target.frame,e=d.target.result,p.frameOffsets[a].buffers.push(e),j+=1,j===p.nBuffers?p.getFrame(a,b,c):l.readAsArrayBuffer(f[j])},l.readAsArrayBuffer(f[0])},b.prototype.getFrames=function(a,b,c,d){var e,f=this;return e=function(d,g){return f.invoke(c,g,d),b-=1,a+=1,b?f.getFrame(a,e,g):void 0},this.getFrame(a,e,d)},b.prototype.isDataCube=function(){return this.naxis.length>2?!0:!1},b}(d),this.astro.FITS.Image=j,n=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.rowByteSize=a.get("NAXIS1"),this.rows=a.get("NAXIS2"),this.cols=a.get("TFIELDS"),this.length=this.rowByteSize*this.rows,this.heapLength=a.get("PCOUNT"),this.columns=this.getColumns(a),null!=this.buffer?(this.rowsInMemory=this._rowsInMemoryBuffer,this.heap=this.buffer.slice(this.length,this.length+this.heapLength)):(this.rowsInMemory=this._rowsInMemoryBlob,this.firstRowInBuffer=this.lastRowInBuffer=0,this.nRowsInBuffer=Math.floor(this.maxMemory/this.rowByteSize)),this.accessors=[],this.descriptors=[],this.elementByteLengths=[],this.setAccessors(a)}return r(b,a),b.prototype.maxMemory=1048576,b.prototype._rowsInMemoryBuffer=function(){return!0},b.prototype._rowsInMemoryBlob=function(a,b){return this.firstRowInBuffer>a?!1:b>this.lastRowInBuffer?!1:!0},b.prototype.getColumns=function(a){var b,c,d,e,f;for(b=[],c=e=1,f=this.cols;f>=1?f>=e:e>=f;c=f>=1?++e:--e){if(d="TTYPE"+c,!a.contains(d))return null;b.push(a.get(d))}return b},b.prototype.getColumn=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;return null!=this.blob?(l=this.columns.indexOf(a),g=this.descriptors[l],d=this.accessors[l],h=this.elementByteLengths[l],i=this.elementByteLengths.slice(0,l),i=0===i.length?0:i.reduce(function(a,b){return a+b}),f=null!=this.typedArray[g]?new this.typedArray[g](this.rows):[],n=~~(this.maxMemory/this.rowByteSize),n=Math.min(n,this.rows),j=this.rows/n,m=Math.floor(j)===j?j:Math.floor(j)+1,k=0,l=0,e=function(a,c){var g,h,j,p;for(g=a.byteLength/o.rowByteSize,p=new DataView(a),h=i;g--;)f[k]=d(p,h)[0],k+=1,h+=o.rowByteSize;return m-=1,l+=1,m?(j=l*n,o.getTableBuffer(j,n,e,c)):void o.invoke(b,c,f)},this.getTableBuffer(0,n,e,c)):(e=function(c,d){return f=c.map(function(b){return b[a]}),o.invoke(b,d,f)},this.getRows(0,this.rows,e,c))},b.prototype.getTableBuffer=function(a,b,c,d){var e,f,g,h,i=this;return b=Math.min(this.rows-a,b),e=a*this.rowByteSize,g=e+b*this.rowByteSize,f=this.blob.slice(e,g),h=new FileReader,h.row=a,h.number=b,h.onloadend=function(a){return i.invoke(c,d,a.target.result)},h.readAsArrayBuffer(f)},b.prototype.getRows=function(a,b,c,d){var e,f,g,h,i,j,k=this;return this.rowsInMemory(a,a+b)?(null!=this.blob?g=this.buffer:(e=a*this.rowByteSize,h=e+b*this.rowByteSize,g=this.buffer.slice(e,h)),j=this._getRows(g,b),this.invoke(c,d,j),j):(e=a*this.rowByteSize,h=e+Math.max(this.nRowsInBuffer*this.rowByteSize,b*this.rowByteSize),f=this.blob.slice(e,h),i=new FileReader,i.row=a,i.number=b,i.onloadend=function(e){var f;return f=e.target,k.buffer=f.result,k.firstRowInBuffer=k.lastRowInBuffer=f.row,k.lastRowInBuffer+=f.number,k.getRows(a,b,c,d)},i.readAsArrayBuffer(f))},b}(d),this.astro.FITS.Tabular=n,m=function(a){function b(){return o=b.__super__.constructor.apply(this,arguments)}return r(b,a),b.prototype.dataAccessors={A:function(a){return a.trim()},I:function(a){return parseInt(a)},F:function(a){return parseFloat(a)},E:function(a){return parseFloat(a)},D:function(a){return parseFloat(a)}},b.prototype.setAccessors=function(a){var b,c,d,e,f,g,h,i,j,k=this;for(f=/([AIFED])(\d+)\.*(\d+)*/,j=[],d=h=1,i=this.cols;i>=1?i>=h:h>=i;d=i>=1?++h:--h)c=a.get("TFORM"+d),g=a.get("TTYPE"+d),e=f.exec(c),b=e[1],j.push(function(a){var b;return b=function(b){return k.dataAccessors[a](b)},k.accessors.push(b)}(b));return j},b.prototype._getRows=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(i=a.byteLength/this.rowByteSize,c=new Uint8Array(a),k=[],f=n=0,s=i-1;s>=0?s>=n:n>=s;f=s>=0?++n:--n){for(d=f*this.rowByteSize,e=d+this.rowByteSize,l=c.subarray(d,e),h="",o=0,q=l.length;q>o;o++)m=l[o],h+=String.fromCharCode(m);for(h=h.trim().split(/\s+/),j={},t=this.accessors,g=p=0,r=t.length;r>p;g=++p)b=t[g],m=h[g],j[this.columns[g]]=b(m);k.push(j)}return k},b}(n),this.astro.FITS.Table=m,b=function(a){function b(){return p=b.__super__.constructor.apply(this,arguments)}return r(b,a),b.prototype.typedArray={B:Uint8Array,I:Uint16Array,J:Uint32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint16Array,4:Uint32Array},b.offsets={L:1,B:1,I:2,J:4,K:8,A:1,E:4,D:8,C:8,M:16},b.prototype.dataAccessors={L:function(a,b){var c,d;return d=a.getInt8(b),b+=1,c=84===d?!0:!1,[c,b]},B:function(a,b){var c;return c=a.getUint8(b),b+=1,[c,b]},I:function(a,b){var c;return c=a.getInt16(b),b+=2,[c,b]},J:function(a,b){
var c;return c=a.getInt32(b),b+=4,[c,b]},K:function(a,b){var c,d,e,f,g;return d=Math.abs(a.getInt32(b)),b+=4,e=Math.abs(a.getInt32(b)),b+=4,f=d%10,c=f?-1:1,d-=f,g=c*(d<<32|e),[g,b]},A:function(a,b){var c;return c=a.getUint8(b),c=String.fromCharCode(c),b+=1,[c,b]},E:function(a,b){var c;return c=a.getFloat32(b),b+=4,[c,b]},D:function(a,b){var c;return c=a.getFloat64(b),b+=8,[c,b]},C:function(a,b){var c,d,e;return d=a.getFloat32(b),b+=4,e=a.getFloat32(b),b+=4,c=[d,e],[c,b]},M:function(a,b){var c,d,e;return d=a.getFloat64(b),b+=8,e=a.getFloat64(b),b+=8,c=[d,e],[c,b]}},b.prototype.toBits=function(a){var b,c;for(b=[],c=128;c>=1;)b.push(a&c?1:0),c/=2;return b},b.prototype.getFromHeap=function(a,b,c){var d,e,f,g,h;for(h=a.getInt32(b),b+=4,e=a.getInt32(b),b+=4,f=this.heap.slice(e,e+h),d=new this.typedArray[c](f),g=d.length;g--;)d[g]=this.constructor.swapEndian[c](d[g]);return[d,b]},b.prototype.setAccessors=function(a){var b,c,d,f,g,h,i,j,k,l,m,n=this;for(i=/(\d*)([P|Q]*)([L|X|B|I|J|K|A|E|D|C|M]{1})/,m=[],f=k=1,l=this.cols;l>=1?l>=k:k>=l;f=l>=1?++k:--k)d=a.get("TFORM"+f),j=a.get("TTYPE"+f),h=i.exec(d),b=parseInt(h[1])||1,g=h[2],c=h[3],m.push(function(a,b){var c,d;if(n.descriptors.push(a),n.elementByteLengths.push(n.constructor.offsets[a]*b),g)switch(j){case"COMPRESSED_DATA":c=function(b,c){var d,f,g;return g=n.getFromHeap(b,c,a),d=g[0],c=g[1],f=new n.typedArray[n.algorithmParameters.BYTEPIX](n.ztile[0]),e.Rice(d,n.algorithmParameters.BLOCKSIZE,n.algorithmParameters.BYTEPIX,f,n.ztile[0],e.RiceSetup),[f,c]};break;case"GZIP_COMPRESSED_DATA":c=function(a,b){var c;for(c=new Float32Array(n.width),f=c.length;f--;)c[f]=NaN;return[c,b]};break;default:c=function(b,c){return n.getFromHeap(b,c,a)}}else 1===b?c=function(b,c){var d,e;return e=n.dataAccessors[a](b,c),d=e[0],c=e[1],[d,c]}:"X"===a?(d=Math.log(b)/Math.log(2),c=function(a,c){var e,f,g,h,i,j,k;for(g=a.buffer.slice(c,c+d),i=new Uint8Array(g),f=[],j=0,k=i.length;k>j;j++)h=i[j],e=n.toBits(h),f=f.concat(e);return c+=d,[f.slice(0,+(b-1)+1||9e9),c]}):c="A"===a?function(a,c){var d,e,f,g,h,i;for(e=a.buffer.slice(c,c+b),d=new Uint8Array(e),f="",h=0,i=d.length;i>h;h++)g=d[h],f+=String.fromCharCode(g);return f=f.trim(),c+=b,[f,c]}:function(c,d){var e,g,h;for(f=b,e=[];f--;)h=n.dataAccessors[a](c,d),g=h[0],d=h[1],e.push(g);return[e,d]};return n.accessors.push(c)}(c,b));return m},b.prototype._getRows=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;for(i=new DataView(a),e=0,g=[];b--;){for(f={},l=this.accessors,d=j=0,k=l.length;k>j;d=++j)c=l[d],m=c(i,e),h=m[0],e=m[1],f[this.columns[d]]=h;g.push(f)}return g},b}(n),this.astro.FITS.BinaryTable=b,e={RiceSetup:{1:function(a){var b,c,d,e;return e=1,b=3,c=6,d=a[0],[b,c,d,e]},2:function(a){var b,c,d,e,f;return f=2,c=4,d=14,e=0,b=a[0],e|=b<<8,b=a[1],e|=b,[c,d,e,f]},4:function(a){var b,c,d,e,f;return f=4,c=5,d=25,e=0,b=a[0],e|=b<<24,b=a[1],e|=b<<16,b=a[2],e|=b<<8,b=a[3],e|=b,[c,d,e,f]}},Rice:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(h=1<<k,u=f[c](a),k=u[0],l=u[1],p=u[2],t=u[3],r=new Uint8Array(256),s=8,v=[128,255],o=v[0],m=v[1];m>=0;){for(;m>=o;)r[m]=s,m-=1;o/=2,s-=1}for(r[0]=0,g=a[t++],q=8,m=0;e>m;){for(q-=k;0>q;)g=g<<8|a[t++],q+=8;if(j=(g>>q)-1,g&=(1<<q)-1,n=m+b,n>e&&(n=e),0>j)for(;n>m;)d[m]=p,m+=1;else if(j===l)for(;n>m;){for(o=h-q,i=g<<o,o-=8;o>=0;)g=a[t++],i|=g<<o,o-=8;q>0?(g=a[t++],i|=g>>-o,g&=(1<<q)-1):g=0,0===(1&i)?i>>=1:i=~(i>>1),d[m]=i+p,p=d[m],m++}else for(;n>m;){for(;0===g;)q+=8,g=a[t++];for(s=q-r[g],q-=s+1,g^=1<<q,q-=j;0>q;)g=g<<8|a[t++],q+=8;i=s<<j|g>>q,g&=(1<<q)-1,0===(1&i)?i>>=1:i=~(i>>1),d[m]=i+p,p=d[m],m++}}return d}},this.astro.FITS.Decompress=e,c=function(a){function b(a){var c,d,e,f,g,h;for(b.__super__.constructor.apply(this,arguments),this.zcmptype=a.get("ZCMPTYPE"),this.zbitpix=a.get("ZBITPIX"),this.znaxis=a.get("ZNAXIS"),this.zblank=a.get("ZBLANK"),this.blank=a.get("BLANK"),this.zdither=a.get("ZDITHER0")||0,this.ztile=[],c=g=1,h=this.znaxis;h>=1?h>=g:g>=h;c=h>=1?++g:--g)f=a.contains("ZTILE"+c)?a.get("ZTILE"+c):1===c?a.get("ZNAXIS1"):1,this.ztile.push(f);for(this.width=a.get("ZNAXIS1"),this.height=a.get("ZNAXIS2")||1,this.algorithmParameters={},"RICE_1"===this.zcmptype&&(this.algorithmParameters.BLOCKSIZE=32,this.algorithmParameters.BYTEPIX=4),c=1;d="ZNAME"+c,a.contains(d);)e="ZVAL"+c,this.algorithmParameters[a.get(d)]=a.get(e),c+=1;this.zmaskcmp=a.get("ZMASKCMP"),this.zquantiz=a.get("ZQUANTIZ")||"LINEAR_SCALING",this.bzero=a.get("BZERO")||0,this.bscale=a.get("BSCALE")||1}return r(b,a),b.include(k),b.extend(e),b.randomGenerator=function(){var a,b,c,d,e,f,g;for(a=16807,c=2147483647,e=1,d=new Float32Array(1e4),b=g=0;9999>=g;b=++g)f=a*e,e=f-c*parseInt(f/c),d[b]=e/c;return d},b.randomSequence=b.randomGenerator(),b.prototype._getRows=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(r=new DataView(a),j=0,d=new Float32Array(this.width*this.height);b--;){for(m={},x=this.accessors,h=t=0,v=x.length;v>t;h=++t)c=x[h],y=c(r,j),q=y[0],j=y[1],m[this.columns[h]]=q;for(f=m.COMPRESSED_DATA||m.UNCOMPRESSED_DATA||m.GZIP_COMPRESSED_DATA,e=m.ZBLANK||this.zblank,n=m.ZSCALE||this.bscale,s=m.ZZERO||this.bzero,i=this.height-b,o=i+this.zdither-1,p=(o-1)%1e4,l=parseInt(500*this.constructor.randomSequence[p]),h=u=0,w=f.length;w>u;h=++u)q=f[h],g=(i-1)*this.width+h,-2147483647===q?d[g]=NaN:-2147483646===q?d[g]=0:(k=this.constructor.randomSequence[l],d[g]=(q-k+.5)*n+s),l+=1,1e4===l&&(p=(p+1)%1e4,l=parseInt(500*this.randomSequence[p]))}return d},b.prototype.getFrame=function(a,b,c){var d,e,f=this;return this.heap?(this.frame=a||this.frame,this.getRows(0,this.rows,b,c)):(d=this.blob.slice(this.length,this.length+this.heapLength),e=new FileReader,e.onloadend=function(d){return f.heap=d.target.result,f.getFrame(a,b,c)},e.readAsArrayBuffer(d))},b}(b),this.astro.FITS.CompressedImage=c,g=function(){function a(a,b){this.header=a,this.data=b}return a.prototype.hasData=function(){return null!=this.data?!0:!1},a}(),this.astro.FITS.HDU=g}.call(this),MOC=function(){function a(a){return Math.log(a)/Math.LN2}MOC=function(a){this.norder=void 0,this._highResCells={},this._lowResCells={},a=a||{},this.name=a.name||"MOC",this.color=a.color||Color.getNextColor(),this.lineWidth=a.lineWidth||1,this.isShowing=!0},MOC.MAX_NORDER=13,MOC.LOWRES_MAXORDER=5,MOC.HIGHRES_MAXORDER=11,MOC.PIVOT_FOV=20,MOC.prototype.dataFromURL=function(b,c){var d=this,e=function(){var b;try{b=this.getHeader(0)}catch(e){return void console.err("Could not get header of extension #0")}var f=this.getHeader(1);if(b.contains("HPXMOC"))d.order=b.get("HPXMOC");else if(b.contains("MOCORDER"))d.order=b.get("MOCORDER");else if(f.contains("HPXMOC"))d.order=f.get("HPXMOC");else{if(!f.contains("MOCORDER"))return void console.err("Can not find MOC order in FITS file");d.order=f.get("MOCORDER")}var g=this.getDataUnit(1),h=g.columns[0];g.getRows(0,g.rows,function(b){for(var c=0;b.length>c;c++){var e=b[c][h],f=Math.floor(Math.floor(a(Math.floor(e/4)))/2),g=e-4*Math.pow(4,f);if(MOC.LOWRES_MAXORDER>=f)f in d._lowResCells||(d._lowResCells[f]=[],d._highResCells[f]=[]),d._lowResCells[f].push(g),d._highResCells[f].push(g);else if(MOC.HIGHRES_MAXORDER>=f){f in d._highResCells||(d._highResCells[f]=[]),d._highResCells[f].push(g);var i=MOC.LOWRES_MAXORDER,j=Math.floor(g/Math.pow(4,f-i));i in d._lowResCells||(d._lowResCells=[]),d._lowResCells[i].push(j)}else{var i=MOC.LOWRES_MAXORDER,j=Math.floor(g/Math.pow(4,f-i));i in d._lowResCells||(d._lowResCells=[]),d._lowResCells[i].push(j),i=MOC.HIGHRES_MAXORDER,j=Math.floor(g/Math.pow(4,f-i)),i in d._highResCells||(d._highResCells=[]),d._highResCells[i].push(j)}}}),g=null,c&&c()};this.dataURL=b;var f=Aladin.JSONP_PROXY+"?url="+encodeURIComponent(this.dataURL);new astro.FITS(f,e)},MOC.prototype.setView=function(a){this.view=a},MOC.prototype.draw=function(a,b,c,d,e,f,g,h){if(this.isShowing){var i=h>MOC.PIVOT_FOV?this._lowResCells:this._highResCells;this._drawCells(a,i,h,b,c,CooFrameEnum.J2000,d,e,f,g)}},MOC.prototype._drawCells=function(a,d,e,f,g,h,i,j,k,l){a.lineWidth=this.lineWidth,a.strokeStyle=this.color,a.beginPath();var m=[];for(key in d)m.push(key);m.sort();var n,o,p;if(e>80)for(var q,r=0;m.length>r;r++){q=parseInt(m[r]),n=1<<q;for(var s=0;d[q].length>s;s++)if(p=d[q][s],q>=3)o=c(n,p,g,h,i,j,k,l,f),o&&b(a,o);else for(var t=Math.pow(4,3-q),u=p*t,v=0;t>v;v++)o=c(8,u+v,g,h,i,j,k,l,f),o&&b(a,o)}else{this.view.getVisiblePixList(3,CooFrameEnum.J2000);for(var w={},x=parseInt(m[m.length-1]),q=1;x>=q;q++)if(n=1<<q,3>=q)for(var s=0;d[q].length>s;s++){p=d[q][s];for(var t=Math.pow(4,3-q),u=p*t,v=0;t>v;v++)norder3Ipix=u+v,o=c(8,norder3Ipix,g,h,i,j,k,l,f),o&&b(a,o),w[norder3Ipix]=1}else for(var s=0;d[q].length>s;s++){p=d[q][s];var y=Math.floor(p/Math.pow(4,q-3));y in w||(o=c(n,p,g,h,i,j,k,l,f),o&&b(a,o))}}a.stroke()};var b=function(a,b){a.moveTo(b[0].vx,b[0].vy),a.lineTo(b[1].vx,b[1].vy),a.lineTo(b[2].vx,b[2].vy),a.lineTo(b[3].vx,b[3].vy),a.lineTo(b[0].vx,b[0].vy)},c=function(a,b,c,d,e,f,g,h,i){for(var j=[],k=[],l=new SpatialVector,m=HealpixCache.corners_nest(b,a),n=0;4>n;n++){if(l.setXYZ(m[n].x,m[n].y,m[n].z),d&&d!=c){if(d==CooFrameEnum.J2000){var o=CooConversion.J2000ToGalactic([l.ra(),l.dec()]);lon=o[0],lat=o[1]}else if(d==CooFrameEnum.GAL){var o=CooConversion.GalacticToJ2000([l.ra(),l.dec()]);lon=o[0],lat=o[1]}}else lon=l.ra(),lat=l.dec();k[n]=i.project(lon,lat)}if(null==k[0]||null==k[1]||null==k[2]||null==k[3])return null;for(var n=0;4>n;n++)j[n]=AladinUtils.xyToView(k[n].X,k[n].Y,e,f,g,h);return 0>j[0].vx&&0>j[1].vx&&0>j[2].vx&&0>j[3].vx?null:0>j[0].vy&&0>j[1].vy&&0>j[2].vy&&0>j[3].vy?null:j[0].vx>=e&&j[1].vx>=e&&j[2].vx>=e&&j[3].vx>=e?null:j[0].vy>=f&&j[1].vy>=f&&j[2].vy>=f&&j[3].vy>=f?null:j};return MOC.prototype.reportChange=function(){this.view.requestRedraw()},MOC.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},MOC.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},MOC}(),CooGrid=function(){function a(a,b,c,d,e,f,g){var h,i=AladinUtils.viewToXy(b,c,d,e,f,g);try{h=a.unproject(i.x,i.y)}catch(j){return null}return{lon:h.ra,lat:h.dec}}var b=function(){};return b.prototype.redraw=function(b,c,d,e,f,g,h,i){if(!(i>60)){var j=0,k=359.9999,l=-90,m=90,n=a(c,0,0,e,f,g,h),o=a(c,e-1,f-1,e,f,g,h);k=Math.min(n.lon,o.lon),j=Math.max(n.lon,o.lon),m=Math.min(n.lat,o.lat),l=Math.max(n.lat,o.lat);var p=a(c,0,f-1,e,f,g,h);k=Math.min(k,p.lon),j=Math.max(j,p.lon),m=Math.min(m,p.lat),l=Math.max(l,p.lat);var q=a(c,e-1,0,e,f,g,h);k=Math.min(k,q.lon),j=Math.max(j,q.lon),m=Math.min(m,q.lat),l=Math.max(l,q.lat);var r,s,t=j-k,u=l-m;i>10?(r=4,s=4):i>1?(r=1,s=1):i>.1?(r=.1,s=.1):(r=.01,s=.01);var v=Math.round(k%r)*r,w=Math.round(m%s)*s;b.lineWidth=1,b.strokeStyle="rgb(120,120,255)";for(var x=w;l+s>x;x+=s){b.beginPath();var y;if(y=AladinUtils.radecToViewXy(k,x,c,CooFrameEnum.J2000,e,f,g,h)){b.moveTo(y.vx,y.vy);for(var z=0,A=k;j+r>A;A+=t/10)z++,y=AladinUtils.radecToViewXy(A,x,c,CooFrameEnum.J2000,e,f,g,h),b.lineTo(y.vx,y.vy),3==z&&b.strokeText(x.toFixed(2),y.vx,y.vy-2);b.stroke()}}for(var A=v;j+r>A;A+=r){b.beginPath();var y;if(y=AladinUtils.radecToViewXy(A,m,c,CooFrameEnum.J2000,e,f,g,h)){b.moveTo(y.vx,y.vy);for(var z=0,x=m;l+s>x;x+=u/10)z++,y=AladinUtils.radecToViewXy(A,x,c,CooFrameEnum.J2000,e,f,g,h),b.lineTo(y.vx,y.vy),3==z&&b.strokeText(A.toFixed(2),y.vx,y.vy-2);b.stroke()}}}},b}(),Footprint=function(){return Footprint=function(a){this.polygons=a,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Footprint.prototype.setOverlay=function(a){this.overlay=a},Footprint.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Footprint.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Footprint}(),Popup=function(){return Popup=function(a){this.domEl=$('<div class="aladin-popup-container"><div class="aladin-popup"><a class="aladin-closeBtn">&times;</a><div class="aladin-popupTitle"></div><div class="aladin-popupText"></div></div><div class="aladin-popup-arrow"></div></div>'),this.domEl.appendTo(a);var b=this;this.domEl.find(".aladin-closeBtn").click(function(){b.hide()})},Popup.prototype.hide=function(){this.domEl.hide()},Popup.prototype.show=function(){this.domEl.show()},Popup.prototype.setTitle=function(a){this.domEl.find(".aladin-popupTitle").html(a||"")},Popup.prototype.setText=function(a){this.domEl.find(".aladin-popupText").html(a||""),this.w=this.domEl.outerWidth(),this.h=this.domEl.outerHeight()},Popup.prototype.setSource=function(a){this.source&&(this.source.popup=null),a.popup=this,this.source=a,this.setPosition(a.x,a.y)},Popup.prototype.setPosition=function(a,b){var c=a-this.w/2,d=b-this.h+this.source.catalog.sourceSize/2;this.domEl[0].style.left=c+"px",this.domEl[0].style.top=d+"px"},Popup}(),Circle=function(){return Circle=function(a,b,c){c=c||{},this.color=c.color||void 0,this.setCenter(a),this.setRadius(b),this.overlay=null,this.isShowing=!0,this.isSelected=!1},Circle.prototype.setOverlay=function(a){this.overlay=a},Circle.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.setCenter=function(a){this.centerRaDec=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.setRadius=function(a){this.radiusDegrees=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.draw=function(a,b,c,d,e,f,g){if(this.isShowing){var h;if(c!=CooFrameEnum.J2000){var i=CooConversion.J2000ToGalactic([this.centerRaDec[0],this.centerRaDec[1]]);h=b.project(i[0],i[1])}else h=b.project(this.centerRaDec[0],this.centerRaDec[1]);if(h){var j,k=AladinUtils.xyToView(h.X,h.Y,d,e,f,g,!0),l=this.centerRaDec[0],m=this.centerRaDec[1]+(l>0?-this.radiusDegrees:this.radiusDegrees);if(c!=CooFrameEnum.J2000){var i=CooConversion.J2000ToGalactic([l,m]);j=b.project(i[0],i[1])}else j=b.project(l,m);if(j){var n=AladinUtils.xyToView(j.X,j.Y,d,e,f,g,!0),o=n.vx-k.vx,p=n.vy-k.vy,q=Math.sqrt(o*o+p*p);this.color&&(a.strokeStyle=this.color),a.beginPath(),a.arc(k.vx,k.vy,q,0,2*Math.PI,!1),a.stroke()}}}},Circle}(),Polyline=function(){return Polyline=function(a,b){b=b||{},this.color=b.color||void 0,this.radecArray=a,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Polyline.prototype.setOverlay=function(a){this.overlay=a},Polyline.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.draw=function(a,b,c,d,e,f,g){if(this.isShowing&&this.radecArray&&!(2>this.radecArray.length)){this.color&&(a.strokeStyle=this.color);var h=AladinUtils.radecToViewXy(this.radecArray[0][0],this.radecArray[0][1],b,c,d,e,f,g);if(h){a.moveTo(h.vx,h.vy);for(var i,j=1;this.radecArray.length>j&&(i=AladinUtils.radecToViewXy(this.radecArray[j][0],this.radecArray[j][1],b,c,d,e,f,g));j++)a.lineTo(i.vx,i.vy);a.stroke()}}},Polyline}(),Overlay=function(){return Overlay=function(a){a=a||{},this.name=a.name||"overlay",this.color=a.color||Color.getNextColor(),this.lineWidth=a.lineWidth||2,this.overlays=[],this.overlay_items=[],this.isShowing=!0},Overlay.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},Overlay.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},Overlay.parseSTCS=function(a){for(var b,c=[],d=a.match(/\S+/g),e=0,f=d.length;f>e;){var g=d[e].toLowerCase();if("polygon"==g&&(b=[],e++,frame=d[e].toLowerCase(),"icrs"==frame||"j2000"==frame)){for(;f>e+2;){var h=parseFloat(d[e+1]);if(isNaN(h))break;var i=parseFloat(d[e+2]);b.push([h,i]),e+=2}b.push(b[0]),c.push(b)}e++}return c},Overlay.prototype.addFootprints=function(a){this.overlays=this.overlays.concat(a);for(var b=0,c=a.length;c>b;b++)a[b].setOverlay(this);this.view.requestRedraw()},Overlay.prototype.add=function(a){this.overlay_items.push(a),a.setOverlay(this),this.view.requestRedraw()},Overlay.prototype.getFootprint=function(a){return this.footprints.length>a?this.footprints[a]:null},Overlay.prototype.setView=function(a){this.view=a},Overlay.prototype.removeAll=function(){this.overlays=[],this.overlay_items=[]},Overlay.prototype.draw=function(a,b,c,d,e,f,g){if(this.isShowing){a.strokeStyle=this.color,a.lineWidth=this.lineWidth,a.beginPath(),xyviews=[];for(var h=0,i=this.overlays.length;i>h;h++)xyviews.push(this.drawFootprint(this.overlays[h],a,b,c,d,e,f,g));a.stroke(),a.strokeStyle=Overlay.increase_brightness(this.color,80),a.beginPath();for(var h=0,i=this.overlays.length;i>h;h++)this.overlays[h].isSelected&&this.drawFootprintSelected(a,xyviews[h]);a.stroke();for(var h=0;this.overlay_items.length>h;h++)this.overlay_items[h].draw(a,b,c,d,e,f,g)}},Overlay.increase_brightness=function(a,b){a=a.replace(/^\s*#|\s*$/g,""),3==a.length&&(a=a.replace(/(.)/g,"$1$1"));var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return"#"+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)},Overlay.prototype.drawFootprint=function(a,b,c,d,e,f,g,h){if(!a.isShowing)return null;for(var i=[],j=!1,k=a.polygons,l=0,m=k.length;m>l;l++){var n;if(d!=CooFrameEnum.J2000){var o=CooConversion.J2000ToGalactic([k[l][0],k[l][1]]);n=c.project(o[0],o[1])}else n=c.project(k[l][0],k[l][1]);if(!n)return null;var p=AladinUtils.xyToView(n.X,n.Y,e,f,g,h);i.push(p),!j&&e>p.vx&&p.vx>=0&&f>=p.vy&&p.vy>=0&&(j=!0)}if(j){b.moveTo(i[0].vx,i[0].vy);for(var l=1,m=i.length;m>l;l++)b.lineTo(i[l].vx,i[l].vy)}return i},Overlay.prototype.drawFootprintSelected=function(a,b){if(b){var c=b;a.moveTo(c[0].vx,c[0].vy);for(var d=1,e=c.length;e>d;d++)a.lineTo(c[d].vx,c[d].vy)}},Overlay.prototype.reportChange=function(){this.view.requestRedraw()},Overlay}(),cds.Source=function(){return cds.Source=function(a,b,c,d){this.ra=a,this.dec=b,this.data=c,this.catalog=null,this.marker=d&&d.marker||!1,this.marker&&(this.popupTitle=d&&d.popupTitle?d.popupTitle:"",this.popupDesc=d&&d.popupDesc?d.popupDesc:""),this.isShowing=!0,this.isSelected=!1},cds.Source.prototype.setCatalog=function(a){this.catalog=a},cds.Source.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.actionClicked=function(){if(this.catalog&&this.catalog.onClick){var a=this.catalog.view;if("showTable"==this.catalog.onClick)a.aladin.measurementTable.showMeasurement(this),this.select();else if("showPopup"==this.catalog.onClick){a.popup.setTitle("<br><br>");var b='<div class="aladin-marker-measurement">';b+="<table>";for(var c in this.data)b+="<tr><td>"+c+"</td><td>"+this.data[c]+"</td></tr>";b+="</table>",b+="</div>",a.popup.setText(b),a.popup.setSource(this),a.popup.show()}}},cds.Source.prototype.actionOtherObjectClicked=function(){this.catalog&&this.catalog.onClick&&"showTable"==this.catalog.onClick&&this.deselect()},cds.Source}(),ProgressiveCat=function(){function a(a,b){var c=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],d=[],e=0;return a.keyRa=a.keyDec=null,$(b).find("FIELD").each(function(){for(var b={},f=0;c.length>f;f++){var g=c[f];$(this).attr(g)&&(b[g]=$(this).attr(g))}b.ID||(b.ID="col_"+e),a.keyRa||!b.ucd||0!=b.ucd.indexOf("pos.eq.ra")&&0!=b.ucd.indexOf("POS_EQ_RA")||(a.keyRa=b.name?b.name:b.ID),a.keyDec||!b.ucd||0!=b.ucd.indexOf("pos.eq.dec")&&0!=b.ucd.indexOf("POS_EQ_DEC")||(a.keyDec=b.name?b.name:b.ID),d.push(b),e++}),d}function b(a,b,c){if(!a.keyRa||!a.keyDec)return[];lines=b.split("\n");for(var d=[],e=0;c.length>e;e++)c[e].name?d.push(c[e].name):d.push(c[e].ID);for(var f=[],g=new Coo,h=2;lines.length>h;h++){var i={},j=lines[h].split("	");if(!(j.length<d.length)){for(var k=0;d.length>k;k++)i[d[k]]=j[k];var l,m;Utils.isNumber(i[a.keyRa])&&Utils.isNumber(i[a.keyDec])?(l=parseFloat(i[a.keyRa]),m=parseFloat(i[a.keyDec])):(g.parse(i[a.keyRa]+" "+i[a.keyDec]),l=g.lon,m=g.lat),f.push(new cds.Source(l,m,i))}}return f}return ProgressiveCat=function(a,b,c,d){d=d||{},this.type="progressivecat",this.rootUrl=a,this.frame=CooFrameEnum.fromString(b)||CooFrameEnum.J2000,this.maxOrder=c,this.isShowing=!0,this.name=d.name||"progressive-cat",this.color=d.color||Color.getNextColor(),this.sourceSize=d.sourceSize||10,this.sourcesCache=new Utils.LRUCache(100),this.cacheCanvas=document.createElement("canvas"),this.cacheCanvas.width=this.sourceSize,this.cacheCanvas.height=this.sourceSize;var e=this.cacheCanvas.getContext("2d");e.beginPath(),e.strokeStyle=this.color,e.lineWidth=2,e.moveTo(0,0),e.lineTo(0,this.sourceSize),e.lineTo(this.sourceSize,this.sourceSize),e.lineTo(this.sourceSize,0),e.lineTo(0,0),e.stroke()},ProgressiveCat.prototype={init:function(a){this.view=a,this.level3Sources||this.loadLevel2Sources()},loadLevel2Sources:function(){var c=this;$.ajax({url:c.rootUrl+"/Norder2/Allsky.xml",method:"GET",success:function(d){c.fields=a(c,d),c.level2Sources=b(c,$(d).find("CSV").text(),c.fields),c.loadLevel3Sources()},error:function(a){console.log("Something went wrong: "+a)}})},loadLevel3Sources:function(){var a=this;$.ajax({url:a.rootUrl+"/Norder3/Allsky.xml",method:"GET",success:function(c){a.level3Sources=b(a,$(c).find("CSV").text(),a.fields),a.view.requestRedraw()},error:function(a){console.log("Something went wrong: "+a)}})},draw:function(a,b,c,d,e,f,g){if(this.isShowing&&this.level3Sources&&(this.drawSources(this.level2Sources,a,b,c,d,e,f,g),this.drawSources(this.level3Sources,a,b,c,d,e,f,g),this.tilesInView))for(var h,i,j,k=0;this.tilesInView.length>k;k++)j=this.tilesInView[k],i=j[0]+"-"+j[1],h=this.sourcesCache.get(i),h&&this.drawSources(h,a,b,c,d,e,f,g)},drawSources:function(a,b,c,d,e,f,g,h){for(var i=0,j=a.length;j>i;i++)this.drawSource(a[i],b,c,d,e,f,g,h)},getSources:function(){var a=[];if(this.level2Sources&&(a=a.concat(this.level2Sources)),this.level3Sources&&(a=a.concat(this.level3Sources)),this.tilesInView)for(var b,c,d,e=0;this.tilesInView.length>e;e++)d=this.tilesInView[e],c=d[0]+"-"+d[1],b=this.sourcesCache.get(c),b&&(a=a.concat(b));return a},drawSource:function(a,b,c,d,e,f,g,h){if(a.isShowing){var i,j=this.sourceSize;if(d!=CooFrameEnum.J2000){var k=CooConversion.J2000ToGalactic([a.ra,a.dec]);i=c.project(k[0],k[1])}else i=c.project(a.ra,a.dec);if(i){var l=AladinUtils.xyToView(i.X,i.Y,e,f,g,h);if(l){if(l.vx>e+j||0-j>l.vx||l.vy>f+j||0-j>l.vy)return void(a.x=a.y=void 0);a.x=l.vx,a.y=l.vy,b.drawImage(this.cacheCanvas,a.x-j/2,a.y-j/2)}}}},deselectAll:function(){for(var a=0;this.level2Sources.length>a;a++)this.level2Sources[a].deselect();for(var a=0;this.level3Sources.length>a;a++)this.level3Sources[a].deselect();var b=this.sourcesCache.keys();for(key in b)if(this.sourcesCache[key])for(var c=this.sourcesCache[key],a=0;c.length>a;a++)c[a].deselect()},show:function(){this.isShowing||(this.isShowing=!0,this.reportChange())},hide:function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},reportChange:function(){this.view.requestRedraw()},getTileURL:function(a,b){var c=1e4*Math.floor(b/1e4);return this.rootUrl+"/Norder"+a+"/Dir"+c+"/Npix"+b+".tsv"},loadNeededTiles:function(){this.tilesInView=[],this.otherSources=[];var a=this.view.realNorder;if(a>this.maxOrder&&(a=this.maxOrder),!(3>=a)){for(var c,d,e=this.view.getVisibleCells(a,this.frame),f=4;a>=f;f++){c=[];for(var g=0;e.length>g;g++)d=Math.floor(e[g].ipix/Math.pow(4,a-f)),0>c.indexOf(d)&&c.push(d);for(var h=0;c.length>h;h++)this.tilesInView.push([f,c[h]])}for(var i,j,g=0;this.tilesInView.length>g;g++)i=this.tilesInView[g],j=i[0]+"-"+i[1],this.sourcesCache.get(j)||function(a,c,d){var e=c+"-"+d;$.ajax({url:a.getTileURL(c,d),method:"GET",success:function(c){a.sourcesCache.set(e,b(a,c,a.fields)),a.view.requestRedraw()},error:function(){a.sourcesCache.set(e,[])}})}(this,i[0],i[1])}}},ProgressiveCat}(),cds.Catalog=function(){return cds.Catalog=function(a){a=a||{},this.type="catalog",this.name=a.name||"catalog",this.color=a.color||Color.getNextColor(),this.sourceSize=a.sourceSize||6,this.markerSize=a.sourceSize||12,this.shape=a.shape||"square",this.maxNbSources=a.limit||void 0,this.onClick=a.onClick||void 0,this.displayLabel=a.displayLabel||!1,this.labelColor=a.labelColor||this.color,this.labelFont=a.labelFont||"10px sans-serif",this.displayLabel&&(this.labelColumn=a.labelColumn,this.labelColumn||(this.displayLabel=!1)),this.shape instanceof Image&&(this.sourceSize=this.shape.width),this.selectSize=this.sourceSize+2,this.isShowing=!0,this.indexationNorder=5,this.sources=[],this.hpxIdx=new HealpixIndex(this.indexationNorder),this.hpxIdx.init(),this.selectionColor="#00ff00",this.cacheCanvas=cds.Catalog.createShape(this.shape,this.color,this.sourceSize),this.cacheMarkerCanvas=document.createElement("canvas"),this.cacheMarkerCanvas.width=this.markerSize,this.cacheMarkerCanvas.height=this.markerSize;var b=this.cacheMarkerCanvas.getContext("2d");b.fillStyle=this.color,b.beginPath();var c=this.markerSize/2;b.arc(c,c,c-2,0,2*Math.PI,!1),b.fill(),b.lineWidth=2,b.strokeStyle="#ccc",b.stroke(),this.cacheSelectCanvas=document.createElement("canvas"),this.cacheSelectCanvas.width=this.selectSize,this.cacheSelectCanvas.height=this.selectSize;var d=this.cacheSelectCanvas.getContext("2d");d.beginPath(),d.strokeStyle=this.selectionColor,d.lineWidth=2,d.moveTo(0,0),d.lineTo(0,this.selectSize),d.lineTo(this.selectSize,this.selectSize),d.lineTo(this.selectSize,0),d.lineTo(0,0),d.stroke()},cds.Catalog.createShape=function(a,b,c){if(a instanceof Image)return a;var d=document.createElement("canvas");d.width=d.height=c;var e=d.getContext("2d");return e.beginPath(),e.strokeStyle=b,e.lineWidth=2,"plus"==a?(e.moveTo(c/2,0),e.lineTo(c/2,c),e.stroke(),e.moveTo(0,c/2),e.lineTo(c,c/2),e.stroke()):"cross"==a?(e.moveTo(0,0),e.lineTo(c-1,c-1),e.stroke(),e.moveTo(c-1,0),e.lineTo(0,c-1),e.stroke()):"rhomb"==a?(e.moveTo(c/2,0),e.lineTo(0,c/2),e.lineTo(c/2,c),e.lineTo(c,c/2),e.lineTo(c/2,0),e.stroke()):"triangle"==a?(e.moveTo(c/2,0),e.lineTo(0,c-1),e.lineTo(c-1,c-1),e.lineTo(c/2,0),e.stroke()):(e.moveTo(0,0),e.lineTo(0,c),e.lineTo(c,c),e.lineTo(c,0),e.lineTo(0,0),e.stroke()),d},cds.Catalog.parseVOTable=function(a,b,c){function d(a,b){a=a.replace(/^\s+/g,"");var d=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],e=[],f=0;$(a).find("FIELD").each(function(){for(var a={},b=0;d.length>b;b++){var c=d[b];$(this).attr(c)&&(a[c]=$(this).attr(c))}a.ID||(a.ID="col_"+f),e.push(a),f++});var g,h;g=h=null;for(var i=0,j=e.length;j>i;i++){var k=e[i];if(!g&&k.ucd){var l=k.ucd.toLowerCase();if(l.indexOf("pos.eq.ra")>=0||l.indexOf("pos_eq_ra")>=0){g=i;continue}}if(!h&&k.ucd){var l=k.ucd.toLowerCase();if(l.indexOf("pos.eq.dec")>=0||l.indexOf("pos_eq_dec")>=0){h=i;continue}}}var m,n,o=[],p=new Coo;$(a).find("TR").each(function(){var a={},b=0;$(this).find("TD").each(function(){var c=e[b].name?e[b].name:e[b].id;a[c]=$(this).text(),b++});var d=e[g].name?e[g].name:e[g].id,f=e[h].name?e[h].name:e[h].id;return Utils.isNumber(a[d])&&Utils.isNumber(a[f])?(m=parseFloat(a[d]),n=parseFloat(a[f])):(p.parse(a[d]+" "+a[f]),m=p.lon,n=p.lat),o.push(new cds.Source(m,n,a)),c&&o.length==c?!1:void 0}),b&&b(o)}$.ajax({url:Aladin.JSONP_PROXY,data:{url:a},method:"GET",dataType:"text",success:function(a){d(a,b)}})},cds.Catalog.prototype.addSources=function(a){this.sources=this.sources.concat(a);for(var b=0,c=a.length;c>b;b++)a[b].setCatalog(this);this.view.requestRedraw()},cds.Catalog.prototype.getSources=function(){return this.sources},cds.Catalog.prototype.selectAll=function(){if(this.sources)for(var a=0;this.sources.length>a;a++)this.sources[a].select()},cds.Catalog.prototype.deselectAll=function(){if(this.sources)for(var a=0;this.sources.length>a;a++)this.sources[a].deselect()},cds.Catalog.prototype.getSource=function(a){return this.sources.length>a?this.sources[a]:null},cds.Catalog.prototype.setView=function(a){this.view=a},cds.Catalog.prototype.removeAll=cds.Catalog.prototype.clear=function(){this.sources=[]},cds.Catalog.prototype.draw=function(a,b,c,d,e,f,g){if(this.isShowing){for(var h=0,i=this.sources.length;i>h;h++)this.drawSource(this.sources[h],a,b,c,d,e,f,g);a.strokeStyle=this.selectionColor;for(var h=0,i=this.sources.length;i>h;h++)this.sources[h].isSelected&&this.drawSourceSelection(this.sources[h],a);if(this.displayLabel){a.fillStyle=this.labelColor,a.font=this.labelFont;for(var h=0,i=this.sources.length;i>h;h++)this.drawSourceLabel(this.sources[h],a)}}},cds.Catalog.prototype.drawSource=function(a,b,c,d,e,f,g,h){if(a.isShowing){var i,j=this.sourceSize;if(d!=CooFrameEnum.J2000){var k=CooConversion.J2000ToGalactic([a.ra,a.dec]);i=c.project(k[0],k[1])}else i=c.project(a.ra,a.dec);if(i){var l=AladinUtils.xyToView(i.X,i.Y,e,f,g,h),m=a.popup?100:a.sourceSize;if(l){if(l.vx>e+m||0-m>l.vx||l.vy>f+m||0-m>l.vy)return void(a.x=a.y=void 0);a.x=l.vx,a.y=l.vy,a.marker?b.drawImage(this.cacheMarkerCanvas,a.x-j/2,a.y-j/2):b.drawImage(this.cacheCanvas,a.x-this.cacheCanvas.width/2,a.y-this.cacheCanvas.height/2),a.popup&&a.popup.setPosition(a.x,a.y)}}}},cds.Catalog.prototype.drawSourceSelection=function(a,b){if(a&&a.isShowing&&a.x&&a.y){var c=this.selectSize;b.drawImage(this.cacheSelectCanvas,a.x-c/2,a.y-c/2)}},cds.Catalog.prototype.drawSourceLabel=function(a,b){if(a&&a.isShowing&&a.x&&a.y){var c=a.data[this.labelColumn];c&&b.fillText(c,a.x,a.y)}},cds.Catalog.prototype.reportChange=function(){this.view.requestRedraw()},cds.Catalog.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},cds.Catalog.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.view&&this.view.popup&&this.view.popup.source&&this.view.popup.source.catalog==this&&this.view.popup.hide(),this.reportChange())},cds.Catalog}(),Tile=function(){function a(a,b){this.img=a,this.url=b}return a.isImageOk=function(a){return a.allSkyTexture?!0:a.src&&a.complete?void 0!==a.naturalWidth&&0==a.naturalWidth?!1:!0:!1},a}(),TileBuffer=function(){function a(){this.pointer=0,this.tilesMap={},this.tilesArray=Array(b);for(var a=0;b>a;a++)this.tilesArray[a]=new Tile(new Image,null)}var b=800;return a.prototype.addTile=function(a){if(this.getTile(a))return null;var c=this.tilesArray[this.pointer];return null!=c.url&&(c.img.src=null,delete this.tilesMap[c.url]),this.tilesArray[this.pointer].url=a,this.tilesMap[a]=this.tilesArray[this.pointer],this.pointer++,this.pointer>=b&&(this.pointer=0),this.tilesMap[a]},a.prototype.getTile=function(a){return this.tilesMap[a]},a}(),ColorMap=function(){return ColorMap=function(a){this.view=a,this.reversed=!1,this.map="native",this.sig=this.signature()},ColorMap.MAPS={},ColorMap.MAPS.eosb={name:"Eos B",r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],
g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.rainbow={name:"Rainbow",r:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],b:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS_CUSTOM=["rainbow","eosb"],ColorMap.MAPS_NAMES=["native","grayscale"].concat(ColorMap.MAPS_CUSTOM),ColorMap.prototype.reverse=function(a){this.reversed=a?a:!this.reversed,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.signature=function(){var a=this.map;return this.reversed&&(a+=" reversed"),a},ColorMap.prototype.update=function(a){this.map=a,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.apply=function(a){if("native"==this.sig)return a;if(a.cmSig==this.sig)return a.cmImg;var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d,e,f,g=c.getImageData(0,0,b.width,b.height),h=g.data,i=h.length,j=3;"grayscale"==this.map?j=1:ColorMap.MAPS_CUSTOM.indexOf(this.map)>=0&&(j=2);for(var k=0;i>k;k+=4){switch(j){case 1:d=e=f=AladinUtils.myRound((h[k]+h[k+1]+h[k+2])/3);break;case 2:this.reversed?(d=ColorMap.MAPS[this.map].r[255-h[k]],e=ColorMap.MAPS[this.map].g[255-h[k+1]],f=ColorMap.MAPS[this.map].b[255-h[k+2]]):(d=ColorMap.MAPS[this.map].r[h[k]],e=ColorMap.MAPS[this.map].g[h[k+1]],f=ColorMap.MAPS[this.map].b[h[k+2]]);break;default:d=h[k],e=h[k+1],f=h[k+2]}2!=j&&this.reversed&&(d=255-d,e=255-e,f=255-f),h[k]=d,h[k+1]=e,h[k+2]=f}return g.data=h,c.putImageData(g,0,0),a.cmSig=this.sig,a.cmImg=b,a.cmImg},ColorMap}(),HpxImageSurvey=function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){p=p||0,q=q||0,r||(r=!1),i+=p,k+=p,m+=p,j+=q,l+=q,n+=q;var s=(c+e+g)/3,t=(d+f+h)/3,s=(c+e+g)/3,t=(d+f+h)/3;a.save(),o&&(a.globalAlpha=o);var u=.01;r&&(u=.01),a.beginPath(),a.moveTo((1+u)*c-s*u,(1+u)*d-t*u),a.lineTo((1+u)*e-s*u,(1+u)*f-t*u),a.lineTo((1+u)*g-s*u,(1+u)*h-t*u),a.closePath(),a.clip(),r&&(u=.03,c=(1+u)*c-s*u,d=(1+u)*d-t*u,e=(1+u)*e-s*u,f=(1+u)*f-t*u,g=(1+u)*g-s*u,h=(1+u)*h-t*u);var v=1/(i*(n-l)-k*n+m*l+(k-m)*j);a.transform(-(j*(g-e)-l*g+n*e+(l-n)*c)*v,(l*h+j*(f-h)-n*f+(n-l)*d)*v,(i*(g-e)-k*g+m*e+(k-m)*c)*v,-(k*h+i*(f-h)-m*f+(m-k)*d)*v,(i*(n*e-l*g)+j*(k*g-m*e)+(m*l-k*n)*c)*v,(i*(n*f-l*h)+j*(k*h-m*f)+(m*l-k*n)*d)*v),a.drawImage(b,0,0),a.restore()}var b=function(a,c,d,e,f,g){this.id=a,this.name=c,this.rootUrl="/"===d.slice(-1)?d.substr(0,d.length-1):d,g=g||{},this.imgFormat=g.imgFormat||"jpg",this.minOrder=g.minOrder||null,this.cooFrame=CooFrameEnum.fromString(e,CooFrameEnum.J2000),this.rootUrl.indexOf("/glimpse360/aladin/data")>=0&&(this.cooFrame=CooFrameEnum.J2000),this.maxOrder=f,this.allskyTexture=null,this.alpha=0,this.allskyTextureSize=0,this.lastUpdateDateNeededTiles=0;for(var h=!1,i=0;b.SURVEYS.length>i;i++)b.SURVEYS[i].id==this.id&&(h=!0);h||b.SURVEYS.push({id:this.id,url:this.rootUrl,name:this.name,maxOrder:this.maxOrder,frame:this.cooFrame}),b.SURVEYS_OBJECTS[this.id]=this};b.UPDATE_NEEDED_TILES_DELAY=1e3,b.prototype.init=function(a,b){this.view=a,this.cm||(this.cm=new ColorMap(this.view)),this.tileBuffer=this.view.tileBuffer,this.useCors=!1;var c=this;$.support.cors?$.ajax({type:"GET",url:this.rootUrl+"/properties",contentType:"text/plain",xhrFields:{},headers:{},success:function(){c.useCors=!0,c.retrieveAllskyTextures(),b&&b()},error:function(){c.retrieveAllskyTextures(),b&&b()}}):(this.retrieveAllskyTextures(),b())},b.DEFAULT_SURVEY_ID="P/DSS2/color",b.SURVEYS_OBJECTS={},b.SURVEYS=[{id:"P/2MASS/color",url:"http://alasky.u-strasbg.fr/2MASS/Color",name:"2MASS colored",maxOrder:9,frame:"equatorial",format:"jpeg"},{id:"P/DSS2/color",url:"http://alasky.u-strasbg.fr/DSS/DSSColor",name:"DSS colored",maxOrder:9,frame:"equatorial",format:"jpeg"},{id:"P/DSS2/red",url:"http://alasky.u-strasbg.fr/DSS/DSS2Merged",name:"DSS2 Red (F+R)",maxOrder:9,frame:"equatorial",format:"jpeg fits"},{id:"P/Fermi/color",url:"http://alasky.u-strasbg.fr/Fermi/Color",name:"Fermi color",maxOrder:3,frame:"equatorial",format:"jpeg"},{id:"P/Finkbeiner",url:"http://alasky.u-strasbg.fr/FinkbeinerHalpha",maxOrder:3,frame:"galactic",format:"jpeg fits",name:"Halpha"},{id:"P/GALEXGR6/AIS/color",url:"http://alasky.u-strasbg.fr/GALEX/GR6-02-Color",name:"GALEX Allsky Imaging Survey colored",maxOrder:8,frame:"equatorial",format:"jpeg"},{id:"P/IRIS/color",url:"http://alasky.u-strasbg.fr/IRISColor",name:"IRIS colored",maxOrder:3,frame:"galactic",format:"jpeg"},{id:"P/Mellinger/color",url:"http://alasky.u-strasbg.fr/MellingerRGB",name:"Mellinger colored",maxOrder:4,frame:"galactic",format:"jpeg"},{id:"P/SDSS9/color",url:"http://alasky.u-strasbg.fr/SDSS/DR9/color",name:"SDSS9 colored",maxOrder:10,frame:"equatorial",format:"jpeg"},{id:"P/SPITZER/color",url:"http://alasky.u-strasbg.fr/SpitzerI1I2I4color",name:"IRAC color I1,I2,I4 - (GLIMPSE, SAGE, SAGE-SMC, SINGS)",maxOrder:9,frame:"galactic",format:"jpeg"},{id:"P/VTSS/Ha",url:"http://alasky.u-strasbg.fr/VTSS/Ha",maxOrder:3,frame:"galactic",format:"png jpeg fits",name:"VTSS-Ha"},{id:"P/XMM/EPIC",url:"http://saada.u-strasbg.fr/xmmallsky",name:"XMM-Newton stacked EPIC images (no phot. normalization)",maxOrder:7,frame:"equatorial",format:"png jpeg fits"},{id:"P/XMM/PN/color",url:"http://saada.unistra.fr/xmmpnsky",name:"XMM PN colored",maxOrder:7,frame:"equatorial",format:"png jpeg"},{id:"P/allWISE/color",url:"http://alasky.u-strasbg.fr/AllWISE/RGB-W4-W2-W1/",name:"AllWISE color",maxOrder:8,frame:"equatorial",format:"jpeg"},{id:"P/GLIMPSE360",url:"http://www.spitzer.caltech.edu/glimpse360/aladin/data",name:"GLIMPSE360",maxOrder:9,frame:"equatorial",format:"jpeg"}],b.getAvailableSurveys=function(){return b.SURVEYS},b.getSurveyInfoFromId=function(a){for(var c=b.getAvailableSurveys(),d=0;c.length>d;d++)if(c[d].id==a)return c[d];return null},b.getSurveyFromId=function(a){if(b.SURVEYS_OBJECTS[a])return b.SURVEYS_OBJECTS[a];var c=b.getSurveyInfoFromId(a);return c?new b(c.id,c.name,c.url,c.frame,c.maxOrder):null},b.prototype.getTileURL=function(a,b){var c=1e4*Math.floor(b/1e4);return this.rootUrl+"/Norder"+a+"/Dir"+c+"/Npix"+b+"."+this.imgFormat},b.prototype.retrieveAllskyTextures=function(){var a=new Image;this.useCors&&(a.crossOrigin="anonymous");var b=this;a.onload=function(){b.allskyTextureSize=a.width/27,b.allskyTexture=a,b.view.requestRedraw()},a.src=this.rootUrl+"/Norder3/Allsky."+this.imgFormat},b.prototype.redrawAllsky=function(a,b,c){if(!(this.view.curNorder>6)&&this.allskyTexture)for(var d,e,f,g=0,h=0,i=b.length;i>h;h++)if(d=b[h],f=d.ipix,this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){var j=this.allskyTextureSize*Math.floor(f/27),k=this.allskyTextureSize*(f-27*Math.floor(f/27));if(c>40){g=.02,g=0,e={x:(d[0].vx+d[2].vx)/2,y:(d[0].vy+d[2].vy)/2};for(var l=0;4>l;l++){var m={x:d[l].vx-e.x,y:d[l].vy-e.y};d[l].vx+=g*m.x,d[l].vy+=g*m.y}}this.drawOneTile(a,this.allskyTexture,d,this.allskyTextureSize,null,k,j,!0)}},b.prototype.getColorMap=function(){return this.cm};var c=!0;return b.prototype.redrawHighres=function(a,d,e){if(0!=d.length){c=!c;var f,g,h,i,j,k,l,m,n=(new Date).getTime(),o=n-this.lastUpdateDateNeededTiles>b.UPDATE_NEEDED_TILES_DELAY,p=e-1,q=[],r=[],s={},t=!1,u=[],v=[];if(o){var w=[(d[0][0].vx+d[0][1].vx)/2,(d[0][0].vy+d[0][1].vy)/2],x=d.sort(function(a,b){var c=[(a[0].vx+a[2].vx)/2,(a[0].vy+a[2].vy)/2],d=[(b[0].vx+b[2].vx)/2,(b[0].vy+b[2].vy)/2],e=(c[0]-w[0])*(c[0]-w[0])+(c[1]-w[1])*(c[1]-w[1]),f=(d[0]-w[0])*(d[0]-w[0])+(d[1]-w[1])*(d[1]-w[1]);return e-f});d=x}for(var y=0,z=d.length;z>y;y++)if(j=d[y],m=j.ipix,l=~~(m/4),i=this.getTileURL(p,l),o&&p>=3&&(h=this.tileBuffer.addTile(i),h&&v.push({img:h.img,url:i})),g=this.getTileURL(e,m),f=this.tileBuffer.getTile(g))Tile.isImageOk(f.img)?q.push({img:f.img,corners:j}):(t=!0,o&&!f.img.dlError&&u.push({img:f.img,url:g}),p>=3&&!s[l]&&(h=this.tileBuffer.getTile(i),h&&Tile.isImageOk(h.img)&&(k=this.view.getPositionsInView(l,p),k&&r.push({img:h.img,corners:k,ipix:l})),s[l]=1));else{if(t=!0,o){var f=this.tileBuffer.addTile(g);f&&u.push({img:f.img,url:g})}p>=3&&!s[l]&&(h=this.tileBuffer.getTile(i),h&&Tile.isImageOk(h.img)&&(k=this.view.getPositionsInView(l,p),k&&r.push({img:h.img,corners:k,ipix:l})),s[l]=1)}for(var y=0,z=r.length;z>y;y++)this.drawOneTile(a,r[y].img,r[y].corners,r[y].img.width);for(var y=0,z=q.length;z>y;y++){var A=null,B=q[y].img;B.fadingStart&&B.fadingEnd&&B.fadingEnd>n&&(A=.2+.8*((n-B.fadingStart)/(B.fadingEnd-B.fadingStart))),this.drawOneTile(a,B,q[y].corners,B.width,A)}if(o){for(var y=0,z=u.length;z>y;y++)this.view.downloader.requestDownload(u[y].img,u[y].url,this.useCors);for(var y=0,z=v.length;z>y;y++)this.view.downloader.requestDownload(v[y].img,v[y].url,this.useCors);this.lastUpdateDateNeededTiles=n}t&&this.view.requestRedrawAtDate(n+b.UPDATE_NEEDED_TILES_DELAY+10)}},b.prototype.drawOneTile=function(b,c,d,e,f,g,h,i){var j=this.useCors?this.cm.apply(c):c;a(b,j,d[0].vx,d[0].vy,d[1].vx,d[1].vy,d[3].vx,d[3].vy,e-1,e-1,e-1,0,0,e-1,f,g,h,i),a(b,j,d[1].vx,d[1].vy,d[3].vx,d[3].vy,d[2].vx,d[2].vy,e-1,0,0,e-1,0,0,f,g,h,i)},b.prototype.setAlpha=function(a){a=+a,this.alpha=Math.max(0,Math.min(a,1)),this.view.requestRedraw()},b.prototype.getAlpha=function(){return this.alpha},b}(),HealpixGrid=function(){var a=function(){};return a.prototype.redraw=function(a,b,c,d){a.lineWidth=1,a.strokeStyle="rgb(150,150,220)",a.beginPath();for(var e,f=0,g=b.length;g>f;f++)e=b[f],ipix=e.ipix,a.moveTo(e[0].vx,e[0].vy),a.lineTo(e[1].vx,e[1].vy),a.lineTo(e[2].vx,e[2].vy);a.stroke(),a.strokeStyle="#FFDDDD",a.beginPath();for(var f=0,g=b.length;g>f;f++)e=b[f],ipix=e.ipix,a.strokeText(d+"/"+ipix,(e[0].vx+e[2].vx)/2,(e[0].vy+e[2].vy)/2);a.stroke()},a}(),Location=function(){return Location=function(a){this.div=$(a)},Location.prototype.update=function(a,b,c){var d=new Coo(a,b,7);c==CooFrameEnum.J2000?this.div.html(d.format("s/")):this.div.html(d.format("d/"))},Location}(),View=function(){function a(b,c,d,e,f){this.aladin=b,this.options=b.options,this.aladinDiv=this.aladin.aladinDiv,this.popup=new Popup(this.aladinDiv),this.createCanvases(),this.location=c,this.fovDiv=d,this.mustClearCatalog=!0,this.mustRedrawReticle=!0,this.mode=a.PAN,this.minFOV=this.maxFOV=null,this.healpixGrid=new HealpixGrid(this.imageCanvas),this.cooFrame=e?e:CooFrameEnum.GAL;var g,h;g=h=0,this.projectionMethod=ProjectionEnum.SIN,this.projection=new Projection(g,h),this.projection.setProjection(this.projectionMethod),this.zoomLevel=0,this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.viewCenter={lon:g,lat:h},f&&this.setZoom(f),this.imageSurvey=null,this.catalogs=[],this.overlays=[],this.mocs=[],this.tileBuffer=new TileBuffer,this.fixLayoutDimensions(),this.curNorder=1,this.realNorder=1,this.curOverlayNorder=1,this.dragging=!1,this.dragx=null,this.dragy=null,this.needRedraw=!0,this.downloader=new Downloader(this),this.flagForceRedraw=!1,this.fadingLatestUpdate=null,this.dateRequestRedraw=null,this.showGrid=!1,init(this),this.resizeTimer=null;var i=this;$(window).resize(function(){clearTimeout(i.resizeTimer),i.resizeTimer=setTimeout(function(){i.fixLayoutDimensions(i)},100)})}function b(a,b,c,d){if(a.projection){var e,f=AladinUtils.viewToXy(b,c,a.width,a.height,a.largestDim,a.zoomFactor);try{e=a.projection.unproject(f.x,f.y)}catch(g){}e&&a.location.update(e.ra,e.dec,a.cooFrame,d)}}a.PAN=0,a.SELECT=1,a.DRAW_SOURCES_WHILE_DRAGGING=!0,a.DRAW_MOCS_WHILE_DRAGGING=!0,a.prototype.createCanvases=function(){var a=$(this.aladinDiv);a.find(".aladin-imageCanvas").remove(),a.find(".aladin-catalogCanvas").remove(),a.find(".aladin-reticleCanvas").remove(),this.imageCanvas=$("<canvas class='aladin-imageCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.catalogCanvas=$("<canvas class='aladin-catalogCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.reticleCanvas=$("<canvas class='aladin-reticleCanvas'></canvas>").appendTo(this.aladinDiv)[0]},a.prototype.fixLayoutDimensions=function(){Utils.cssScale=void 0,this.width=$(this.aladinDiv).width(),this.height=$(this.aladinDiv).height(),this.width=Math.max(this.width,1),this.height=Math.max(this.height,1),this.cx=this.width/2,this.cy=this.height/2,this.largestDim=Math.max(this.width,this.height),this.smallestDim=Math.min(this.width,this.height),this.ratio=this.largestDim/this.smallestDim,this.mouseMoveIncrement=160/this.largestDim,this.imageCtx=this.imageCanvas.getContext("2d"),this.catalogCtx=this.catalogCanvas.getContext("2d"),this.reticleCtx=this.reticleCanvas.getContext("2d"),this.imageCtx.canvas.width=this.width,this.catalogCtx.canvas.width=this.width,this.reticleCtx.canvas.width=this.width,this.imageCtx.canvas.height=this.height,this.catalogCtx.canvas.height=this.height,this.reticleCtx.canvas.height=this.height,this.computeNorder(),this.requestRedraw()},a.prototype.setMode=function(b){this.mode=b,this.mode==a.SELECT?this.setCursor("crosshair"):this.setCursor("default")},a.prototype.setCursor=function(a){this.reticleCanvas.style.cursor!=a&&(this.reticleCanvas.style.cursor=a)},a.prototype.getCanvasDataURL=function(a){a=a||"image/png";var b=document.createElement("canvas");b.width=this.width,b.height=this.height;var c=b.getContext("2d");return c.drawImage(this.imageCanvas,0,0),c.drawImage(this.catalogCanvas,0,0),c.drawImage(this.reticleCanvas,0,0),b.toDataURL(a)},computeFov=function(a){var b=doComputeFov(a,a.zoomFactor);return a.mouseMoveIncrement=b/a.imageCanvas.width,b},doComputeFov=function(a,b){if(1>a.zoomFactor)fov=180;else{var c=AladinUtils.viewToXy(0,a.cy,a.width,a.height,a.largestDim,b),d=a.projection.unproject(c.x,c.y),e=AladinUtils.viewToXy(a.imageCanvas.width-1,a.cy,a.width,a.height,a.largestDim,b),f=a.projection.unproject(e.x,e.y);fov=new Coo(d.ra,d.dec).distance(new Coo(f.ra,f.dec))}return fov},updateFovDiv=function(a){if(isNaN(a.fov))return void a.fovDiv.html("FoV:");var b;b=a.fov>1?Math.round(100*a.fov)/100+"Â°":60*a.fov>1?Math.round(6e3*a.fov)/100+"'":Math.round(36e4*a.fov)/100+'"',a.fovDiv.html("FoV: "+b)},createListeners=function(c){var d=!1;"ontouchstart"in window&&(d=!0),onDblClick=function(a){var b=c.imageCanvas.relMouseCoords(a),d=AladinUtils.viewToXy(b.x,b.y,c.width,c.height,c.largestDim,c.zoomFactor);try{var e=c.projection.unproject(d.x,d.y)}catch(f){return}radec=[],radec=c.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([e.ra,e.dec]):[e.ra,e.dec],c.pointTo(radec[0],radec[1])},d||$(c.reticleCanvas).dblclick(onDblClick),$(c.reticleCanvas).bind("mousedown touchstart",function(b){var d=c.imageCanvas.relMouseCoords(b);return b.originalEvent&&b.originalEvent.targetTouches?(c.dragx=b.originalEvent.targetTouches[0].clientX,c.dragy=b.originalEvent.targetTouches[0].clientY):(c.dragx=d.x,c.dragy=d.y),c.dragging=!0,c.mode==a.PAN?c.setCursor("move"):c.mode==a.SELECT&&(c.selectStartCoo={x:c.dragx,y:c.dragy}),!1});var e;$(c.reticleCanvas).bind("mouseup mouseout touchend",function(b){if(c.mode==a.SELECT&&c.dragging&&c.aladin.fire("selectend",c.getObjectsInBBox(c.selectStartCoo.x,c.selectStartCoo.y,c.dragx-c.selectStartCoo.x,c.dragy-c.selectStartCoo.y)),c.dragging&&(c.setCursor("default"),c.dragging=!1),c.mustClearCatalog=!0,c.mustRedrawReticle=!0,c.dragx=c.dragy=null,"mouseout"===b.type)return void c.requestRedraw();var d=c.imageCanvas.relMouseCoords(b),f=c.closestObjects(d.x,d.y,5);if(f){var g=f[0];g.marker?(c.popup.setTitle(g.popupTitle),c.popup.setText(g.popupDesc),c.popup.setSource(g),c.popup.show()):(c.aladin.objClickedFunction?c.aladin.objClickedFunction(g):(e&&e.actionOtherObjectClicked(),g.actionClicked()),e=g)}else e&&(c.aladin.measurementTable.hide(),e.actionOtherObjectClicked(),e=null,c.aladin.objClickedFunction&&c.aladin.objClickedFunction(null));c.refreshProgressiveCats(),c.requestRedraw()});var f;$(c.reticleCanvas).bind("mousemove touchmove",function(e){e.preventDefault();var g=c.imageCanvas.relMouseCoords(e);if(!c.dragging||d){if(b(c,g.x,g.y,!0),!c.dragging&&!c.mode==a.SELECT){var h=c.closestObjects(g.x,g.y,5);h?(c.setCursor("pointer"),c.aladin.objHoveredFunction&&h[0]!=f&&c.aladin.objHoveredFunction(h[0]),f=h[0]):(c.setCursor("default"),c.aladin.objHoveredFunction&&f&&(f=null,c.aladin.objHoveredFunction(null)))}if(!d)return}var i,j,k,l;if(e.originalEvent&&e.originalEvent.targetTouches){i=e.originalEvent.targetTouches[0].clientX-c.dragx,j=e.originalEvent.targetTouches[0].clientY-c.dragy;var m=AladinUtils.viewToXy(e.originalEvent.targetTouches[0].clientX,e.originalEvent.targetTouches[0].clientY,c.width,c.height,c.largestDim,c.zoomFactor),n=AladinUtils.viewToXy(c.dragx,c.dragy,c.width,c.height,c.largestDim,c.zoomFactor);k=c.projection.unproject(m.x,m.y),l=c.projection.unproject(n.x,n.y)}else{i=g.x-c.dragx,j=g.y-c.dragy;var m=AladinUtils.viewToXy(g.x,g.y,c.width,c.height,c.largestDim,c.zoomFactor),n=AladinUtils.viewToXy(c.dragx,c.dragy,c.width,c.height,c.largestDim,c.zoomFactor);k=c.projection.unproject(m.x,m.y),l=c.projection.unproject(n.x,n.y)}return e.originalEvent&&e.originalEvent.targetTouches?(c.dragx=e.originalEvent.targetTouches[0].clientX,c.dragy=e.originalEvent.targetTouches[0].clientY):(c.dragx=g.x,c.dragy=g.y),c.mode==a.SELECT?void c.requestRedraw():(c.viewCenter.lon+=l.ra-k.ra,c.viewCenter.lat+=l.dec-k.dec,c.viewCenter.lat>90?c.viewCenter.lat=90:-90>c.viewCenter.lat&&(c.viewCenter.lat=-90),0>c.viewCenter.lon?c.viewCenter.lon=360+c.viewCenter.lon:c.viewCenter.lon>360&&(c.viewCenter.lon=c.viewCenter.lon%360),void c.requestRedraw())}),$(c.aladinDiv).onselectstart=function(){return!1},$(c.reticleCanvas).on("mousewheel",function(a){a.preventDefault(),a.stopPropagation();var b=c.zoomLevel,d=a.deltaY;return d>0?b+=1:b-=1,c.setZoomLevel(b),!1})},init=function(a){var b=new Stats;b.domElement.style.top="50px",$("#aladin-statsDiv").length>0&&$("#aladin-statsDiv")[0].appendChild(b.domElement),a.stats=b,createListeners(a),a.displayHpxGrid=!1,a.displaySurvey=!0,a.displayCatalog=!1,a.displayReticle=!0,a.fov=computeFov(a),updateFovDiv(a),a.redraw()},a.prototype.requestRedrawAtDate=function(a){this.dateRequestDraw=a},a.prototype.redraw=function(){var b=this.needRedraw;requestAnimFrame(this.redraw.bind(this));var c=(new Date).getTime();if(this.dateRequestDraw&&c>this.dateRequestDraw)this.dateRequestDraw=null;else if(!this.needRedraw){if(!this.flagForceRedraw)return;this.flagForceRedraw=!1}this.stats.update();var d=this.imageCtx;d.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height),this.projectionMethod==ProjectionEnum.SIN&&(this.fov>80?(d.fillStyle="rgb(0,0,0)",d.beginPath(),d.arc(this.cx,this.cy,this.cx*this.zoomFactor,0,2*Math.PI,!0),d.fill()):60>this.fov&&(d.fillStyle="rgb(0,0,0)",d.fillRect(0,0,this.imageCanvas.width,this.imageCanvas.height))),this.projection?this.projection.setCenter(this.viewCenter.lon,this.viewCenter.lat):this.projection=new Projection(this.viewCenter.lon,this.viewCenter.lat),this.projection.setProjection(this.projectionMethod);var e=this.getVisibleCells(3),f=null;if(this.curNorder>=3&&(f=3==this.curNorder?e:this.getVisibleCells(this.curNorder)),this.imageSurvey&&this.imageSurvey.isReady&&this.displaySurvey&&(this.imageSurvey.redrawAllsky(d,e,this.fov,this.curNorder),this.curNorder>=3&&this.imageSurvey.redrawHighres(d,f,this.curNorder)),this.overlayImageSurvey&&this.overlayImageSurvey.isReady){if(d.globalAlpha=this.overlayImageSurvey.getAlpha(),this.fov>50&&this.overlayImageSurvey.redrawAllsky(d,e,this.fov,this.curOverlayNorder),this.curOverlayNorder>=3){var g=Math.min(this.curOverlayNorder,this.overlayImageSurvey.maxOrder);g!=this.curNorder&&(f=this.getVisibleCells(g)),this.overlayImageSurvey.redrawHighres(d,f,g)}d.globalAlpha=1}this.displayHpxGrid&&(f&&this.curNorder>3?this.healpixGrid.redraw(d,f,this.fov,this.curNorder):this.healpixGrid.redraw(d,e,this.fov,3)),this.showGrid&&(null==this.cooGrid&&(this.cooGrid=new CooGrid),this.cooGrid.redraw(d,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov));var h=this.catalogCtx,i=!1;if(this.mustClearCatalog&&(h.clearRect(0,0,this.width,this.height),i=!0,this.mustClearCatalog=!1),this.catalogs&&this.catalogs.length>0&&this.displayCatalog&&(!this.dragging||a.DRAW_SOURCES_WHILE_DRAGGING)){i||(h.clearRect(0,0,this.width,this.height),i=!0);for(var j=0;this.catalogs.length>j;j++)this.catalogs[j].draw(h,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}var k=this.catalogCtx;if(this.overlays&&this.overlays.length>0&&(!this.dragging||a.DRAW_SOURCES_WHILE_DRAGGING)){i||(h.clearRect(0,0,this.width,this.height),i=!0);for(var j=0;this.overlays.length>j;j++)this.overlays[j].draw(k,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}var l=this.catalogCtx;if(this.mocs&&this.mocs.length>0&&(!this.dragging||a.DRAW_MOCS_WHILE_DRAGGING)){i||(h.clearRect(0,0,this.width,this.height),i=!0);for(var j=0;this.mocs.length>j;j++)this.mocs[j].draw(l,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov)}this.mode==a.SELECT&&(mustRedrawReticle=!0);var m=this.reticleCtx;if((this.mustRedrawReticle||this.mode==a.SELECT)&&m.clearRect(0,0,this.width,this.height),this.displayReticle){if(!this.reticleCache){var n=document.createElement("canvas"),o=this.options.reticleSize;n.width=o,n.height=o;var p=n.getContext("2d");p.lineWidth=2,p.strokeStyle=this.options.reticleColor,p.beginPath(),p.moveTo(o/2,o/2+(o/2-1)),p.lineTo(o/2,o/2+2),p.moveTo(o/2,o/2-(o/2-1)),p.lineTo(o/2,o/2-2),p.moveTo(o/2+(o/2-1),o/2),p.lineTo(o/2+2,o/2),p.moveTo(o/2-(o/2-1),o/2),p.lineTo(o/2-2,o/2),p.stroke(),this.reticleCache=n}m.drawImage(this.reticleCache,this.width/2-this.reticleCache.width/2,this.height/2-this.reticleCache.height/2),this.mustRedrawReticle=!1}if(this.mode==a.SELECT&&this.dragging){m.fillStyle="rgba(100, 240, 110, 0.25)";var q=this.dragx-this.selectStartCoo.x,r=this.dragy-this.selectStartCoo.y;m.fillRect(this.selectStartCoo.x,this.selectStartCoo.y,q,r)}b==this.needRedraw&&(this.needRedraw=!1),this.dragging||this.updateObjectsLookup()},a.prototype.forceRedraw=function(){this.flagForceRedraw=!0},a.prototype.refreshProgressiveCats=function(){if(this.catalogs)for(var a=0;this.catalogs.length>a;a++)"progressivecat"==this.catalogs[a].type&&this.catalogs[a].loadNeededTiles()},a.prototype.getVisiblePixList=function(a,b){var c,d=Math.pow(2,a),e=HealpixIndex.nside2Npix(d);if(this.fov>80){c=[];for(var f=0;e>f;f++)c.push(f)}else{var g=new HealpixIndex(d);g.init();var h=new SpatialVector,i=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),j=this.projection.unproject(i.x,i.y),k=[];b&&b!=this.cooFrame?b==CooFrameEnum.J2000?k=CooConversion.GalacticToJ2000([j.ra,j.dec]):b==CooFrameEnum.GAL&&(k=CooConversion.J2000ToGalactic([j.ra,j.dec])):k=[j.ra,j.dec],h.set(k[0],k[1]);var l=.5*this.fov*this.ratio;l*=this.fov>60?1.6:this.fov>12?1.45:1.1,c=g.queryDisc(h,l*Math.PI/180,!0,!0);var m=Utils.radecToPolar(k[0],k[1]);ipixCenter=g.ang2pix_nest(m.theta,m.phi),c.unshift(ipixCenter)}return c},a.prototype.getVisibleCells=function(a,b){!b&&this.imageSurvey&&(b=this.imageSurvey.cooFrame);var c,d=[],e=[],f=new SpatialVector,g=Math.pow(2,a),h=HealpixIndex.nside2Npix(g),i=null;if(this.fov>80){c=[];for(var j=0;h>j;j++)c.push(j)}else{var k=new HealpixIndex(g);k.init();var l=new SpatialVector,m=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),n=this.projection.unproject(m.x,m.y),o=[];b&&b!=this.cooFrame?b==CooFrameEnum.J2000?o=CooConversion.GalacticToJ2000([n.ra,n.dec]):b==CooFrameEnum.GAL&&(o=CooConversion.J2000ToGalactic([n.ra,n.dec])):o=[n.ra,n.dec],l.set(o[0],o[1]);var p=.5*this.fov*this.ratio;p*=this.fov>60?1.6:this.fov>12?1.45:1.1,c=k.queryDisc(l,p*Math.PI/180,!0,!0);var q=Utils.radecToPolar(o[0],o[1]);i=k.ang2pix_nest(q.theta,q.phi),c.unshift(i)}for(var j,r,s,t=0,u=c.length;u>t;t++)if(j=c[t],!(j==i&&t>0)){var v=[];corners=HealpixCache.corners_nest(j,g);for(var w=0;4>w;w++){if(f.setXYZ(corners[w].x,corners[w].y,corners[w].z),b&&b!=this.cooFrame){if(b==CooFrameEnum.J2000){var n=CooConversion.J2000ToGalactic([f.ra(),f.dec()]);r=n[0],s=n[1]}else if(b==CooFrameEnum.GAL){var n=CooConversion.GalacticToJ2000([f.ra(),f.dec()]);r=n[0],s=n[1]}}else r=f.ra(),s=f.dec();e[w]=this.projection.project(r,s)}if(null!=e[0]&&null!=e[1]&&null!=e[2]&&null!=e[3]){for(var w=0;4>w;w++)v[w]=AladinUtils.xyToView(e[w].X,e[w].Y,this.width,this.height,this.largestDim,this.zoomFactor);if(!(0>v[0].vx&&0>v[1].vx&&0>v[2].vx&&0>v[3].vx||0>v[0].vy&&0>v[1].vy&&0>v[2].vy&&0>v[3].vy||v[0].vx>=this.width&&v[1].vx>=this.width&&v[2].vx>=this.width&&v[3].vx>=this.width||v[0].vy>=this.height&&v[1].vy>=this.height&&v[2].vy>=this.height&&v[3].vy>=this.height)){if(this.projection.PROJECTION==ProjectionEnum.AITOFF){var x=v[0].vx-v[2].vx,y=v[0].vy-v[2].vy,z=Math.sqrt(x*x+y*y);if(z>this.largestDim/5)continue;if(x=v[1].vx-v[3].vx,y=v[1].vy-v[3].vy,z=Math.sqrt(x*x+y*y),z>this.largestDim/5)continue}v.ipix=j,d.push(v)}}}return d},a.prototype.getPositionsInView=function(a,b){for(var c,d,e=[],f=new SpatialVector,g=Math.pow(2,b),h=[],i=HealpixCache.corners_nest(a,g),j=0;4>j;j++){if(f.setXYZ(i[j].x,i[j].y,i[j].z),this.imageSurvey&&this.imageSurvey.cooFrame!=this.cooFrame){if(this.imageSurvey.cooFrame==CooFrameEnum.J2000){var k=CooConversion.J2000ToGalactic([f.ra(),f.dec()]);c=k[0],d=k[1]}else if(this.imageSurvey.cooFrame==CooFrameEnum.GAL){var k=CooConversion.GalacticToJ2000([f.ra(),f.dec()]);c=k[0],d=k[1]}}else c=f.ra(),d=f.dec();e[j]=this.projection.project(c,d)}if(null==e[0]||null==e[1]||null==e[2]||null==e[3])return null;for(var j=0;4>j;j++)h[j]=AladinUtils.xyToView(e[j].X,e[j].Y,this.width,this.height,this.largestDim,this.zoomFactor);return h},a.prototype.computeZoomFactor=function(a){return a>0?AladinUtils.getZoomFactorForAngle(180/Math.pow(1.15,a),this.projectionMethod):1+.1*a},a.prototype.setZoom=function(a){if(!(0>a||a>180)){var b=Math.log(180/a)/Math.log(1.15);this.setZoomLevel(b)}},a.prototype.setShowGrid=function(a){this.showGrid=a,this.requestRedraw()},a.prototype.setZoomLevel=function(a){if(this.minFOV||this.maxFOV){var b=doComputeFov(this,this.computeZoomFactor(Math.max(-2,a)));if(this.maxFOV&&b>this.maxFOV||this.minFOV&&this.minFOV>b)return}if(this.zoomLevel=this.projectionMethod==ProjectionEnum.SIN?this.aladin.options.allowFullZoomout===!0?this.width/this.height>2?Math.max(-7,a):.5>this.width/this.height?Math.max(-2,a):Math.max(-6,a):Math.max(-2,a):Math.max(-7,a),this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.fov=computeFov(this),updateFovDiv(this),this.computeNorder(),this.forceRedraw(),this.requestRedraw(),!this.debounceProgCatOnZoom){var c=this;this.debounceProgCatOnZoom=Utils.debounce(function(){c.refreshProgressiveCats()},300)}this.debounceProgCatOnZoom()},a.prototype.computeNorder=function(){var a=this.fov/this.largestDim,b=512,c=HealpixIndex.calculateNSide(3600*b*a),d=Math.log(c)/Math.log(2);d=Math.max(d,1),this.realNorder=d,50>=this.fov&&2>=d&&(d=3),this.imageSurvey&&2>=d&&this.imageSurvey.minOrder>2&&(d=this.imageSurvey.minOrder);var e=d;this.imageSurvey&&d>this.imageSurvey.maxOrder&&(d=this.imageSurvey.maxOrder),this.overlayImageSurvey&&e>this.overlayImageSurvey.maxOrder&&(e=this.overlayImageSurvey.maxOrder),d>HealpixIndex.ORDER_MAX&&(d=HealpixIndex.ORDER_MAX),e>HealpixIndex.ORDER_MAX&&(e=HealpixIndex.ORDER_MAX),this.curNorder=d,this.curOverlayNorder=e},a.prototype.untaintCanvases=function(){this.createCanvases(),createListeners(this),this.fixLayoutDimensions()},a.prototype.setOverlayImageSurvey=function(a,b){if(!a)return this.overlayImageSurvey=null,void this.requestRedraw();$.support.cors&&this.overlayImageSurvey&&!this.overlayImageSurvey.useCors&&this.untaintCanvases();var c;"string"==typeof a?(c=HpxImageSurvey.getSurveyFromId(a),c||(c=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID))):c=a,c.isReady=!1,this.overlayImageSurvey=c;var d=this;c.init(this,function(){d.computeNorder(),c.isReady=!0,d.requestRedraw(),d.updateObjectsLookup(),b&&b()})},a.prototype.setUnknownSurveyIfNeeded=function(){c&&(this.setImageSurvey(c),c=void 0)};var c=void 0;return a.prototype.setImageSurvey=function(a,b){if(a){$.support.cors&&this.imageSurvey&&!this.imageSurvey.useCors&&this.untaintCanvases();var d;"string"==typeof a?(d=HpxImageSurvey.getSurveyFromId(a),d||(d=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID),c=a,console.log(c))):d=a,this.tileBuffer=new TileBuffer,d.isReady=!1,this.imageSurvey=d;var e=this;d.init(this,function(){e.computeNorder(),d.isReady=!0,e.requestRedraw(),e.updateObjectsLookup(),b&&b()})}},a.prototype.requestRedraw=function(){
this.needRedraw=!0},a.prototype.changeProjection=function(a){this.projectionMethod=a,this.requestRedraw()},a.prototype.changeFrame=function(a){if(this.cooFrame=a,this.cooFrame==CooFrameEnum.GAL){var b=CooConversion.J2000ToGalactic([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=b[0],this.viewCenter.lat=b[1]}else if(this.cooFrame==CooFrameEnum.J2000){var c=CooConversion.GalacticToJ2000([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=c[0],this.viewCenter.lat=c[1]}this.requestRedraw()},a.prototype.showHealpixGrid=function(a){this.displayHpxGrid=a,this.requestRedraw()},a.prototype.showSurvey=function(a){this.displaySurvey=a,this.requestRedraw()},a.prototype.showCatalog=function(a){this.displayCatalog=a,this.displayCatalog||(this.mustClearCatalog=!0),this.requestRedraw()},a.prototype.showReticle=function(a){this.displayReticle=a,this.mustRedrawReticle=!0,this.requestRedraw()},a.prototype.pointTo=function(a,b){if(a=parseFloat(a),b=parseFloat(b),!isNaN(a)&&!isNaN(b)){if(this.cooFrame==CooFrameEnum.J2000)this.viewCenter.lon=a,this.viewCenter.lat=b;else if(this.cooFrame==CooFrameEnum.GAL){var c=CooConversion.J2000ToGalactic([a,b]);this.viewCenter.lon=c[0],this.viewCenter.lat=c[1]}this.forceRedraw(),this.requestRedraw();var d=this;setTimeout(function(){d.refreshProgressiveCats()},1e3)}},a.prototype.makeUniqLayerName=function(a){if(!this.layerNameExists(a))return a;for(var b=1;;++b){var c=a+"_"+b;if(!this.layerNameExists(c))return c}},a.prototype.layerNameExists=function(a){for(var b=this.catalogs,c=0;b.length>c;c++)if(a==b[c].name)return!0;return!1},a.prototype.removeLayers=function(){this.catalogs=[],this.overlays=[],this.requestRedraw()},a.prototype.addCatalog=function(a){a.name=this.makeUniqLayerName(a.name),this.catalogs.push(a),"catalog"==a.type?a.setView(this):"progressivecat"==a.type&&a.init(this)},a.prototype.addOverlay=function(a){this.overlays.push(a),a.setView(this)},a.prototype.addMOC=function(a){this.mocs.push(a),a.setView(this)},a.prototype.getObjectsInBBox=function(a,b,c,d){0>c&&(a+=c,c=-c),0>d&&(b+=d,d=-d);var e,f,g,h=[];if(this.catalogs)for(var i=0;this.catalogs.length>i;i++)if(e=this.catalogs[i],e.isShowing){f=e.getSources();for(var j=0;f.length>j;j++)g=f[j],g.isShowing&&g.x&&g.y&&g.x>=a&&a+c>=g.x&&g.y>=b&&b+d>=g.y&&h.push(g)}return h},a.prototype.updateObjectsLookup=function(){this.objLookup=[];var a,b,c,d,e;if(this.catalogs)for(var f=0;this.catalogs.length>f;f++)if(a=this.catalogs[f],a.isShowing){b=a.getSources();for(var g=0;b.length>g;g++)c=b[g],c.isShowing&&c.x&&c.y&&(d=c.x,e=c.y,this.objLookup[d]||(this.objLookup[d]=[]),this.objLookup[d][e]||(this.objLookup[d][e]=[]),this.objLookup[d][e].push(c))}},a.prototype.closestObjects=function(a,b,c){if(!this.objLookup)return null;for(var d,e,f=0;c>=f;f++){d=e=null;for(var g=-c;c>=g;g++)if(this.objLookup[a+g])for(var h=-c;c>=h;h++)if(this.objLookup[a+g][b+h])if(d){var i=g*g+h*h;e>i&&(e=i,d=this.objLookup[a+g][b+h])}else d=this.objLookup[a+g][b+h];if(d)return d}return null},a}(),Aladin=function(){var a=function(b,c){if(0==$(b).length)return void console.log("Could not find div "+b+". Aborting creation of Aladin Lite instance");HealpixCache.init();var d=this;if(void 0===c&&(c=this.getOptionsFromQueryString()),c=c||{},"zoom"in c){var e=c.zoom;delete c.zoom,c.fov=e}var f={};for(var g in a.DEFAULT_OPTIONS)f[g]=void 0!==c[g]?c[g]:a.DEFAULT_OPTIONS[g];for(var g in c)void 0===a.DEFAULT_OPTIONS[g]&&(f[g]=c[g]);this.options=f,this.aladinDiv=b,$(b).addClass("aladin-container");var h=CooFrameEnum.fromString(f.cooFrame,CooFrameEnum.J2000),i=h==CooFrameEnum.J2000,j=$('<div class="aladin-location">'+(f.showFrame?'<select class="aladin-frameChoice"><option value="'+CooFrameEnum.J2000+'" '+(i?'selected="selected"':"")+'>J2000</option><option value="'+CooFrameEnum.GAL+'" '+(i?"":'selected="selected"')+">GAL</option></select>":"")+'<span class="aladin-location-text"></span></div>').appendTo(b),k=$('<div class="aladin-fov"></div>').appendTo(b);f.showZoomControl&&$('<div class="aladin-zoomControl"><a href="#" class="zoomPlus" title="Zoom in">+</a><a href="#" class="zoomMinus" title="Zoom out">&ndash;</a></div>').appendTo(b),f.showFullscreenControl&&$('<div class="aladin-fullscreenControl aladin-maximize" title="Full screen"></div>').appendTo(b),this.fullScreenBtn=$(b).find(".aladin-fullscreenControl"),this.fullScreenBtn.click(function(){d.toggleFullscreen()}),$("<div class='aladin-logo-container'><a href='http://aladin.u-strasbg.fr/' title='Powered by Aladin Lite' target='_blank'><div class='aladin-logo'></div></a></div>").appendTo(b),this.boxes=[],this.measurementTable=new MeasurementTable(b);var l=new Location(j.find(".aladin-location-text"));if(this.view=new View(this,l,k,h,f.fov),this.view.setShowGrid(f.showCooGrid),$.ajax({url:"http://aladin.u-strasbg.fr/java/nph-aladin.pl",data:{frame:"aladinLiteDic"},method:"GET",dataType:"jsonp",success:function(a){for(var b={},c=0;a.length>c;c++)b[a[c].id]=!0;for(var c=0;HpxImageSurvey.SURVEYS.length>c;c++)b[HpxImageSurvey.SURVEYS[c].id]||a.push(HpxImageSurvey.SURVEYS[c]);HpxImageSurvey.SURVEYS=a,d.view.setUnknownSurveyIfNeeded()},error:function(){}}),f.showLayersControl){var m=$('<div class="aladin-layersControl-container" title="Manage layers"><div class="aladin-layersControl"></div></div>');m.appendTo(b);var n=$('<div class="aladin-box aladin-layerBox aladin-cb-list"></div>');n.appendTo(b),this.boxes.push(n),m.click(function(){return d.hideBoxes(),d.showLayerBox(),!1})}if(f.showGotoControl){var m=$('<div class="aladin-gotoControl-container" title="Go to position"><div class="aladin-gotoControl"></div></div>');m.appendTo(b);var o=$('<div class="aladin-box aladin-gotoBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><form class="aladin-target-form">Go to: <input type="text" placeholder="Object name/position" /></form></div>');o.appendTo(b),this.boxes.push(o);var p=o.find(".aladin-target-form input");p.on("paste keydown",function(){$(this).removeClass("aladin-unknownObject")}),m.click(function(){return d.hideBoxes(),p.val(""),p.removeClass("aladin-unknownObject"),o.show(),p.focus(),!1}),o.find(".aladin-closeBtn").click(function(){return d.hideBoxes(),!1})}if(f.showShareControl){var m=$('<div class="aladin-shareControl-container" title="Share current view"><div class="aladin-shareControl"></div></div>');m.appendTo(b);var q=$('<div class="aladin-box aladin-shareBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><b>Share</b><input type="text" class="aladin-shareInput" /></div>');q.appendTo(b),this.boxes.push(q),m.click(function(){return d.hideBoxes(),q.show(),!1}),q.find(".aladin-closeBtn").click(function(){return d.hideBoxes(),!1})}if(this.gotoObject(f.target),f.log){var r=c;r.version=a.VERSION,Logger.log("startup",r)}if(this.showReticle(f.showReticle),f.catalogUrls)for(var s=0,t=f.catalogUrls.length;t>s;s++)this.createCatalogFromVOTable(f.catalogUrls[s]);this.setImageSurvey(f.survey),this.view.showCatalog(f.showCatalog);var u=this;$(b).find(".aladin-frameChoice").change(function(){u.setFrame($(this).val())}),$("#projectionChoice").change(function(){u.setProjection($(this).val())}),$(b).find(".aladin-target-form").submit(function(){return u.gotoObject($(this).find("input").val(),function(){$(b).find(".aladin-target-form input").addClass("aladin-unknownObject")}),!1});var v=$(b).find(".zoomPlus");v.click(function(){return u.increaseZoom(),!1}),v.bind("mousedown",function(a){a.preventDefault()});var w=$(b).find(".zoomMinus");w.click(function(){return u.decreaseZoom(),!1}),w.bind("mousedown",function(a){a.preventDefault()}),f.fullScreen&&window.setTimeout(function(){d.toggleFullscreen()},1e3)};a.VERSION="2015-10-16",a.JSONP_PROXY="http://alasky.u-strasbg.fr/cgi/JSONProxy",a.DEFAULT_OPTIONS={target:"0 +0",cooFrame:"J2000",survey:"P/DSS2/color",fov:60,showReticle:!0,showZoomControl:!0,showFullscreenControl:!0,showLayersControl:!0,showGotoControl:!0,showShareControl:!1,showCatalog:!0,showFrame:!0,showCooGrid:!1,fullScreen:!1,reticleColor:"rgb(178, 50, 178)",reticleSize:22,log:!0,allowFullZoomout:!1},a.prototype.toggleFullscreen=function(){this.fullScreenBtn.toggleClass("aladin-maximize aladin-restore");var a=this.fullScreenBtn.hasClass("aladin-restore");this.fullScreenBtn.attr("title",a?"Restore original size":"Full screen"),$(this.aladinDiv).toggleClass("aladin-fullscreen"),this.view.fixLayoutDimensions()},a.prototype.updateSurveysDropdownList=function(a){a=a.sort(function(a,b){return a.order?a.order&&a.order>b.order?1:-1:a.id>b.id});var b=$(this.aladinDiv).find(".aladin-surveySelection");b.empty();for(var c=0;a.length>c;c++){var d=this.view.imageSurvey.id==a[c].id;b.append($("<option />").attr("selected",d).val(a[c].id).text(a[c].name))}},a.prototype.getOptionsFromQueryString=function(){var a={},b=$.urlParam("target");b&&(a.target=b);var c=$.urlParam("frame");c&&CooFrameEnum[c]&&(a.frame=c);var d=$.urlParam("survey");d&&HpxImageSurvey.getSurveyInfoFromId(d)&&(a.survey=d);var e=$.urlParam("zoom");e&&e>0&&180>e&&(a.zoom=e);var f=$.urlParam("showReticle");f&&(a.showReticle="true"==f.toLowerCase());var g=$.urlParam("cooFrame");g&&(a.cooFrame=g);var h=$.urlParam("fullScreen");return void 0!==h&&(a.fullScreen=h),a},a.prototype.setZoom=function(a){this.view.setZoom(a)},a.prototype.setFoV=function(a){this.view.setZoom(a)},a.prototype.setFrame=function(a){if(a){var b=CooFrameEnum.fromString(a,CooFrameEnum.J2000);b!=this.view.cooFrame&&(this.view.changeFrame(b),$(this.aladinDiv).find(".aladin-frameChoice").val(b))}},a.prototype.setProjection=function(a){if(a)switch(a=a.toLowerCase()){case"aitoff":this.view.changeProjection(ProjectionEnum.AITOFF);break;case"sinus":default:this.view.changeProjection(ProjectionEnum.SIN)}},a.prototype.gotoObject=function(a,b){var c=/[a-zA-Z]/.test(a);if(c){var d=this;Sesame.resolve(a,function(a){var b=a.Target.Resolver.jradeg,c=a.Target.Resolver.jdedeg;d.view.pointTo(b,c)},function(c){console&&(console.log("Could not resolve object name "+a),console.log(c)),b&&b()})}else{var e=new Coo;e.parse(a);var f=[e.lon,e.lat];this.view.cooFrame==CooFrameEnum.GAL&&(f=CooConversion.GalacticToJ2000(f)),this.view.pointTo(f[0],f[1])}},a.prototype.gotoPosition=function(a,b){var c;c=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([a,b]):[a,b],this.view.pointTo(c[0],c[1])};var b=function(a){var c=a.animationParams;if(null!=c){var d=(new Date).getTime();if(d>c.end)return a.gotoRaDec(c.raEnd,c.decEnd),void(c.complete&&c.complete());var e=c.raStart+(c.raEnd-c.raStart)*(d-c.start)/(c.end-c.start),f=c.decStart+(c.decEnd-c.decStart)*(d-c.start)/(c.end-c.start);a.gotoRaDec(e,f),setTimeout(function(){b(a)},50)}};return a.prototype.animateToRaDec=function(a,c,d,e){d=d||5,this.animationParams=null,b(this);var f={};f.start=(new Date).getTime(),f.end=(new Date).getTime()+1e3*d;var g=this.getRaDec();f.raStart=g[0],f.decStart=g[1],f.raEnd=a,f.decEnd=c,f.complete=e,this.animationParams=f,b(this)},a.prototype.getRaDec=function(){if(this.view.cooFrame==CooFrameEnum.J2000)return[this.view.viewCenter.lon,this.view.viewCenter.lat];var a=CooConversion.GalacticToJ2000([this.view.viewCenter.lon,this.view.viewCenter.lat]);return a},a.prototype.gotoRaDec=function(a,b){this.view.pointTo(a,b)},a.prototype.showHealpixGrid=function(a){this.view.showHealpixGrid(a)},a.prototype.showSurvey=function(a){this.view.showSurvey(a)},a.prototype.showCatalog=function(a){this.view.showCatalog(a)},a.prototype.showReticle=function(a){this.view.showReticle(a),$("#displayReticle").attr("checked",a)},a.prototype.removeLayers=function(){this.view.removeLayers()},a.prototype.addCatalog=function(a){this.view.addCatalog(a)},a.prototype.addOverlay=function(a){this.view.addOverlay(a)},a.prototype.addMOC=function(a){this.view.addMOC(a)},a.prototype.createImageSurvey=function(a,b,c,d,e,f){return new HpxImageSurvey(a,b,c,d,e,f)},a.prototype.getBaseImageLayer=function(){return this.view.imageSurvey},a.prototype.setImageSurvey=function(a,b){if(this.view.setImageSurvey(a,b),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys()),this.options.log){var c=a;"string"!=typeof a&&(c=a.rootUrl),Logger.log("changeImageSurvey",c)}},a.prototype.setBaseImageLayer=a.prototype.setImageSurvey,a.prototype.getOverlayImageLayer=function(){return this.view.overlayImageSurvey},a.prototype.setOverlayImageLayer=function(a,b){this.view.setOverlayImageSurvey(a,b)},a.prototype.increaseZoom=function(a){a||(a=5),this.view.setZoomLevel(this.view.zoomLevel+a)},a.prototype.decreaseZoom=function(a){a||(a=5),this.view.setZoomLevel(this.view.zoomLevel-a)},a.prototype.createCatalog=function(a){return A.catalog(a)},a.prototype.createProgressiveCatalog=function(a,b,c,d){return new ProgressiveCat(a,b,c,d)},a.prototype.createSource=function(a,b,c){return new cds.Source(a,b,c)},a.prototype.createMarker=function(a,b,c,d){return c=c||{},c.marker=!0,new cds.Source(a,b,d,c)},a.prototype.createOverlay=function(a){return new Overlay(a)},a.prototype.createFootprintsFromSTCS=function(a){for(var b=Overlay.parseSTCS(a),c=[],d=0,e=b.length;e>d;d++)c.push(new Footprint(b[d]));return c},A.MOCFromURL=function(a,b,c){var d=new MOC(b);return d.dataFromURL(a,c),d},a.prototype.createCatalogFromVOTable=function(a,b){return A.catalogFromURL(a,b)},A.catalogFromURL=function(a,b,c){var d=A.catalog(b);return cds.Catalog.parseVOTable(a,function(a){d.addSources(a),c&&c(a)},d.maxNbSources),d},A.catalogFromSimbad=function(a,b,c,d){c=c||{},"name"in c||(c.name="Simbad");var e=URLBuilder.buildSimbadCSURL(a,b);return A.catalogFromURL(e,c,d)},A.catalogFromNED=function(a,b,c,d){c=c||{},"name"in c||(c.name="NED");var e;if(a&&"object"==typeof a)"ra"in a&&"dec"in a&&(e=URLBuilder.buildNEDPositionCSURL(a.ra,a.dec,b));else{var f=/[a-zA-Z]/.test(a);if(f)e=URLBuilder.buildNEDObjectCSURL(a,b);else{var g=new Coo;g.parse(a),e=URLBuilder.buildNEDPositionCSURL(g.lon,g.lat,b)}}return A.catalogFromURL(e,c,d)},A.catalogFromVizieR=function(a,b,c,d,e){d=d||{},"name"in d||(d.name="VizieR:"+a);var f=URLBuilder.buildVizieRCSURL(a,b,c);return A.catalogFromURL(f,d,e)},a.prototype.on=function(a,b){"select"===a?this.selectFunction=b:"objectClicked"==a?this.objClickedFunction=b:"objectHovered"==a&&(this.objHoveredFunction=b)},a.prototype.select=function(){this.fire("selectstart")},a.prototype.fire=function(a,b){"selectstart"===a?this.view.setMode(View.SELECT):"selectend"===a&&(this.view.setMode(View.PAN),this.selectFunction&&this.selectFunction(b))},a.prototype.hideBoxes=function(){if(this.boxes)for(var a=0;this.boxes.length>a;a++)this.boxes[a].hide()},a.prototype.updateCM=function(){},a.prototype.showLayerBox=function(){var a=this,b=$(this.aladinDiv).find(".aladin-layerBox");b.empty(),b.append('<a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><div class="aladin-label">Base image layer</div><select class="aladin-surveySelection"></select><div class="aladin-cmap">Color map:<div><select class="aladin-cmSelection"></select><button class="aladin-btn aladin-btn-small aladin-reverseCm" type="button">Reverse</button></div></div><div class="aladin-box-separator"></div><div class="aladin-label">Overlay layers</div>');for(var c=b.find(".aladin-cmap"),d=b.find(".aladin-cmSelection"),e=0;ColorMap.MAPS_NAMES.length>e;e++)d.append($("<option />").text(ColorMap.MAPS_NAMES[e]));d.val(a.getBaseImageLayer().getColorMap().map);for(var f=this.view.catalogs,g="<ul>",e=f.length-1;e>=0;e--){var h=f[e].name,i="";f[e].isShowing&&(i='checked="checked"');var j=f[e].getSources().length,k=j+" source"+(j>1?"s":""),l=f[e].color,m=$("<div></div>").css("color",l).css("color"),n=Color.getLabelColorForBackground(m);g+='<li><div class="aladin-layerIcon" style="background: '+l+';"></div><input type="checkbox" '+i+' id="aladin_lite_'+h+'"></input><label for="aladin_lite_'+h+'" class="aladin-layer-label" style="background: '+l+"; color:"+n+';" title="'+k+'">'+h+"</label></li>"}g+="</ul>",b.append(g),b.append('<div class="aladin-blank-separator"></div>');var i="";this.view.displayReticle&&(i='checked="checked"');var o=$('<input type="checkbox" '+i+' id="displayReticle" />');b.append(o).append('<label for="displayReticle">Reticle</label><br/>'),o.change(function(){a.showReticle($(this).is(":checked"))}),i="",this.view.displayHpxGrid&&(i='checked="checked"');var p=$('<input type="checkbox" '+i+' id="displayHpxGrid"/>');b.append(p).append('<label for="displayHpxGrid">HEALPix grid</label><br/>'),p.change(function(){a.showHealpixGrid($(this).is(":checked"))}),b.append('<div class="aladin-box-separator"></div><div class="aladin-label">Tools</div>');var q=$('<button class="aladin-btn" type="button">Export view as PNG</button>');b.append(q),q.click(function(){a.exportAsPNG()}),b.find(".aladin-closeBtn").click(function(){return a.hideBoxes(),!1}),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys());var r=$(this.aladinDiv).find(".aladin-surveySelection");r.change(function(){var b=HpxImageSurvey.getAvailableSurveys()[$(this)[0].selectedIndex];a.setImageSurvey(b.id,function(){var b=a.getBaseImageLayer();b.useCors?(d.val(b.getColorMap().map),c.show(),q.show()):(c.hide(),q.hide())})}),c.find(".aladin-cmSelection").change(function(){var b=$(this).find(":selected").val();a.getBaseImageLayer().getColorMap().update(b)}),c.find(".aladin-reverseCm").click(function(){a.getBaseImageLayer().getColorMap().reverse()}),this.getBaseImageLayer().useCors?(c.show(),q.show()):(c.hide(),q.hide()),b.find(".aladin-reverseCm").parent().attr("disabled",!0),$(this.aladinDiv).find(".aladin-layerBox ul input").change(function(){var b=$(this).attr("id").substr(12),c=a.layerByName(b);$(this).is(":checked")?c.show():c.hide()}),b.show()},a.prototype.layerByName=function(a){for(var b=this.view.catalogs,c=0;this.view.catalogs.length>c;c++)if(a==b[c].name)return b[c];return null},a.prototype.exportAsPNG=function(){window.open(this.getViewDataURL(),"Aladin Lite snapshot")},a.prototype.getViewDataURL=function(a){return this.view.getCanvasDataURL(a)},a.prototype.setFOVRange=function(a,b){if(a>b){var c=a;a=b,b=c}this.view.minFOV=a,this.view.maxFOV=b},a.prototype.pix2world=function(a,b){var c,d=AladinUtils.viewToXy(a,b,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor),e=this.view.projection.unproject(d.x,d.y);return c=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([e.ra,e.dec]):[e.ra,e.dec]},a.prototype.world2pix=function(a,b){var c;if(this.view.cooFrame==CooFrameEnum.GAL){var d=CooConversion.J2000ToGalactic([a,b]);c=this.view.projection.project(d[0],d[1])}else c=this.view.projection.project(a,b);if(c){var e=AladinUtils.xyToView(c.X,c.Y,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor);return[e.vx,e.vy]}return null},a.prototype.getFovCorners=function(a){(!a||1>a)&&(a=1);for(var b,c,d,e,f=[],g=0;4>g;g++){b=0==g||3==g?0:this.view.width-1,c=2>g?0:this.view.height-1,d=2>g?this.view.width-1:0,e=1==g||2==g?this.view.height-1:0;for(var h=0;a>h;h++)f.push(this.pix2world(b+h/a*(d-b),c+h/a*(e-c)))}return f},a.prototype.getFov=function(){var a=this.view.fov,b=this.getSize(),c=b[1]/b[0]*a;return a=Math.min(a,180),c=Math.min(c,180),[a,c]},a.prototype.getSize=function(){return[this.view.width,this.view.height]},a.prototype.getParentDiv=function(){return $(this.aladinDiv)},a}(),A.aladin=function(a,b){return new Aladin($(a)[0],b)},A.imageLayer=function(a,b,c,d){return new HpxImageSurvey(a,b,c,null,null,d)},A.source=function(a,b,c,d){return new cds.Source(a,b,c,d)},A.marker=function(a,b,c,d){return c=c||{},c.marker=!0,A.source(a,b,d,c)},A.polygon=function(a){var b=a.length;return b>0&&(a[0][0]!=a[b-1][0]||a[0][1]!=a[b-1][1])&&a.push([a[0][0],a[0][1]]),new Footprint(a)},A.polyline=function(a,b){return new Polyline(a,b)},A.circle=function(a,b,c,d){return new Circle([a,b],c,d)},A.graphicOverlay=function(a){return new Overlay(a)},A.catalog=function(a){return new cds.Catalog(a)},Aladin.prototype.displayFITS=function(a,b){b=b||{};var c={url:a};b.color&&(c.color=!0),b.outputFormat&&(c.format=b.outputFormat),b.order&&(c.order=b.order),b.nocache&&(c.nocache=b.nocache),$.ajax({url:"http://alasky.u-strasbg.fr/cgi/fits2HiPS",data:c,method:"GET",dataType:"json",success:function(a){if("success"!=a.status)return void alert("An error occured: "+a.message);var c=b.label||"FITS image";aladin.setOverlayImageLayer(aladin.createImageSurvey(c,c,a.data.url,"equatorial",a.data.meta.max_norder,{imgFormat:"png"})),aladin.setFoV(a.data.meta.fov),aladin.gotoRaDec(a.data.meta.ra,a.data.meta.dec);var d=b&&b.transparency||1;aladin.getOverlayImageLayer().setAlpha(d)}})},Aladin.prototype.displayJPG=Aladin.prototype.displayPNG=function(a,b){b=b||{},b.color=!0,b.label="JPG/PNG image",b.outputFormat="png",this.displayFITS(a,b)},$&&($.aladin=A.aladin);var min_mag=1.6,max_mag=20.6,maxid=13401,hashtag="";ConstList=[{label:"Pegasus\n/ˈpɛɡəsəs/",value:"peg"},{label:"Pisces\n/ˈpaɪsiːz/, /ˈpɪsiːz/",value:"psc"},{label:"Andromeda\n/ænˈdrɒmɨdə/",value:"and"},{label:"Sculptor\n/ˈskʌlptər/",value:"scl"},{label:"Cetus\n/ˈsiːtəs/",value:"cet"},{label:"Phoenix\n/ˈfiːnɨks/",value:"phe"},{label:"Cepheus\n/ˈsiːfiəs/, /ˈsiːfjuːs/",value:"cep"},{label:"Tucana\n/tjʊˈkeɪnə/",value:"tuc"},{label:"Cassiopeia\n/ˌkæsi.ɵˈpiːə/",value:"cas"},{label:"Triangulum\n/traɪˈæŋɡjʊləm/",value:"tri"},{label:"Hydrus\n/ˈhaɪdrəs/",value:"hyi"},{label:"Perseus\n/ˈpɜrsiəs,",value:"per"},{label:"Aries\n/ˈɛəriːz/, /ˈɛərɪ.iːz/",value:"ari"},{label:"Eridanus\n/ɨˈrɪdənəs/",value:"eri"},{label:"Fornax\n/ˈfɔrnæks/",value:"for"},{label:"Horologium\n/ˌhɒrəˈlɒdʒiəm/",value:"hor"},{label:"Taurus\n/ˈtɔrəs/",value:"tau"},{label:"Reticulum\n/rɨˈtɪkjʊləm/",value:"ret"},{label:"Camelopardalis\n/kəˌmɛlɵˈpɑrdəlɨs/",value:"cam"},{label:"Dorado\n/dəˈrɑːdəʊ/",value:"dor"},{label:"Mensa\n/ˈmɛnsə/",value:"men"},{label:"Caelum\n/ˈsiːləm/",value:"cae"},{label:"Orion\n/ɵˈraɪ.ən/",value:"ori"},{label:"Auriga\n/ɔːˈraɪɡə/",value:"aur"},{label:"Pictor\n/ˈpɪktər/",value:"pic"},{label:"Lepus\n/ˈliːpəs/",value:"lep"},{label:"Columba\n/kɵˈlʌmbə/",value:"col"},{label:"Gemini\n/ˈdʒɛmɨnaɪ/",value:"gem"},{label:"Monoceros\n/məˈnɒsɨrəs/",value:"mon"},{label:"Carina\n/kəˈraɪnə/",value:"car"},{label:"Puppis\n/ˈpʌpɨs/",value:"pup"},{label:"Canis Major\n/ˈkeɪnɨs ˈmeɪdʒər/",value:"cma"},{label:"Lynx\n/ˈlɪŋks/",value:"lyn"},{label:"Volans\n/ˈvoʊlænz/",value:"vol"},{label:"Canis Minor\n/ˈkeɪnɨs ˈmaɪnər/",value:"cmi"},{label:"Cancer\n/ˈkænsər/",value:"cnc"},{label:"Vela\n/ˈviːlə/",value:"vel"},{label:"Hydra\n/ˈhaɪdrə/",value:"hya"},{label:"Octans\n/ˈɒktænz/",value:"oct"},{label:"Ursa Major\n/ˌɜrsə ˈmeɪdʒər/",value:"uma"},{label:"Pyxis\n/ˈpɪksɨs/",value:"pyx"},{label:"Leo Minor\n/ˈliː.oʊ ˈmaɪnər/",value:"lmi"},{label:"Leo\n/ˈliː.oʊ/",value:"leo"},{label:"Antlia\n/ˈæntliə/",value:"ant"},{label:"Draco\n/ˈdreɪkoʊ/",value:"dra"},{label:"Chamaeleon\n/kəˈmiːliən/",value:"cha"},{label:"Sextans\n/ˈsɛkstənz/",value:"sex"},{label:"Ursa Minor\n/ˌɜrsə ˈmaɪnər/",value:"umi"},{label:"Crater\n/ˈkreɪtər/",value:"crt"},{label:"Centaurus\n/sɛnˈtɔrəs/",value:"cen"},{label:"Virgo\n/ˈvɜrɡoʊ/",value:"vir"},{label:"Coma Berenices\n/ˈkoʊmə bɛrəˈnaɪsiːz/",value:"com"},{label:"Corvus\n/ˈkɔrvəs/",value:"crv"},{label:"Crux\n/ˈkrʌks/",value:"cru"},{label:"Musca\n/ˈmʌskə/",value:"mus"},{label:"Canes Venatici\n/ˈkeɪniːz vɨˈnætɨsaɪ/",value:"cvn"},{label:"Boötes\n/boʊˈoʊtiːz/",value:"boo"},{label:"Circinus\n/ˈsɜrsɨnəs/",value:"cir"},{label:"Lupus\n/ˈljuːpəs/",value:"lup"},{label:"Libra\n/ˈlaɪbrə/, /ˈliːbrə/",value:"lib"},{label:"Apus\n/ˈeɪpəs/",value:"aps"},{label:"Triangulum Australe\n/traɪˈæŋɡjʊləm ɔːˈstræliː/",value:"tra"},{label:"Serpens\n/ˈsɜrpɛnz/",value:"ser"},{label:"Corona Borealis\n/kɵˈroʊnə ˌbɔəriˈælɨs/",value:"crb"},{label:"Norma\n/ˈnɔrmə/",value:"nor"},{label:"Scorpius\n/ˈskɔrpiəs/",value:"sco"},{label:"Hercules\n/ˈhɜrkjʊliːz/",value:"her"},{label:"Ophiuchus\n/ˌɒfiˈjuːkəs/",value:"oph"},{label:"Ara\n/ˈɛərə/",value:"ara"},{label:"Pavo\n/ˈpeɪvoʊ/",value:"pav"},{label:"Sagittarius\n/sædʒɨˈtɛəriəs/",value:"sgr"},{label:"Corona Australis\n/kɵˈroʊnə ʔɔːˈstrælɨs/",value:"cra"},{label:"Telescopium\n/ˌtɛlɨˈskɒpiəm/",value:"tel"},{label:"Lyra\n/ˈlaɪrə/",value:"lyr"},{label:"Scutum\n/ˈskjuːtəm/",value:"sct"},{label:"Aquila\n/ˈækwɨlə/",value:"aql"},{label:"Vulpecula\n/vʌlˈpɛkjʊlə/",value:"vul"},{label:"Cygnus\n/ˈsɪɡnəs/",value:"cyg"},{label:"Sagitta\n/səˈdʒɪtə/",value:"sge"},{label:"Delphinus\n/dɛlˈfaɪnəs/",value:"del"},{label:"Capricornus\n/ˌkæprɨˈkɔrnəs/",value:"cap"},{label:"Indus\n/ˈɪndəs/",value:"ind"},{label:"Microscopium\n/ˌmaɪkrɵˈskoʊpiəm/",value:"mic"},{label:"Aquarius\n/əˈkwɛəriəs/",value:"aqr"},{label:"Equuleus\n/ɨˈkwuːliəs/",value:"equ"},{label:"Grus\n/ˈɡrʌs/",value:"gru"},{label:"Piscis Austrinus\n/ˈpaɪsɨs ɔːˈstraɪnəs/",value:"psa"},{label:"Lacerta\n/ləˈsɜrtə/",value:"lac"}],SearchTypes=[{value:"Galaxy",label:"Galaxy"},{value:"Star",label:"Star"},{value:"Interstellar matter",label:"Interstellar matter"},{value:"Candidate objects",label:"Candidate objects"},{value:"Gravitational Source",label:"Gravitational Source"},{value:"gamma-ray source",label:"gamma-ray source"},{value:"X-ray source",label:"X-ray source"},{value:"UV-emission source",label:"UV-emission source"},{value:"Infra-Red source",label:"Infra-Red source"}],SearchCatalogues=["NGC","PGC","Messier"],Nodata=[,{value:"Radio-source",label:"Radio-source"},{value:"Unknown",label:"Object of unknown nature"},{value:"",label:"No data"},{value:"Inexistent",label:"Not an object (error, artefact, ...)"},{value:"Very red source",label:"Extremely Red Object"}],ddtypes=[{uniname:"Galaxy",data:[{value:"GinPair",label:"Galaxy in Pair of Galaxies"},{value:"Galaxy",label:"Galaxy"},{value:"EmG",label:"Emission-line galaxy  "},{value:"GinGroup",label:"Galaxy in Group of Galaxies"},{value:"IG",label:"Interacting Galaxies"},{value:"Seyfert_2",label:"Seyfert 2 Galaxy "},{value:"LSB_G",label:"Low Surface Brightness Galaxy"},{value:"LINER",label:"LINER-type Active Galaxy Nucleus"},{value:"GinCl",label:"Galaxy in Cluster of Galaxies"},{value:"RadioG",label:"Radio Galaxy"},{value:"Seyfert",label:"Seyfert Galaxy "},{value:"BClG",label:"Brightest galaxy in a Cluster (BCG)"},{value:"BlueCompG",label:"Blue compact Galaxy"},{value:"HII_G",label:"HII Galaxy"},{value:"QSO_Candidate",label:"Possible Quasar"},{value:"Seyfert_1",label:"Seyfert 1 Galaxy"},{value:"StarburstG",label:"Starburst Galaxy"},{value:"QSO",label:"Quasar"},{value:"Blazar",label:"Blazar"},{value:"BLLac",label:"BL Lac - type object"},{value:"PartofG",label:"Part of a Galaxy"}]},{uniname:"Interstellar matter",data:[{value:"PN",label:"Planetary Nebula"},{value:"HII",label:"HII (ionized) region"},{value:"ISM",label:"Interstellar matter"},{value:"RfNeb",label:"Reflection Nebula"},{value:"HH",label:"Herbig-Haro Object"},{value:"EmObj",label:"Emission Object"},{value:"SNR",label:"SuperNova Remnant"},{value:"BrNeb",label:"Bright Nebula"},{value:"GalNeb",label:"Galactic Nebula"},{value:"HIshell",label:"HI shell"},{value:"MolCld",label:"Molecular Cloud"}]},{uniname:"Unknown",data:[{value:"Unknown",label:"Object of unknown nature "}]},{uniname:"Star",data:[{value:"Star",label:"Star"},{value:"Em*",label:"Emission-line Star"},{value:"Ae*",label:"Herbig Ae/Be star"},{value:"Orion_V*",label:"Variable Star of Orion Type"},{value:"WR*",label:"Wolf-Rayet Star"},{value:"*inCl",label:"Star in Cluster"}]},{uniname:"Composite object",data:[{value:"OpCl",label:"Open (galactic) Cluster "},{value:"GlCl",label:"Globular Cluster"},{value:"Cl*",label:"Cluster of Stars"},{value:"Assoc*",label:"Association of Stars"},{value:"PairG",label:"Pair of Galaxies"},{value:"multiple_object",label:"Composite object"},{value:"**",label:"Double or multiple star"},{value:"Cl*?",label:"Possible (open) star cluster"},{value:"MouvGroup",label:"Moving Group"},{value:"GroupG",label:"Group of Galaxies"},{value:"SB*",label:"Spectroscopic binary"},{value:"Nova",label:"Nova"},{value:"EB*Algol",label:"Eclipsing binary of Algol type"},{value:"ClG",label:"Cluster of Galaxies"}]},{uniname:"Infra-Red source",data:[{value:"IR",label:"Infra-Red source"}]}];var app=angular.module("appList",["ngResource","ngRoute"]);app.config(function(a){a.when("/",{controller:"ListController",templateUrl:"/static/stargazer/angular/routes/browse/StellarList.html"}).when("/constellation",{controller:"constellationsController",templateUrl:"/static/stargazer/angular/routes/browse/Constellations.html"}).when("/constellation/:abbreviation",{controller:"constallationsDetailController",templateUrl:"/static/stargazer/angular/routes/browse/ConstellationsDetail.html"}).when("/catalogue",{controller:"CatalogueController",templateUrl:"/static/stargazer/Catalogue.html"}).when("/catalogue/:name",{controller:"CatalogueListController",templateUrl:"/static/stargazer/CatalogueLists.html"})});var SearchApp=angular.module("SearchApp",["ngResource","ngRoute","ngAnimate"]);SearchApp.run(function(a,b,c){a.hashtag=hashtag}),SearchApp.config(function(a,b){b.html5Mode(!0),a.when("/",{controller:"SearchCtrl",templateUrl:"/static/stargazer/angular/routes/search/SearchView.html"}).when("/object/:id",{controller:"SingleViewCtrl",templateUrl:"/static/stargazer/angular/routes/search/SingleView.html"}).when("/page404",{templateUrl:"/static/stargazer/angular/routes/404.html"}).when("/API",{templateUrl:"/static/stargazer/angular/routes/API.html"}).otherwise({redirectTo:"/page404"})}),SearchApp.controller("FooterCtrl",["$scope","BugTrackerFactory","ContactAppletFactory",function(a,b,c){a.bugtracker=!1,a.contactapplet=!1,a.sendbug=function(){b.save({},{info:a.bugform.info,author:a.bugform.author,userAgent:navigator.userAgent,bugUrl:window.location.href}),a.bugtracker=!1,alert("Thank you")},a.sendcontact=function(){c.save({},{author:a.contactapp.author,message:a.contactapp.message}),a.contactapplet=!1,alert("Thank you")}}]),SearchApp.controller("SearchCtrl",["$scope","$window","SearchFactory","CommonData",function(a,b,c,d){function e(){a.StellarObject&&null!==a.StellarObject.next&&f()>g()-2200&&a.results.length<a.StellarObject.count&&(a.pending||(a.pending=!0,document.getElementById("annotation-loader").style.display="inherit",c.get({page:+a.page+1,max_mag:a.filters.MaxMag,min_mag:a.filters.MinMag,adv:a.filters.advanced,otype:a.filters.SearchTypes.toString(),"const":a.filters.SearchConstellation.toString(),cat:a.filters.SearchCatalogues.toString(),lat:a.filters.lat,name:a.filters.Name,orderby:a.filters.ordering}).$promise.then(function(b){a.page++,a.pending=!1,a.StellarObject=b;for(var c=0;c<b.results.length;c++)a.results.push(b.results[c]);d.set(a.StellarObject,b.index,a.filters,a.results,a.page),document.getElementById("annotation-loader").style.display=""})))}a.pending=!1,SliderFunc=function(){$("div #slider").slider({step:.1,range:!0,max:max_mag,min:min_mag,values:[a.filters.MinMag,a.filters.MaxMag],slide:function(b,c){$("#min_mag").val(c.values[0]),$("#max_mag").val(c.values[1]),a.filters.MinMag=c.values[0],a.filters.MaxMag=c.values[1]}})},a.Types=SearchTypes,a.Catalogues=SearchCatalogues,a.ddtypes=ddtypes,document.getElementById("nav-active").innerHTML="Search",document.addEventListener("keypress",function(b){var c=b.which||b.keyCode;13==c&&a.SearchFor(1)}),a.CommonData=d.get(),null!==a.CommonData.index?(a.StellarObject=a.CommonData.data,a.filters=a.CommonData.filters,a.results=a.CommonData.results,a.page=a.CommonData.page,SliderFunc(),$("#results").fadeIn(300)):(a.filters={},a.filters.visible=!1,a.filters.advanced=!1,a.filters.SearchConstellation=[],a.filters.SearchTypes=[],a.filters.SearchCatalogues=[],a.filters.lat="",a.filters.MinMag=min_mag,a.filters.MaxMag=max_mag,a.page=1,a.filters.ordering="magnitudo",SliderFunc(),a.results=[]),$("#autocomplete").autocomplete({source:ConstList}),a.ResetFilters=function(){a.filters.SearchConstellation.length=0,a.filters.MaxMag=max_mag,a.filters.MinMag=min_mag,a.filters.SearchTypes.length=0,a.filters.SearchCatalogues.length=0,a.filters.visible=!1,a.filters.lat="",$("#min_mag").val(min_mag),$("#max_mag").val(max_mag),$("#slider").slider("values",[min_mag,max_mag]),$("*> ul > li").removeClass("ok");
},a.VisibleOnly=function(){if(0==a.filters.visible){if(!navigator.geolocation)return alert("Geolocation is not supported by this browser.");navigator.geolocation.getCurrentPosition(function(b){latitude=b.coords.latitude,a.filters.lat=b.coords.latitude,a.filters.visible=!0}),a.filters.visible=!0}else a.filters.visible=!1,a.filters.lat=""},a.ChooseConst=function(){var b=$("#autocomplete").val();if(a.Constellation=b,-1!=$.inArray(b,a.filters.SearchConstellation)||""==b)return null;for(var c=0;c<ConstList.length;c++)ConstList[c].value==b&&(a.filters.SearchConstellation.push(a.Constellation),a.Constellation=null)},a.RemoveConst=function(){return a.filters.SearchConstellation.splice(a.filters.SearchConstellation.indexOf(this.c),1)},a.ChooseType=function(){1==a.filters.advanced?-1==$.inArray(this.ot.value,a.filters.SearchTypes)?(a.filters.SearchTypes.push(this.ot.value),a.filters.SearchTypes.Visible=!0):a.filters.SearchTypes.splice(a.filters.SearchTypes.indexOf(this.ot.value),1):0==a.filters.advanced&&(-1==$.inArray(this.t.uniname,a.filters.SearchTypes)?a.filters.SearchTypes.push(this.t.uniname):a.filters.SearchTypes.splice(a.filters.SearchTypes.indexOf(this.t.uniname),1))},a.ChooseAdvanced=function(){1==a.filters.advanced?(a.filters.advanced=!1,a.filters.SearchTypes.length=0):(a.filters.advanced=!0,a.filters.SearchTypes.length=0,a.filters.SearchTypes.length=0)},a.RemoveType=function(){a.filters.SearchTypes.splice(a.filters.SearchTypes.indexOf(this.t),1)},a.ChooseCatalogue=function(){-1==$.inArray(this.cat,a.filters.SearchCatalogues)?a.filters.SearchCatalogues.push(this.cat):a.filters.SearchCatalogues.splice(a.filters.SearchCatalogues.indexOf(this.cat),1)},a.RemoveCatalogue=function(){a.filters.SearchCatalogues.splice(a.filters.SearchCatalogues.indexOf(this.cat),1)},a.TypeList=!0,a.CatList=!0,a.SearchFor=function(b){document.getElementById("annotation-loader").style.display="",document.getElementById("params-annot").style.display="",butt=$("#search-btn > input"),butt.attr("value","Search"),butt.removeAttr("id","SearchAgain"),$("div.box").fadeIn(300),a.page=b,a.results=[],c.get({page:b,max_mag:a.filters.MaxMag,min_mag:a.filters.MinMag,adv:a.filters.advanced,otype:a.filters.SearchTypes.toString(),"const":a.filters.SearchConstellation.toString(),cat:a.filters.SearchCatalogues.toString(),lat:a.filters.lat,name:a.filters.Name,orderby:a.filters.ordering}).$promise.then(function(b){a.StellarObject=b,a.results=b.results,d.set(a.StellarObject,1,a.filters,a.results,a.page),$("div.box").fadeOut(300)})},a.trUrl=function(b,c){d.set(a.StellarObject,c,a.filters,a.results,a.page),document.removeEventListener("scroll",e,!1),window.location=hashtag.concat("object/",b)};var f=function(){return document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:void 0},g=function(){return document.documentElement&&document.documentElement.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight?document.body.scrollHeight:0};document.addEventListener("scroll",e,!1),a.orderBy=function(b){a.filters.ordering==b?a.filters.ordering="".concat("-",b):a.filters.ordering=="".concat("-",b)?a.filters.ordering="":""==a.filters.ordering?a.filters.ordering=b:a.filters.ordering=b},a.$watch("filters",function(b,c){a.StellarObject&&c!=b&&0!=a.results.length&&(a.StellarObject.next=null,a.CommonData.next=null,butt=$("#search-btn > input"),butt.attr("value","search Again"),butt.attr("id","SearchAgain"),document.getElementById("params-annot").style.display="block")},!0)}]),SearchApp.controller("SingleViewCtrl",["$scope","$routeParams","CommonData","$resource","$location","$anchorScroll",function(a,b,c,d,e,f){if(getCharts=function(){ChartMapFactory=d("/endpoint/mapAPI",{asc:a.MainObject.rightAsc,dec:a.MainObject.declination,mag:a.MainObject.magnitudo}),null!==a.CommonData.index?a.CommonData.results[a.CommonData.index].hasOwnProperty("charts")===!1?(document.getElementById("annotation-loader").style.display="inherit",ChartMapFactory.get().$promise.then(function(b){a.charts=b,a.CommonData.results[a.CommonData.index].charts=a.charts,document.getElementById("annotation-loader").style.display=""})):a.charts=a.CommonData.results[a.CommonData.index].charts:a.charts||(document.getElementById("annotation-loader").style.display="inherit",ChartMapFactory.get().$promise.then(function(b){a.charts=b,document.getElementById("annotation-loader").style.display=""}))},aladin=function(){if(a.MainObject.rightAsc&&a.MainObject.declination){a.MainObject.fov||45==a.MainObject.fov;A.aladin("#aladin-lite-div",{survey:"P/DSS2/color",fov:a.MainObject.fov,target:a.MainObject.rightAsc.concat(" ",a.MainObject.declination),showReticle:!0});return!0}A.aladin("#aladin-lite-div",{survey:"P/DSS2/color",fov:180,target:"0",showReticle:!0});return!1},b.id>maxid||b.id<=0||isNaN(b.id))window.location=hashtag.concat("page404");else{if(a.CommonData=c.get(),a.getNextLast=function(b){return b<a.CommonData.results.length&&b>=0?a.CommonData.results[b].catalogues[0].object_catalogue.concat(" ",a.CommonData.results[b].catalogues[0].object_number):!1},console.log(a.CommonData.results[a.CommonData.index].id,parseInt(b.id)),null!==a.CommonData.index&&a.CommonData.results[a.CommonData.index].id==parseInt(b.id))a.MainObject=a.CommonData.results[a.CommonData.index],a.nextObject=a.getNextLast(a.CommonData.index+1),a.lastObject=a.getNextLast(a.CommonData.index-1),title=a.MainObject.catalogues[0].object_catalogue.concat(" ",a.MainObject.catalogues[0].object_number),window.document.title=title,aladin(),getCharts();else{a.nextObject=!1,a.lastObject=!1,$("div.box").fadeIn(300);var g=d("/endpoint/singleAPI/:id",{id:b.id,format:"json"});g.get().$promise.then(function(b){a.MainObject=b,$("div.box").fadeOut(300),title=a.MainObject.catalogues[0].object_catalogue.concat(" ",a.MainObject.catalogues[0].object_number),window.document.title=title,aladin(),getCharts()})}a.scrollTo=function(a){var b=e.hash();e.hash(a),f(),e.hash(b)},a.nextIndex=function(b){"undefinded"!=typeof a.CommonData&&a.CommonData.index<a.CommonData.results.length&&(a.CommonData.index++,a.nextObject=a.getNextLast(a.CommonData.index+1),a.lastObject=a.getNextLast(a.CommonData.index-1),a.charts=a.CommonData.results[a.CommonData.index].charts,a.MainObject=a.CommonData.results[a.CommonData.index],window.document.title=a.MainObject.catalogues[0].object_catalogue.concat(" ",a.MainObject.catalogues[0].object_number),aladin(),getCharts())},a.leastIndex=function(b){"undefinded"!=typeof a.CommonData&&a.CommonData.index>=0&&(a.CommonData.index--,a.nextObject=a.getNextLast(a.CommonData.index+1),a.lastObject=a.getNextLast(a.CommonData.index-1),a.charts=a.CommonData.results[a.CommonData.index].charts,a.MainObject=a.CommonData.results[a.CommonData.index],window.document.title=a.MainObject.catalogues[0].object_catalogue.concat(" ",a.MainObject.catalogues[0].object_number),aladin(),getCharts())},a.getConstelationName=function(){for(var b=0;b<ConstList.length;b++)if(ConstList[b].value==a.MainObject.constelation)return ConstList[b].label}}}]),app.controller("constellationsController",["$scope","Const",function(a,b){var c=b.query();a.constellation=c}]),app.controller("constallationsDetailController",["$routeParams","$scope","ConstNgcs",function(a,b,c){getData=function(d){var e=c.get({abbreviation:a.abbreviation,page:d});b.ngcs=e},getData(),page=1,b.clickNext=function(){null!=b.ngcs.next&&(page++,getData(page))},b.clickPrevious=function(){1!=page&&(page--,getData(page))}}]),app.controller("ListController",["$scope","$http","StellarFactory",function(a,b,c){getData=function(b){a.StellarList=c.get({page:b})},getData(),page=1,a.clickNext=function(){null!=a.StellarList.next&&(page++,getData(page))},a.clickPrevious=function(){1!=page&&(page--,getData(page))}}]);var format={format:"json"};app.factory("Const",["$resource",function(a){return a("/constellationsAPI",format)}]),app.factory("ConstNgcs",["$resource",function(a){return a("/constellationsAPI/:abbreviation",format)}]),app.factory("StellarFactory",["$resource",function(a){return a("/StellarlistAPI",format)}]);var format={format:"json"};SearchApp.factory("BugTrackerFactory",["$resource",function(a){return a("/endpoint/bugtrackerAPI",format)}]),SearchApp.factory("ContactAppletFactory",["$resource",function(a){return a("/endpoint/contactappletAPI",format)}]);var format={format:"json"};SearchApp.factory("SearchFactory",["$resource",function(a){return a("/endpoint/searchAPI",format)}]),SearchApp.factory("SingleViewFactory",["$resource",function(a){return a("/endpoint/singleAPI/1",format)}]),SearchApp.factory("ChartsFactory",["$resource",function(a,b,c,d){return a("/endpoint/mapAPI",{asc:b,dec:c,mag:d})}]),SearchApp.factory("CommonData",function(){function a(a,b,c,d,e){"undefined"!=typeof Storage&&(localStorage.setItem("data",JSON.stringify(a)),localStorage.setItem("results",JSON.stringify(d)),localStorage.setItem("page",e),isNaN(parseInt(b))?localStorage.setItem("index",JSON.stringify(0)):localStorage.setItem("index",b),localStorage.setItem("filters",JSON.stringify(c)))}function b(){return"undefined"!=typeof Storage?(savedData.data=JSON.parse(localStorage.getItem("data")),savedData.index=JSON.parse(localStorage.getItem("index")),savedData.filters=JSON.parse(localStorage.getItem("filters")),savedData.results=JSON.parse(localStorage.getItem("results")),savedData.page=localStorage.getItem("page"),savedData):savedData}function c(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}return savedData={},{set:a,get:b,isEmpty:c}});